<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Merging Service Delivery Point Data to Household &amp; Female Records</title>

  <meta property="description" itemprop="description" content="Create aggregate measures for women living the areas served by SDPs"/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2021-01-29"/>
  <meta property="article:created" itemprop="dateCreated" content="2021-01-29"/>
  <meta name="article:author" content="Matt Gunther"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Merging Service Delivery Point Data to Household &amp; Female Records"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="Create aggregate measures for women living the areas served by SDPs"/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Merging Service Delivery Point Data to Household &amp; Female Records"/>
  <meta property="twitter:description" content="Create aggregate measures for women living the areas served by SDPs"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","categories","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Merging Service Delivery Point Data to Household & Female Records"]},{"type":"character","attributes":{},"value":["Create aggregate measures for women living the areas served by SDPs\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["Individuals in Context","Data Manipulation","Service Delivery Points","pivot_longer","join"]},{"type":"character","attributes":{},"value":["01-29-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data/bf_merged.rds","data/pma_00008.dat.gz","data/pma_00008.xml","data/pma_00011.dat.gz","data/pma_00011.xml","summarize-by-easerved_files/anchor-4.2.2/anchor.min.js","summarize-by-easerved_files/bowser-1.9.3/bowser.min.js","summarize-by-easerved_files/distill-2.2.21/template.v2.js","summarize-by-easerved_files/font-awesome-5.13.0/css/all.min.css","summarize-by-easerved_files/font-awesome-5.13.0/css/v4-shims.min.css","summarize-by-easerved_files/font-awesome-5.13.0/js/script.js","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-brands-400.eot","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-brands-400.svg","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-brands-400.ttf","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-brands-400.woff","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-brands-400.woff2","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-regular-400.eot","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-regular-400.svg","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-regular-400.ttf","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-regular-400.woff","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-regular-400.woff2","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-solid-900.eot","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-solid-900.svg","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-solid-900.ttf","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-solid-900.woff","summarize-by-easerved_files/font-awesome-5.13.0/webfonts/fa-solid-900.woff2","summarize-by-easerved_files/header-attrs-2.6/header-attrs.js","summarize-by-easerved_files/header-attrs-2.7/header-attrs.js","summarize-by-easerved_files/jquery-1.11.3/jquery.min.js","summarize-by-easerved_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="summarize-by-easerved_files/header-attrs-2.7/header-attrs.js"></script>
  <script src="summarize-by-easerved_files/jquery-1.11.3/jquery.min.js"></script>
  <script src="summarize-by-easerved_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="summarize-by-easerved_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="summarize-by-easerved_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="summarize-by-easerved_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Merging Service Delivery Point Data to Household & Female Records","description":"Create aggregate measures for women living the areas served by SDPs","authors":[{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-29T00:00:00.000+00:00","citationText":"Gunther, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Merging Service Delivery Point Data to Household &amp; Female Records</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt=tag">Individuals in Context</div>
<div class="dt=tag">Data Manipulation</div>
<div class="dt=tag">Service Delivery Points</div>
<div class="dt=tag">pivot_longer</div>
<div class="dt=tag">join</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>Create aggregate measures for women living the areas served by SDPs</p></p>
</div>

<div class="d-byline">
  Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>01-29-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#reviewing-sdp-sample-design">Reviewing SDP Sample Design</a></li>
<li><a href="#setup-create-and-load-a-data-extract">Setup: Create and Load a Data Extract</a></li>
<li><a href="#eaid-and-easerved">EAID and EASERVED</a></li>
<li><a href="#pivot-longer-easerved-in-rows">Pivot Longer: EASERVED in Rows</a></li>
<li><a href="#summarise-by-easerved-and-sample">Summarise by EASERVED and SAMPLE</a></li>
<li><a href="#merging-to-household-and-female-data">Merging to Household and Female Data</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>Welcome to the <strong>third post</strong> in a series all about using PMA Service Delivery Point (SDP) data to better understand <a href="../../index.html#category:Individuals_in_Context">Individuals in Context</a>. In our <a href="../2021-01-28-across-sdp/index.html">last post</a>, we discussed a few of the variable groups related to contraceptive availability, and we showed how to use functions like <code>dplyr::across</code> to recode and summarize these variable groups in preparation for merging with Household and Female data.</p>
<p>Before we dive in, let’s quickly revisit the geographic sampling units - or <strong>enumeration areas</strong> - we’ll be using to link SDPs with their counterparts in the Household and Female data.</p>
<h1 id="reviewing-sdp-sample-design">Reviewing SDP Sample Design</h1>
<p>Remember: the SDP <a href="../2021-01-26-sdp-data/index.html#sample-design">sample design</a> selects facilities meant to reflect the health service environment experienced by individuals included in Household and Female samples. <em>If you were designing survey with this goal in mind, how would you select facilities?</em></p>
<p>Well, you might target a sample of facilities located within the same geographic sampling units PMA used to define Household and Female samples from the same country in the same year. Presumably, the health services available to a woman living in enumeration area <code>X</code> would be captured pretty well if we surveyed a list of facilities also <em>located</em> in enumeration area <code>X</code>.</p>
<p>But what happens if a lot of women living in enumeration area <code>X</code> travel to enumeration area <code>Y</code> to receive family planning services? In that case, you’d want to know as much as possible about the service catchment areas for facilities in that country. Then, you could select facilities based on whether they <em>provide services to</em> enumeration area <code>X</code>, rather than relying simply to those that are located there.</p>
<p>In fact, PMA partners with government health agencies to obtain information about the service catchment area for all of the <strong>public-sector</strong> health facilities in each participating country. As a result, public SDPs are sampled if one of the enumeration areas used in a corresponding Household and Female sample appears in their service catchment area.</p>
<p>Because service catchment data are only available for public facilities, PMA uses a different method to select <strong>private-sector</strong> facilities. A private facility will be selected for a SDP sample only if it is located inside the boundaries of an enumeration area included in a corresponding Household and Female sample.</p>
<h1 id="setup-create-and-load-a-data-extract">Setup: Create and Load a Data Extract</h1>
<p>Let’s take a look at an example SDP dataset to see how all of this information gets reported. We’ll use the same data we highlighted in our <a href="../2021-01-28-across-sdp/index.html">last post</a>, which includes facilities sampled from Burkina Faso in 2017 and 2018. First, load the following packages into R:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
Check out our posts on <a href="../2020-12-10-get-r-and-packages/index.html#r-packages">R Packages</a> and <a href="../2020-12-10-get-ipums-pma-data/index.html">Loading IPUMS PMA data into R</a>.
</aside>
<p>Again in this post, we’ll be working with all of the available contraceptive <a href="https://pma.ipums.org/pma-action/variables/group?id=fp_services">services</a> and <a href="https://pma.ipums.org/pma-action/variables/group?id=fp_stock">stock</a> variables ending with the suffixes <code>PROV</code>, <code>OBS</code>, <code>OUT3MO</code>, and <code>OUTDAY</code>. We’ll also add the variable group <a href="https://pma.ipums.org/pma-action/variables/EASERVED">EASERVED</a>, which - as we’ll see - stores information about the service catchment area for facilities where that information was available. Finally, we’ll add a few more variables that we’ll explore a bit later: <a href="https://pma.ipums.org/pma-action/variables/AUTHORITY">AUTHORITY</a>, <a href="https://pma.ipums.org/pma-action/variables/FACILITYTYPE">FACILITYTYPE</a>, and <a href="https://pma.ipums.org/pma-action/variables/FACILITYTYPEGEN">FACILITYTYPEGEN</a>.</p>
<p>We’ll first load the data using <code>ipumsr::read_ipums_micro</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='fu'>ipumsr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00008.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00008.dat.gz"</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<aside>
Remember: change these file paths to match your own data extract!
</aside>
<p>Then, following the <a href="../2021-01-28-across-sdp/index.html#recoding-variables-with-ipumsr">steps outlined in our last post</a>, we’ll apply a couple of recoding functions from <a href="http://tech.popdata.org/ipumsr/">ipumsr</a>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>EASERVED</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='co'># error from extract system</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"in stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_na_if.html'>lbl_na_if</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='op'>~</span><span class='va'>.lbl</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='st'>"Not interviewed (SDP questionnaire)"</span>,
        <span class='st'>"Don't know"</span>,
        <span class='st'>"No response or missing"</span>,
        <span class='st'>"NIU (not in universe)"</span>
      <span class='op'>)</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="eaid-and-easerved">EAID and EASERVED</h1>
<p>For the moment, let’s just take a look at the basic structure of our data, selecting only the variables <a href="https://pma.ipums.org/pma-action/variables/FACILITYID">FACILITYID</a>, <a href="https://pma.ipums.org/pma-action/variables/SAMPLE">SAMPLE</a>, <code>AUTHORITY</code>, <a href="https://pma.ipums.org/pma-action/variables/CONSENTSQ">CONSENTSQ</a>, and <a href="https://pma.ipums.org/pma-action/variables/EAID">EAID</a>. For this preview, we’ll also arrange the data in ascending order of <code>FACILITYID</code> and <code>SAMPLE</code>:</p>
<aside>
<code>FACILITYID</code>, <code>SAMPLE</code>, <code>CONSENTSQ</code>, and <code>EAID</code> are automatically included in every SDP data extract.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>SAMPLE</span>, <span class='va'>AUTHORITY</span>, <span class='va'>CONSENTSQ</span>, <span class='va'>EAID</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>SAMPLE</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 234 x 5
   FACILITYID                      SAMPLE    AUTHORITY CONSENTSQ  EAID
    &lt;int+lbl&gt;                   &lt;int+lbl&gt;    &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;dbl&gt;
 1       7006 85405 [Burkina Faso 2017 R… 1 [Governme…   1 [Yes]  7390
 2       7006 85408 [Burkina Faso 2018 R… 1 [Governme…   1 [Yes]  7390
 3       7027 85405 [Burkina Faso 2017 R… 1 [Governme…   1 [Yes]  7332
 4       7027 85408 [Burkina Faso 2018 R… 1 [Governme…   1 [Yes]  7332
 5       7029 85405 [Burkina Faso 2017 R… 4 [Private]    1 [Yes]  7111
 6       7029 85408 [Burkina Faso 2018 R… 4 [Private]    0 [No]   7111
 7       7036 85408 [Burkina Faso 2018 R… 1 [Governme…   1 [Yes]  7412
 8       7046 85408 [Burkina Faso 2018 R… 4 [Private]    1 [Yes]  7798
 9       7048 85405 [Burkina Faso 2017 R… 1 [Governme…   1 [Yes]  7009
10       7051 85408 [Burkina Faso 2018 R… 1 [Governme…   1 [Yes]  7798
# … with 224 more rows</code></pre>
</div>
<p>Each row in our data represents one facility from one sample. Notice that some - but not <em>all</em> - facilities appear once in sample <code>85405</code> (from 2017), and again in sample <code>85408</code> (from 2018).</p>
<p>The variable <code>AUTHORITY</code> shows the managing authority for each facility. Following the discussion above, we’ll expect to find information about the service catchment area for each facility where the managing authority is <code>1 - Government</code>.</p>
<p>Also notice <code>CONSENTSQ</code>, which indicates whether a respondent at each facility consented to be interviewed. When you first obtain a data extract, you should expect most variables to be marked <code>Not interviewed (SDP questionnaire)</code> for facilities where <code>CONSENTSQ</code> shows <code>0 - No</code>. However, we’ve already taken the extra step of marking all non-response values <code>NA</code>: we should now expect to see <code>NA</code> substituted for <code>Not interviewed (SDP questionnaire)</code>.</p>
<p>Lastly, take particular note of the variable <code>EAID</code>: in SDP data, <code>EAID</code> <strong>shows the identification code associated with the enumeration area where a facility is located.</strong></p>
<p>We’ll find information about the service catchment area for each facility in a different set of variables, each starting with with prefix <code>EASERVED</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 234 x 18
   EASERVED1 EASERVED2 EASERVED3 EASERVED4 EASERVED5 EASERVED6
   &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt;
 1      7380      7323      7491      7605      7142      7279
 2      7879      7516      7111      7554      7934      7791
 3      7483        NA        NA        NA        NA        NA
 4      7185        NA        NA        NA        NA        NA
 5      7725      7859      7472      7175        NA        NA
 6      7082        NA        NA        NA        NA        NA
 7      7650        NA        NA        NA        NA        NA
 8      7955        NA        NA        NA        NA        NA
 9      7323        NA        NA        NA        NA        NA
10      7774        NA        NA        NA        NA        NA
# … with 224 more rows, and 12 more variables: EASERVED7 &lt;int+lbl&gt;,
#   EASERVED8 &lt;int+lbl&gt;, EASERVED9 &lt;int+lbl&gt;, EASERVED10 &lt;int+lbl&gt;,
#   EASERVED11 &lt;int+lbl&gt;, …</code></pre>
</div>
<p>You’ll notice that our extract contains 18 EASERVED variables. Why 18? If you created your own data extract, you’ll remember that you only selected one variable called <code>EASERVED</code>: once you’ve selected samples, the IPUMS extract system automatically determines the correct number of EASERVED variables for your dataset based on the facility with the largest service catchment list.</p>
<aside>
Some samples include facilities serving as many as 42 enumeration areas, requiring 42 <b>EASERVED</b> variables!
</aside>
<p>As we’ve discussed, PMA only receives service catchment information about <strong>public-sector facilities</strong>. In their case, each <code>EASERVED</code> variable contains an ID code for <em>one</em> of the enumeration areas in its service catchment list, or else it’s <code>NA</code>. We’ll look at these public-sector facilities first:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>AUTHORITY</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 2
        AUTHORITY     n
*       &lt;int+lbl&gt; &lt;int&gt;
1 1 [Government]    202
2 3 [Faith-based]     3
3 4 [Private]        29</code></pre>
</div>
<p>The vast majority of SDPs in our sample are public-sector facilities. They comprise 202 of the 234 facilities in our sample.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AUTHORITY</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 202 x 18
   EASERVED1 EASERVED2 EASERVED3 EASERVED4 EASERVED5 EASERVED6
   &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt;
 1      7380      7323      7491      7605      7142      7279
 2      7879      7516      7111      7554      7934      7791
 3      7483        NA        NA        NA        NA        NA
 4      7185        NA        NA        NA        NA        NA
 5      7725      7859      7472      7175        NA        NA
 6      7082        NA        NA        NA        NA        NA
 7      7650        NA        NA        NA        NA        NA
 8      7955        NA        NA        NA        NA        NA
 9      7323        NA        NA        NA        NA        NA
10      7774        NA        NA        NA        NA        NA
# … with 192 more rows, and 12 more variables: EASERVED7 &lt;int+lbl&gt;,
#   EASERVED8 &lt;int+lbl&gt;, EASERVED9 &lt;int+lbl&gt;, EASERVED10 &lt;int+lbl&gt;,
#   EASERVED11 &lt;int+lbl&gt;, …</code></pre>
</div>
<p>Using two of the <code>dplyr</code> functions discussed in our <a href="../2021-01-28-across-sdp/index.html">last post</a> - <a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a> and <a href="https://dplyr.tidyverse.org/reference/across.html">across</a> - we’ll get a better sense of the catchment areas for our public-sector SDPs. Let’s see how many missing values exist for each of these <code>EASERVED</code> variables:</p>
<aside>
<b>dplyr</b> is included when you load <b>library(tidyverse)</b>
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AUTHORITY</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarise</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 18
  EASERVED1 EASERVED2 EASERVED3 EASERVED4 EASERVED5 EASERVED6
      &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
1         0       156       173       181       190       192
# … with 12 more variables: EASERVED7 &lt;int&gt;, EASERVED8 &lt;int&gt;,
#   EASERVED9 &lt;int&gt;, EASERVED10 &lt;int&gt;, EASERVED11 &lt;int&gt;, …</code></pre>
</div>
<p>We see that every public facility serves at least one enumeration area (there are no missing values for <code>EASERVED1</code>). However, there are 156 missing values for <code>EASERVED2</code>, which tells us that 156 public facilities only serve one enumeration area. Likewise: 173 facilities serve 2 enumeration areas or fewer, 181 serve 3 or fewer, and so forth.</p>
<p>What about the 32 <strong>non-public facilities</strong>?</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>AUTHORITY</span> <span class='op'>!=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarise</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 18
  EASERVED1 EASERVED2 EASERVED3 EASERVED4 EASERVED5 EASERVED6
      &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
1         4        32        32        32        32        32
# … with 12 more variables: EASERVED7 &lt;int&gt;, EASERVED8 &lt;int&gt;,
#   EASERVED9 &lt;int&gt;, EASERVED10 &lt;int&gt;, EASERVED11 &lt;int&gt;, …</code></pre>
</div>
<p>PMA receives no information about the service catchment areas for these facilities, so - as you might expect - there are 32 missing values for <code>EASERVED2</code> onward. Note, however, that there are only 4 missing values for <code>EASERVED1</code>: for non-public facilities, <code>EASERVED1</code> usually contains that same enumeration area code shown in <code>EAID</code> (this is the enumeration area where the facility is, itself, located).</p>
<p>The exception to this rule comes from facilities where <code>CONSENTSQ</code> shows that no respondent provided consent to be interviewed. If we’d like, we can copy <code>EAID</code> to <code>EASERVED1</code> for these facilities using <a href="https://dplyr.tidyverse.org/reference/case_when.html">dplyr::case_when</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>EASERVED1 <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>EASERVED1</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>EAID</span>,
    <span class='cn'>T</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/double.html'>as.double</a></span><span class='op'>(</span><span class='va'>EASERVED1</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
We coerce <b>EASERVED1</b> as a double, matching the class provided by <b>EAID</b>.
</aside>
<p>Now, <em>every SDP has at least one enumeration area included in the</em> <code>EASERVED</code> <em>group.</em> This will be important in our next step, where we’ll see how to summarize the SDP data by groups of facilities serving the same enumeration area.</p>
<h1 id="pivot-longer-easerved-in-rows">Pivot Longer: EASERVED in Rows</h1>
<p>Now that we’re familiar with <code>EASERVED</code> variables, let’s take a look at the kinds of summary statistics we might want to construct from variables related to contraceptive service availability. For example, consider <a href="https://pma.ipums.org/pma-action/variables/EMRGPROV">EMRGPROV</a>, which indicates whether a facility provides emergency contraceptives to clients.</p>
<p>Remember that, right now, each row of our SDP dataset represents responses from <em>one</em> facility per sample. We’ll ultimately want to count the number of facilities providing emergency contraceptives to clients in each enumeration area, so we should use the <code>tidyr</code> function <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a> to reshape the data in a way that repeats each facility’s response to <code>EMRGPROV</code> once for every enumeration area that it serves.</p>
<aside>
<b>tidyr</b> is included when you load <b>library(tidyverse)</b>
</aside>
<p>Take, for example, the first 5 facilities in our dataset: for now, let’s just look at the first two <code>EASERVED</code> variables, along with each facility’s <code>FACILITYID</code>, <code>EAID</code>, and <code>EMRGPROV</code> response:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
   <span class='fu'>select</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>EASERVED1</span>, <span class='va'>EASERVED2</span>, <span class='va'>EMRGPROV</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5 x 4
  FACILITYID EASERVED1 EASERVED2  EMRGPROV
   &lt;int+lbl&gt;     &lt;dbl&gt; &lt;int+lbl&gt; &lt;int+lbl&gt;
1       7250      7380      7323   0 [No] 
2       7399      7879      7516   0 [No] 
3       7506      7483        NA   0 [No] 
4       7982      7185        NA   0 [No] 
5       7065      7725      7859   1 [Yes]</code></pre>
</div>
<p>Among these 5 facilities, only facility <code>7065</code> provides emergency contraceptives. This facility happens to provide services to 2 enumeration areas: <code>7725</code> and <code>7859</code>. When we use <code>pivot_longer</code>, we’ll reshape the data to emphasize a different conclusion: our example shows two enumeration areas where individuals can access emergency contraceptives. We convey this information by placing each enumeration area from <code>EASERVED1</code> or <code>EASERVED2</code> in its own row:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>EASERVED1</span>, <span class='va'>EASERVED2</span>, <span class='va'>EMRGPROV</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span>,
    values_to <span class='op'>=</span> <span class='st'>"EASERVED"</span>,
    names_to <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 10 x 3
   FACILITYID  EMRGPROV  EASERVED
    &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;dbl+lbl&gt;
 1       7250   0 [No]       7380
 2       7250   0 [No]       7323
 3       7399   0 [No]       7879
 4       7399   0 [No]       7516
 5       7506   0 [No]       7483
 6       7506   0 [No]         NA
 7       7982   0 [No]       7185
 8       7982   0 [No]         NA
 9       7065   1 [Yes]      7725
10       7065   1 [Yes]      7859</code></pre>
</div>
<aside>
Here, <b>values_to</b> gives the name of a new column where we store the values. If we wanted, we could use <b>names_to</b> to create another column storing the original variable names (<b>EASERVED1</b> and <b>EASERVED2</b>) for each value.
</aside>
<p>Now, we find that each of the values previously stored in <code>EASERVED1</code> and <code>EASERVED2</code> appear in a new column, <code>EASERVED</code>. Each facility occupies two rows: one for each of the enumeration areas that it serves.</p>
<p>What about the rows where <code>EASERVED</code> contains <code>NA</code>? These rows are meaningless: we’re repeating each facility’s response to <code>EMRGPROV</code> twice to represent two enumeration areas, but facilities <code>7506</code> and <code>7982</code> only serve one enumeration area apiece. We should include the argument <code>values_drop_na = T</code> to drop these rows when we use <code>pivot_longer()</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>slice</span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>EASERVED1</span>, <span class='va'>EASERVED2</span>, <span class='va'>EMRGPROV</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span>,
    values_to <span class='op'>=</span> <span class='st'>"EASERVED"</span>,
    names_to <span class='op'>=</span> <span class='cn'>NULL</span>,
    values_drop_na <span class='op'>=</span> <span class='cn'>T</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 8 x 3
  FACILITYID  EMRGPROV  EASERVED
   &lt;int+lbl&gt; &lt;int+lbl&gt; &lt;dbl+lbl&gt;
1       7250   0 [No]       7380
2       7250   0 [No]       7323
3       7399   0 [No]       7879
4       7399   0 [No]       7516
5       7506   0 [No]       7483
6       7982   0 [No]       7185
7       7065   1 [Yes]      7725
8       7065   1 [Yes]      7859</code></pre>
</div>
<p>Now that we know how to <code>pivot_longer</code>, let’s apply the function to our full dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"EASERVED"</span><span class='op'>)</span>,
    values_to <span class='op'>=</span> <span class='st'>"EASERVED"</span>,
    values_drop_na <span class='op'>=</span> <span class='cn'>T</span>,
    names_to <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>distinct</span><span class='op'>(</span><span class='op'>)</span> <span class='co'># in case any facility listed the same EASERVED twice</span>
</code></pre>
</div>
</div>
<p>Dropping each row where <code>EASERVED</code> is missing, we’re left with 372 rows where information about each SDP gets repeated once for every enumeration area that it serves. (Remember: our original dataset contained only 234 rows because SDPs occupied just one row apiece).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='va'>FACILITYID</span>, <span class='va'>EASERVED</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 372 x 58
   FACILITYID EASERVED      SAMPLE COUNTRY  YEAR ROUND  EAID CONSENTSQ
    &lt;int+lbl&gt; &lt;dbl+lb&gt;   &lt;int+lbl&gt; &lt;int+l&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int+lbl&gt;
 1       7250     7380 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 2       7250     7323 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 3       7250     7491 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 4       7250     7605 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 5       7250     7142 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 6       7250     7279 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 7       7250     7370 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 8       7250     7725 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
 9       7250     7811 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
10       7250     7859 85405 [Bur… 1 [Bur…  2017     5  7142   1 [Yes]
# … with 362 more rows, and 50 more variables: STRATA &lt;int+lbl&gt;,
#   FACILITYTYPE &lt;int+lbl&gt;, FACILITYTYPEGEN &lt;int+lbl&gt;,
#   AUTHORITY &lt;int+lbl&gt;, CONPROV &lt;int+lbl&gt;, …</code></pre>
</div>
<h1 id="summarise-by-easerved-and-sample">Summarise by EASERVED and SAMPLE</h1>
<p>Now that we’ve reshaped our data, we’ll be able to create some simple summary statistics about each of the enumeration areas served by the facilities in our sample. First, let’s <code>group_by(EASERVED, SAMPLE)</code> and <code>count()</code> the number of facilities providing services to each enumeration area in each of our samples:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EASERVED</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>, 
    N_SDP <span class='op'>=</span> <span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 149 x 3
# Groups:   EASERVED, SAMPLE [149]
    EASERVED                            SAMPLE N_SDP
   &lt;dbl+lbl&gt;                         &lt;int+lbl&gt; &lt;int&gt;
 1      7003 85405 [Burkina Faso 2017 Round 5]     3
 2      7003 85408 [Burkina Faso 2018 Round 6]     2
 3      7006 85405 [Burkina Faso 2017 Round 5]     2
 4      7006 85408 [Burkina Faso 2018 Round 6]     1
 5      7009 85405 [Burkina Faso 2017 Round 5]     3
 6      7009 85408 [Burkina Faso 2018 Round 6]     2
 7      7016 85405 [Burkina Faso 2017 Round 5]     3
 8      7016 85408 [Burkina Faso 2018 Round 6]     2
 9      7026 85405 [Burkina Faso 2017 Round 5]     3
10      7026 85408 [Burkina Faso 2018 Round 6]     3
# … with 139 more rows</code></pre>
</div>
<p>Continuing with the variable <code>EMRGPROV</code>, we can now also count the number of sampled facilities providing emergency contraception to each <code>EASERVED</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EASERVED</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    N_EMRGPROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>EMRGPROV</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 149 x 3
# Groups:   EASERVED, SAMPLE [149]
    EASERVED                            SAMPLE N_EMRGPROV
   &lt;dbl+lbl&gt;                         &lt;int+lbl&gt;      &lt;int&gt;
 1      7003 85405 [Burkina Faso 2017 Round 5]          0
 2      7003 85408 [Burkina Faso 2018 Round 6]          0
 3      7006 85405 [Burkina Faso 2017 Round 5]          0
 4      7006 85408 [Burkina Faso 2018 Round 6]          0
 5      7009 85405 [Burkina Faso 2017 Round 5]          2
 6      7009 85408 [Burkina Faso 2018 Round 6]          1
 7      7016 85405 [Burkina Faso 2017 Round 5]          0
 8      7016 85408 [Burkina Faso 2018 Round 6]          0
 9      7026 85405 [Burkina Faso 2017 Round 5]          0
10      7026 85408 [Burkina Faso 2018 Round 6]          0
# … with 139 more rows</code></pre>
</div>
<p>What if we want to include a count of the facilities providing <em>each</em> of the different contraceptive methods in our data? Building on a technique showcased in our <a href="../2021-01-28-across-sdp/index.html#summarize-variable-groups-by-eaid">last post</a>, we could use <code>dplyr::across</code> to iterate over all variables ending with the suffix <code>PROV</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EASERVED</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 149 x 15
# Groups:   EASERVED, SAMPLE [149]
   EASERVED      SAMPLE N_CONPROV N_CYCBPROV N_DEPOPROV N_DIAPROV
   &lt;dbl+lb&gt;   &lt;int+lbl&gt;     &lt;int&gt;      &lt;int&gt;      &lt;int&gt;     &lt;int&gt;
 1     7003 85405 [Bur…         3          3          3         0
 2     7003 85408 [Bur…         2          2          2         0
 3     7006 85405 [Bur…         2          2          2         0
 4     7006 85408 [Bur…         1          1          1         0
 5     7009 85405 [Bur…         3          1          3         0
 6     7009 85408 [Bur…         2          2          2         0
 7     7016 85405 [Bur…         3          3          3         0
 8     7016 85408 [Bur…         2          1          2         0
 9     7026 85405 [Bur…         3          3          3         0
10     7026 85408 [Bur…         3          3          3         0
# … with 139 more rows, and 9 more variables: N_EMRGPROV &lt;int&gt;,
#   N_FCPROV &lt;int&gt;, N_FSTPROV &lt;int&gt;, N_FJPROV &lt;int&gt;, N_IMPPROV &lt;int&gt;,
#   …</code></pre>
</div>
<p>We’ll reduce this information even further, creating a variable <code>NUM_METHODS_PROV</code> indicating the number of methods provided by at least one sampled facility:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EASERVED</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>transmute</span><span class='op'>(</span>
    <span class='va'>EASERVED</span>,
    <span class='va'>SAMPLE</span>,
    NUM_METHODS_PROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 149 x 3
# Groups:   EASERVED, SAMPLE [149]
    EASERVED                            SAMPLE NUM_METHODS_PROV
   &lt;dbl+lbl&gt;                         &lt;int+lbl&gt;            &lt;int&gt;
 1      7003 85405 [Burkina Faso 2017 Round 5]               10
 2      7003 85408 [Burkina Faso 2018 Round 6]                8
 3      7006 85405 [Burkina Faso 2017 Round 5]               10
 4      7006 85408 [Burkina Faso 2018 Round 6]                8
 5      7009 85405 [Burkina Faso 2017 Round 5]                9
 6      7009 85408 [Burkina Faso 2018 Round 6]               10
 7      7016 85405 [Burkina Faso 2017 Round 5]                9
 8      7016 85408 [Burkina Faso 2018 Round 6]                8
 9      7026 85405 [Burkina Faso 2017 Round 5]               10
10      7026 85408 [Burkina Faso 2018 Round 6]               10
# … with 139 more rows</code></pre>
</div>
<p>In our last post, we introduced 4 variable groups related to the availability of different contraceptive methods. We’ll now create a summary variable for each one, and then show how to attach our new variables to a Household and Female dataset:</p>
<ul>
<li><code>N_SDP</code> - number of SDPs</li>
<li><code>NUM_METHODS_PROV</code> - number of methods provided by at least one SDP</li>
<li><code>NUM_METHODS_INSTOCK</code> - number of methods in-stock with at least one SDP</li>
<li><code>NUM_METHODS_OUT3MO</code> - number of methods out of stock in the last 3 months with at least one SDP</li>
<li><code>MEAN_OUTDAY</code> - the mean length of a stockout for all out of stock methods</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EASERVED</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    N_SDP <span class='op'>=</span> <span class='fu'>n</span><span class='op'>(</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.x</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.x</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUT3MO"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>.x</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUTDAY"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>.x</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"N_{.col}"</span><span class='op'>)</span>,
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>transmute</span><span class='op'>(</span>
    <span class='va'>EASERVED</span>,
    <span class='va'>SAMPLE</span>,
    <span class='va'>N_SDP</span>,
    NUM_METHODS_PROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    NUM_METHODS_INSTOCK <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    NUM_METHODS_OUT3MO <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUT3MO"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>&gt;</span> <span class='fl'>0</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    MEAN_OUTDAY <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUTDAY"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ungroup</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="merging-to-household-and-female-data">Merging to Household and Female Data</h1>
<p>Consider the following female respondent dataset collected from Burkina Faso in 2017 and 2018. It contains a variable <a href="https://pma.ipums.org/pma-action/variables/FPCURRUSE">FPCURRUSE</a> indicating whether the woman is currently using a method of family planning:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>hhf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00011.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00011.dat.gz"</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>PERSONID</span>, <span class='va'>EAID</span>, <span class='va'>URBAN</span>, <span class='va'>SAMPLE</span>, <span class='va'>FPCURRUSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_na_if.html'>lbl_na_if</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='op'>~</span><span class='va'>.lbl</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='st'>"No response or missing"</span>,
        <span class='st'>"NIU (not in universe)"</span>
      <span class='op'>)</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>hhf</span>
</code></pre>
</div>
<pre><code># A tibble: 6,944 x 5
   PERSONID           EAID    URBAN                   SAMPLE FPCURRUSE
   &lt;chr&gt;             &lt;dbl&gt; &lt;int+lb&gt;                &lt;int+lbl&gt; &lt;int+lbl&gt;
 1 0762000000029022…  7620 1 [Urba… 85405 [Burkina Faso 201…  NA      
 2 0735800000017142…  7358 0 [Rura… 85405 [Burkina Faso 201…   0 [No] 
 3 0710400000020992…  7104 0 [Rura… 85405 [Burkina Faso 201…   0 [No] 
 4 0704800000014092…  7048 1 [Urba… 85405 [Burkina Faso 201…   0 [No] 
 5 0715600000020782…  7156 0 [Rura… 85405 [Burkina Faso 201…   0 [No] 
 6 0727900000021452…  7279 1 [Urba… 85405 [Burkina Faso 201…   0 [No] 
 7 0743100000024642…  7431 0 [Rura… 85405 [Burkina Faso 201…   1 [Yes]
 8 0721200000025792…  7212 0 [Rura… 85405 [Burkina Faso 201…   0 [No] 
 9 0704200000014542…  7042 1 [Urba… 85405 [Burkina Faso 201…   0 [No] 
10 0797200000013032…  7972 1 [Urba… 85405 [Burkina Faso 201…   0 [No] 
# … with 6,934 more rows</code></pre>
</div>
<p>You’ll notice that each row represents one female respondent with a unique <code>PERSONID</code> (non-respondents and other household members have been removed beforehand). We’ve also got <code>EAID</code>, which represents the enumeration area where each respondent resides; the variable <code>URBAN</code> indicates whether the enumeration area is primarily “urban” or “rural”.</p>
<p>The variable <code>SAMPLE</code> contains the same values seen in our SDP data:</p>
<ul>
<li>85405 - Burkina Faso 2017 Round 5</li>
<li>85408 - Burkina Faso 2018 Round 6</li>
</ul>
<p>When we merge, we’ll want to match each woman to both a <code>SAMPLE</code> and an <code>EASERVED</code> from the SDP data. We’ll rename <code>EASERVED</code> to match the variable <code>EAID</code> in the HHF data:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>bf_merged</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>EAID <span class='op'>=</span> <span class='va'>EASERVED</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>right_join</span><span class='op'>(</span><span class='va'>hhf</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"EAID"</span>, <span class='st'>"SAMPLE"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, each woman’s record contains all of the variables we created above summarizing the SDPs that serve her enumeration area. For example, for all sampled women living in <code>EAID == 7003</code> in 2017, the value in <code>NUM_METHODS_OUT3MO</code> shows the number of family planning methods that were out of stock with any SDP serving the woman’s enumeration area within three months prior to the survey:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>bf_merged</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>EAID</span> <span class='op'>==</span> <span class='fl'>7003</span>, <span class='va'>SAMPLE</span> <span class='op'>==</span> <span class='fl'>85405</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>PERSONID</span>, <span class='va'>EAID</span>, <span class='va'>SAMPLE</span>, <span class='va'>NUM_METHODS_OUT3MO</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 55 x 4
   PERSONID             EAID                  SAMPLE NUM_METHODS_OUT3…
   &lt;chr&gt;            &lt;dbl+lb&gt;               &lt;int+lbl&gt;             &lt;int&gt;
 1 070030000001973…     7003 85405 [Burkina Faso 20…                 0
 2 070030000001973…     7003 85405 [Burkina Faso 20…                 0
 3 070030000002640…     7003 85405 [Burkina Faso 20…                 0
 4 070030000001075…     7003 85405 [Burkina Faso 20…                 0
 5 070030000001609…     7003 85405 [Burkina Faso 20…                 0
 6 070030000000835…     7003 85405 [Burkina Faso 20…                 0
 7 070030000001273…     7003 85405 [Burkina Faso 20…                 0
 8 070030000000527…     7003 85405 [Burkina Faso 20…                 0
 9 070030000002561…     7003 85405 [Burkina Faso 20…                 0
10 070030000002391…     7003 85405 [Burkina Faso 20…                 0
# … with 45 more rows</code></pre>
</div>
<p>You’ll notice that 55 women were surveyed in <code>EAID</code> 7003 in 2017, and each one has the same value (0) for <code>NUM_METHODS_OUT3MO</code>.</p>
<p>We’ll dig deeper into the types of research questions that our new combined dataset can answer in our upcoming Data Analysis post. For now, take a look at the apparent relationship between <code>FPCURRUSE</code> and <code>NUM_METHODS_OUT3MO</code> for all of the women with non-missing responses for both variables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>bf_merged</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>FPCURRUSE</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>NUM_METHODS_OUT3MO</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>NUM_METHODS_OUT3MO</span> <span class='op'>&gt;</span> <span class='fl'>0</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>FPCURRUSE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>pct <span class='op'>=</span> <span class='va'>n</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 4
# Groups:   NUM_METHODS_OUT3MO &gt; 0 [2]
  `NUM_METHODS_OUT3MO &gt; 0` FPCURRUSE     n   pct
  &lt;lgl&gt;                    &lt;int+lbl&gt; &lt;int&gt; &lt;dbl&gt;
1 FALSE                      0 [No]   2721 0.648
2 FALSE                      1 [Yes]  1475 0.352
3 TRUE                       0 [No]   1124 0.700
4 TRUE                       1 [Yes]   482 0.300</code></pre>
</div>
<p>Notably, among those respondents living in an enumeration area that experienced zero stockouts within the 3 months prior to the SDP survey, 35% indicated that they were actively using a family planning method. Compare that to the set of respondents living in an area where at least one method was out of stock during the same time period: only 30% were using a family planning method.</p>
<p>While a 5% difference may or may not prove to be statistically significant under further analysis, it’s not entirely surprising that the reliable availability of contraceptive methods from service providers might influence the contraceptive prevalence rate among women in a given area.</p>
<p>As always, let us know what kinds of questions about fertility and family planning you’re answering with data merged from service providers!</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
