<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

<style>
  div.csl-bib-body { }
  div.csl-entry {
    clear: both;
    }
  .hanging div.csl-entry {
    margin-left:2em;
    text-indent:-2em;
  }
  div.csl-left-margin {
    min-width:2em;
    float:left;
  }
  div.csl-right-inline {
    margin-left:2em;
    padding-left:1em;
  }
  div.csl-indent {
    margin-left: 2em;
  }
</style>

  <!--radix_placeholder_meta_tags-->
  <title>Contraceptive Calendar Data in PMA Panel Surveys</title>

  <meta property="description" itemprop="description" content="PMA panel members report their contraceptive use, reasons for discontinuation, and pregnancy status for each month leading up to the Female Questionnaire. Here&#39;s how to get up and running with your first Time-to-Event analysis."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-05-15"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-05-15"/>
  <meta name="article:author" content="Matt Gunther"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Contraceptive Calendar Data in PMA Panel Surveys"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="PMA panel members report their contraceptive use, reasons for discontinuation, and pregnancy status for each month leading up to the Female Questionnaire. Here&#39;s how to get up and running with your first Time-to-Event analysis."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Contraceptive Calendar Data in PMA Panel Surveys"/>
  <meta property="twitter:description" content="PMA panel members report their contraceptive use, reasons for discontinuation, and pregnancy status for each month leading up to the Female Questionnaire. Here&#39;s how to get up and running with your first Time-to-Event analysis."/>

  <!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","bibliography","categories","output"]}},"value":[{"type":"character","attributes":{},"value":["Contraceptive Calendar Data in PMA Panel Surveys"]},{"type":"character","attributes":{},"value":["PMA panel members report their contraceptive use, reasons for discontinuation, and pregnancy status for each month leading up to the Female Questionnaire. Here's how to get up and running with your first Time-to-Event analysis.    \n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["2022-05-15"]},{"type":"character","attributes":{},"value":["cites.bib"]},{"type":"character","attributes":{},"value":["Panel Data","Contraceptive Calendar","Data Analysis","Survival Analysis","survival","ggplot2"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["cites.bib","data/bad_cals.csv","data/cals_check.Rmd","data/cals.csv","data/pma_00101.dat.gz","data/pma_00101.xml","data/pma_00107.dat.gz","data/pma_00107.xml","data/pma_00108.dat.gz","data/pma_00108.xml","data/pma_00109.dat.gz","data/pma_00109.xml","data/pma_00110.dat.gz","data/pma_00110.xml","data/pma_00111.dat.gz","data/pma_00111.xml","data/resources/cal-reliability.pdf","data/resources/dana-caption.png","data/resources/dana-diagram.png","data/resources/dhs-cal-indicators.png","images/startmo.png","images/universe.png","images/vargroup.png","phase2-calendar_files/anchor-4.2.2/anchor.min.js","phase2-calendar_files/bowser-1.9.3/bowser.min.js","phase2-calendar_files/distill-2.2.21/template.v2.js","phase2-calendar_files/figure-html5/unnamed-chunk-37-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-38-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-39-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-40-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-41-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-45-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-46-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-47-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-48-1.png","phase2-calendar_files/figure-html5/unnamed-chunk-49-1.png","phase2-calendar_files/header-attrs-2.11/header-attrs.js","phase2-calendar_files/jquery-3.6.0/jquery-3.6.0.js","phase2-calendar_files/jquery-3.6.0/jquery-3.6.0.min.js","phase2-calendar_files/jquery-3.6.0/jquery-3.6.0.min.map","phase2-calendar_files/popper-2.6.0/popper.min.js","phase2-calendar_files/tippy-6.2.7/tippy-bundle.umd.min.js","phase2-calendar_files/tippy-6.2.7/tippy-light-border.css","phase2-calendar_files/tippy-6.2.7/tippy.css","phase2-calendar_files/tippy-6.2.7/tippy.umd.min.js","phase2-calendar_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="phase2-calendar_files/header-attrs-2.14/header-attrs.js"></script>
  <script src="phase2-calendar_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="phase2-calendar_files/popper-2.6.0/popper.min.js"></script>
  <link href="phase2-calendar_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="phase2-calendar_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="phase2-calendar_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="phase2-calendar_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="phase2-calendar_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="phase2-calendar_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="phase2-calendar_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Contraceptive Calendar Data in PMA Panel Surveys","description":"PMA panel members report their contraceptive use, reasons for discontinuation, and pregnancy status for each month leading up to the Female Questionnaire. Here's how to get up and running with your first Time-to-Event analysis.","authors":[{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-05-15T00:00:00.000-05:00","citationText":"Gunther, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Contraceptive Calendar Data in PMA Panel Surveys</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">Panel Data</div>
<div class="dt-tag">Contraceptive Calendar</div>
<div class="dt-tag">Data Analysis</div>
<div class="dt-tag">Survival Analysis</div>
<div class="dt-tag">survival</div>
<div class="dt-tag">ggplot2</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>PMA panel members report their contraceptive use, reasons for
discontinuation, and pregnancy status for each month leading up to the
Female Questionnaire. Here’s how to get up and running with your first
Time-to-Event analysis.</p></p>
</div>

<div class="d-byline">
  Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>2022-05-15
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#setup" id="toc-setup">Setup</a></li>
<li><a href="#century-month-codes-cmc"
id="toc-century-month-codes-cmc">Century Month Codes (CMC)</a></li>
<li><a href="#merging-country-calendars"
id="toc-merging-country-calendars">Merging Country Calendars</a>
<ul>
<li><a href="#start-and-stop-dates" id="toc-start-and-stop-dates">Start
and Stop Dates</a></li>
<li><a href="#pivot-country-calendars"
id="toc-pivot-country-calendars">Pivot Country Calendars</a></li>
</ul></li>
<li><a href="#data-availability" id="toc-data-availability">Data
Availability</a></li>
<li><a href="#splitting-months-into-columns"
id="toc-splitting-months-into-columns">Splitting months into
columns</a></li>
<li><a href="#analysis" id="toc-analysis">Analysis</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>We’re wrapping up our introduction to the new <a
href="../../index.html#category:Panel_Data">PMA Panel Surveys</a> this
week with an update to a topic we first introduced <a
href="../2021-05-15-paa-2021/">one year ago</a> when <a
href="https://pma.ipums.org/pma/">IPUMS PMA</a> released Phase 1 data
from Burkina Faso, DRC, Kenya, and Nigeria. With the release of Phase 2
data from these countries this spring, it’s now possible to combine
monthly <a
href="https://pma.ipums.org/pma-action/variables/group?id=fem_cal">contraceptive
calendar</a> data collected at multiple timepoints, each covering
partially overlapping periods in the reproductive health history of
every panel member.</p>
<p>The contraceptive calendar data are particularly exciting because
they offer researchers an opportunity to explore longitudinal analysis
techniques that are otherwise not feasible with the first two phases of
panel observations. For example, we’ll demonstrate how you might use <a
href="https://github.com/therneau/survival">survival analysis</a> to
test whether women with <a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">unmet
need</a> or <a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">plans
to adopt</a> a family planning method at Phase 1 were quicker to begin
using one in the months between Phase 1 and Phase 2. Additionally,
because calendar data are collected once <em>per phase</em>, there are
unique opportunities to study the reliability of self-reporting for the
same month recalled at different times <span class="citation"
data-cites="Anglewicz2022-mx">(<a href="#ref-Anglewicz2022-mx"
role="doc-biblioref">Anglewicz et al. 2022</a>)</span>.</p>
<aside>
Newcomers to the <strong>contraceptive calendar</strong> should check
out our <a href="..//2021-05-15-paa-2021/">previous blog post</a>,
including video from a workshop from the <a
href="https://www.populationassociation.org/paa-2021/home">2021
Population Association of America</a> annual meeting.
</aside>
<p>In this post, we’ll share code you can use to parse and analyze
calendar data collected in each phase in a data extract containing
multiple samples. We’ll use the <a
href="https://github.com/therneau/survival">survival</a> package for R
to model “time-to-event” for adoption of a family planning method for
women who were not using one on the day of the Phase 1 interview.
Finally, we’ll use <a
href="https://ggplot2.tidyverse.org/index.html">ggplot2</a> to build a
Kaplan-Meier curve for the cumulative incidence of adoption over each
month between the Phase 1 and Phase 2 interviews.</p>
<h1 id="setup">Setup</h1>
<p>Over on the contraceptive calendar <a
href="https://pma.ipums.org/pma-action/variables/group/fem_cal">variable
group page</a>, you’ll find two types of calendars for every sample:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/vargroup.png" width="1121" /></p>
</div>
<p>We refer to the main calendar as the “contraceptive calendar”, and it
includes the following variables:</p>
<ul>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARBF#codes_section">CALENDARBF</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARCD#codes_section">CALENDARCD</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARKE#codes_section">CALENDARKE</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARNG#codes_section">CALENDARNG</a></li>
</ul>
<p>This calendar represents contraceptive use, pregnancy, pregnancy
termination, and birth information for each month preceding the
interview for the Female Questionnaire in a particular phase of the
panel study. Women are asked to recall their status for each month in
the calendar period, and their responses are recorded in a single comma
delimited string with the following codes:</p>
<ul>
<li><code>B</code> - Birth</li>
<li><code>P</code> - Pregnant</li>
<li><code>T</code> - Pregnancy ended</li>
<li><code>0</code> - No family planning method used</li>
<li><code>1</code> - Female Sterilization</li>
<li><code>2</code> - Male Sterilization</li>
<li><code>3</code> - Implant</li>
<li><code>4</code> - IUD</li>
<li><code>5</code> - Injectables</li>
<li><code>7</code> - Pill</li>
<li><code>8</code> - Emergency Contraception</li>
<li><code>9</code> - Male Condom</li>
<li><code>10</code> - Female Condom</li>
<li><code>11</code> - Diaphragm</li>
<li><code>12</code> - Foam / Jelly</li>
<li><code>13</code> - Standard Days / Cycle beads</li>
<li><code>14</code> - LAM</li>
<li><code>30</code> - Rhythm method</li>
<li><code>31</code> - Withdrawal</li>
<li><code>39</code> - Other traditional methods</li>
</ul>
<p>The second calendar is the “discontinuation calendar”, and it gives
the reason why a woman stopped using a family planning method for each
month following an episode of continuous use. This calendar is
represented by the following variables:</p>
<ul>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARBFWHY#codes_section">CALENDARBFWHY</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARCDWHY#codes_section">CALENDARCDWHY</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARKEWHY#codes_section">CALENDARKEWHY</a></li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CALENDARNGWHY#codes_section">CALENDARNGWHY</a></li>
</ul>
<p>Like the main contraceptive calendar, the discontinuation calendar is
a single comma delimited string. It contains the following codes for
months when a method was discontinued (and is blank otherwise):</p>
<ul>
<li><code>1</code> - Infrequent sex / husband away</li>
<li><code>2</code> - Became pregnant while using</li>
<li><code>3</code> - Wanted to become pregnant</li>
<li><code>4</code> - Husband / partner disapproved</li>
<li><code>5</code> - Wanted more effective method</li>
<li><code>6</code> - Side effects / health concerns</li>
<li><code>7</code> - Lack of access / too far</li>
<li><code>8</code> - Costs too much</li>
<li><code>9</code> - Inconvenient to use</li>
<li><code>10</code> - Up to God / fatalistic</li>
<li><code>11</code> - Difficult to get pregnant / menopausal</li>
<li><code>12</code> - Marital dissolution / separation</li>
<li><code>96</code> - Other</li>
</ul>
<p>We’ve created a data extract containing all of the eight calendar
variables, plus these additional variables that we’ll need for our
analysis:</p>
<ul>
<li><a
href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a>
- Result of female questionnaire</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a>
- Unique ID for female questionnaire</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a>
- Household residence / membership</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a>
- Country of residence</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/INTFQMON#codes_section">INTFQMON</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/INTFQYEAR#codes_section">INTFQYEAR</a>
- Date of Female Questionnaire interview</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>
- Most effective current family planning method (recoded<a href="#fn1"
class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a>)</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>
- Current pregnancy status</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a>
- Total unmet need</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a>
- When will start using FP method in the future - value</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a>
- When will start using FP method in the future - unit</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/KID1STBIRTHMO#codes_section">KID1STBIRTHMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/KID1STBIRTHYR#codes_section">KID1STBIRTHYR</a>
- Date of first childbirth</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/LASTBIRTHMO#codes_section">LASTBIRTHMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/LASTBIRTHYR#codes_section">LASTBIRTHYR</a>
- Date of most recent childbirth</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PANELBIRTHMO#codes_section">PANELBIRTHMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/PANELBIRTHYR#codes_section">PANELBIRTHYR</a>
- Date of childbirth during the panel study</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/OTHERBIRTHMO#codes_section">OTHERBIRTHMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/OTHERBIRTHYR#codes_section">OTHERBIRTHYR</a>
- Date of any other childbirth during the calendar period</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PREGENDMO#codes_section">PREGENDMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/PREGENDYR#codes_section">PREGENDYR</a>
- Date of most recent pregnancy termination (miscarriage, abortion, or
stillbirth)</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PANELPREGENDMO#codes_section">PANELPREGENDMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/PANELPREGENDYR#codes_section">PANELPREGENDYR</a>
- Date of pregnancy termination during the panel study (miscarriage,
abortion, or stillbirth)</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPBEGINUSEMO#codes_section">FPBEGINUSEMO</a>
&amp; <a
href="https://pma.ipums.org/pma-action/variables/FPBEGINUSEYR#codes_section">FPBEGINUSEYR</a>
- Date of adoption for currently used family planning method</li>
</ul>
<p>Our extract contains data from all available longitudinal samples.<a
href="#fn2" class="footnote-ref" id="fnref2"
role="doc-noteref"><sup>2</sup></a> As in <a
href="../2022-03-15-phase2-formats/index.html">previous posts</a>, we’ve
selected “Female Respondents” organized in wide format: <strong>each
row</strong> represents the Phase 1 and Phase 2 responses for
<strong>one female respondent</strong>. Variables from the Phase 1
questionnaire are named with the suffix <code>_1</code>
(e.g. <code>CALENDARKE_1</code>), while variables from the Phase 2
questionnaire are named with the suffix <code>_2</code>
(e.g. <code>CALENDARKE_2</code>).</p>
<p>We’ll load the data extract into R together with each of the packages
we’ll feature in this post. Then, we’ll drop cases for women who did not
fully complete the Female Questionnaire or were not members of the
<em>de facto</em> population in both phases.</p>
<p>Finally, we’ll modify two variables to make this post a bit easier to
read. First, we’ll transform <a
href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a>
into a <a
href="https://forcats.tidyverse.org/reference/as_factor.html">factor</a>
containing a two-letter ISO country code for each sample.<a href="#fn3"
class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>
Second, we’ll generate a short ID for each woman based on her location
in the dataframe: <strong>this is for display purposes only</strong> -
we recommend that users adopt <a
href="https://pma.ipums.org/pma-action/variables/FQINSTID#codes_section">FQINSTID</a>
for their own analyses.</p>
<aside>
Note: there are two regionally representative samples each from DRC and
Nigeria. We’ll combine samples from the same country here, as both use
the same variables for the contraceptive calendar.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>

<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00111.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00111.dat.gz"</span>
<span class='op'>)</span> 

<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='va'>RESULTFQ_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>RESULTFQ_2</span> <span class='op'>==</span> <span class='fl'>1</span>, 
    <span class='va'>RESIDENT_1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11</span>, <span class='fl'>22</span><span class='op'>)</span> <span class='op'>&amp;</span> 
      <span class='va'>RESIDENT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11</span>, <span class='fl'>22</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>COUNTRY <span class='op'>=</span> <span class='va'>COUNTRY</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>as_factor</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/recode.html'>recode</a></span><span class='op'>(</span>
    <span class='st'>"Burkina Faso"</span> <span class='op'>=</span> <span class='st'>"BF"</span>,
    <span class='st'>"Congo, Democratic Republic"</span> <span class='op'>=</span> <span class='st'>"CD"</span>,
    <span class='st'>"Kenya"</span> <span class='op'>=</span> <span class='st'>"KE"</span>,
    <span class='st'>"Nigeria"</span> <span class='op'>=</span> <span class='st'>"NG"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/rownames.html'>rowid_to_column</a></span><span class='op'>(</span><span class='st'>"ID"</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
<div class="layout-chunk" data-layout="l-body">
<div>
<a href="https://github.com/therneau/survival">
<img src="../../images/hex/survival.png"/>
</a>
© Terry M. Therneau et al. (LGPL &gt;=2)
</div>
</div>
</aside>
<div class="layout-chunk" data-layout="l-body">

</div>
<h1 id="century-month-codes-cmc">Century Month Codes (CMC)</h1>
<p>As shown above, we’ll be referencing several variables representing
<strong>dates</strong> in this post. Generally, IPUMS PMA publishes
every date with two variables: one representing the month (e.g. <a
href="https://pma.ipums.org/pma-action/variables/INTFQMON#codes_section">INTFQMON</a>)
and one representing the year (e.g. <a
href="https://pma.ipums.org/pma-action/variables/INTFQYEAR#codes_section">INTFQYEAR</a>).
Sometimes, you’ll notice a third variable representing dates with a
<strong>century month code (CMC)</strong>: each CMC represents the
number of months that have passed between a given date and January 1900.
CMC dates are particularly useful for calculating the time between
events because they replace two variables (with different units) with
one simple integer.</p>
<p>Some CMC variables are available directly from IPUMS PMA (e.g. <a
href="https://pma.ipums.org/pma-action/variables/INTFQCMC#codes_section">INTFQCMC</a>),
but we’ll create our own CMC variables for all of the dates we’ll
reference in this post. CMC dates are simply calculated as follows:</p>
<p><span class="math display">\[CMC = Month + 12*(Year –
1900)\]</span></p>
<p>Because all or part of a date may be <strong>missing</strong> (the
month or year), and because certain dates may be <strong>NIU (not in
universe)</strong> (e.g. “date of most recent childbirth” for women who
have never given birth), we’ll need to consider specific circumstances
where we should use the value <code>NA</code> in a CMC variable.</p>
<p>In the contraceptive calendar, we’ll be measuring the time between
events in <em>months</em>. Therefore, it would be insufficient to
include cases where a woman only reported the <em>year</em> in which an
event occurred. We’ll create a function that generates <code>NA</code>
values if the numeric code representing a month is <code>90</code> or
higher (all valid months are coded 1 through 12), and if a year is
<code>9000</code> or higher (all valid years are in the 1900s or 2000s).
Otherwise, we’ll use the CMC formula to calculate the appropriate CMC
value for each date.</p>
<div>
<p>Let’s call this function <code>make_cmc</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>make_cmc</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>mo</span>, <span class='va'>yr</span><span class='op'>)</span><span class='op'>{</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span><span class='va'>mo</span> <span class='op'>&lt;</span> <span class='fl'>90</span> <span class='op'>&amp;</span> <span class='va'>yr</span> <span class='op'>&lt;</span> <span class='fl'>9000</span> <span class='op'>~</span> <span class='va'>mo</span> <span class='op'>+</span> <span class='fl'>12</span><span class='op'>*</span><span class='op'>(</span><span class='va'>yr</span> <span class='op'>-</span> <span class='fl'>1900</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
</div>
<aside>
With <a
href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a>,
any “case” not explicitly covered by
<code>mo &lt; 90 &amp; yr &lt; 9000</code> is assigned the value
<code>NA</code>.
</aside>
<p>You can apply <code>make_cmc</code> to any combination of variables
representing the month and year for a date. We’ll create one
<code>CMC</code> for each date in our data extract.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    INTFQCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>INTFQMON_1</span>, <span class='va'>INTFQYEAR_1</span><span class='op'>)</span>,
    INTFQCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>INTFQMON_2</span>, <span class='va'>INTFQYEAR_2</span><span class='op'>)</span>,
    KID1STBIRTHCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>KID1STBIRTHMO_1</span>, <span class='va'>KID1STBIRTHYR_1</span><span class='op'>)</span>,
    KID1STBIRTHCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>KID1STBIRTHMO_2</span>, <span class='va'>KID1STBIRTHYR_2</span><span class='op'>)</span>,
    LASTBIRTHCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>LASTBIRTHMO_1</span>, <span class='va'>LASTBIRTHYR_1</span><span class='op'>)</span>,
    LASTBIRTHCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>LASTBIRTHMO_2</span>, <span class='va'>LASTBIRTHYR_2</span><span class='op'>)</span>,
    OTHERBIRTHCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>OTHERBIRTHMO_1</span>, <span class='va'>OTHERBIRTHYR_1</span><span class='op'>)</span>,
    OTHERBIRTHCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>OTHERBIRTHMO_2</span>, <span class='va'>OTHERBIRTHYR_2</span><span class='op'>)</span>,
    PANELBIRTHCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PANELBIRTHMO_1</span>, <span class='va'>PANELBIRTHYR_1</span><span class='op'>)</span>,
    PANELBIRTHCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PANELBIRTHMO_2</span>, <span class='va'>PANELBIRTHYR_2</span><span class='op'>)</span>,
    PREGENDCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PREGENDMO_1</span>, <span class='va'>PREGENDYR_1</span><span class='op'>)</span>,
    PREGENDCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PREGENDMO_2</span>, <span class='va'>PREGENDYR_2</span><span class='op'>)</span>,
    PANELPREGENDCMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PANELPREGENDMO_1</span>, <span class='va'>PANELPREGENDYR_1</span><span class='op'>)</span>,
    PANELPREGENDCMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>PANELPREGENDMO_2</span>, <span class='va'>PANELPREGENDYR_2</span><span class='op'>)</span>,
    FPBEGINUSECMC_1 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>FPBEGINUSEMO_1</span>, <span class='va'>FPBEGINUSEYR_1</span><span class='op'>)</span>,
    FPBEGINUSECMC_2 <span class='op'>=</span> <span class='fu'>make_cmc</span><span class='op'>(</span><span class='va'>FPBEGINUSEMO_2</span>, <span class='va'>FPBEGINUSEYR_2</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Let’s check our work. For example, consider how we’ve handled
<code>PANELBIRTHCMC_2</code> - the date of a woman’s childbirth that
happened during the panel study. If we count the dates by
<code>PANELBIRTHMO_2</code> and use <a
href="https://rdrr.io/r/utils/head.html">tail</a> to examine the last
few rows, we see that one woman reported code <code>97</code> indicating
that she did not know the precise month of birth. Meanwhile, there were
15,064 cases coded <code>99</code> indicating that they were <strong>NIU
(not in universe)</strong> (no birth occurred during the panel study).
We’ve coded both of these case types with the value <code>NA</code>; all
other values follow the CMC formula to count the number of months
between January 1900 and the month of birth.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>PANELBIRTHMO_2</span>, <span class='va'>PANELBIRTHYR_2</span>, <span class='va'>PANELBIRTHCMC_2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>tail</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 × 4
              PANELBIRTHMO_2               PANELBIRTHYR_2 PANELBIRTHCMC_2     n
                   &lt;int+lbl&gt;                    &lt;int+lbl&gt;           &lt;dbl&gt; &lt;int&gt;
1 12 [December]              2017                                    1416     1
2 12 [December]              2018                                    1428    13
3 12 [December]              2019                                    1440    99
4 12 [December]              2020                                    1452    90
5 97 [Don&#39;t know]            2017                                      NA     1
6 99 [NIU (not in universe)] 9999 [NIU (not in universe)]              NA 15064</code></pre>
</div>
<h1 id="merging-country-calendars">Merging Country Calendars</h1>
<p>You may be wondering: why does IPUMS PMA publish a separate calendar
variable for <em>each country</em>?</p>
<p>In fact, the width of each calendar variable differs by the number of
months women were asked to recall in a particular sample. This, in turn,
depends on the range of dates in which women were interviewed for the
Female Questionnaire in a particular phase.</p>
<h2 id="start-and-stop-dates">Start and Stop Dates</h2>
<p>You can find the precise range of dates included in each calendar on
the <a
href="https://pma.ipums.org/pma-action/variables/CALENDARKE#universe_section">description
tab</a> for each country’s calendar variable.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/startmo.png" width="1121" /></p>
</div>
<p>The first month in each country’s calendar is listed below:</p>
<table>
<thead>
<tr class="header">
<th>Country</th>
<th>Phase 1</th>
<th>Phase 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Burkina Faso</td>
<td>Jan 2018</td>
<td>Jan 2018</td>
</tr>
<tr class="even">
<td>DRC</td>
<td>Jan 2017</td>
<td>Jan 2018</td>
</tr>
<tr class="odd">
<td>Kenya</td>
<td>Jan 2017</td>
<td>Jan 2018</td>
</tr>
<tr class="even">
<td>Nigeria</td>
<td>Jan 2017</td>
<td>Jan 2018</td>
</tr>
</tbody>
</table>
<p>Before we can merge calendars for multiple samples, we’ll need to
determine the correct beginning and ending points for each woman’s
calendar. First, we’ll create <code>CALSTART_1</code> and
<code>CALSTART_2</code> to record the CMC date for the first month.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    CALSTART_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>COUNTRY</span> <span class='op'>==</span> <span class='st'>"BF"</span>, <span class='fl'>2018</span>, <span class='fl'>2017</span><span class='op'>)</span>,
    CALSTART_2 <span class='op'>=</span> <span class='fl'>2018</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>CALSTART_1</span>, <span class='va'>CALSTART_2</span><span class='op'>)</span>, <span class='op'>~</span><span class='fl'>12</span><span class='op'>*</span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>-</span> <span class='fl'>1900</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Next, we’ll create <code>CALSTOP_1</code> and <code>CALSTOP_2</code>
to record the CMC date we created in <code>INTFQCMC_1</code> and
<code>INTFQCMC_2</code>. These dates cover a range of months in each
sample.</p>
<table>
<thead>
<tr class="header">
<th>Country</th>
<th>Phase 1</th>
<th>Phase 2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Burkina Faso</td>
<td>Dec 2019 - Mar 2020</td>
<td>Dec 2020 - Apr 2021</td>
</tr>
<tr class="even">
<td>DRC</td>
<td>Dec 2019 - Feb 2020</td>
<td>Dec 2020 - Mar 2021</td>
</tr>
<tr class="odd">
<td>Kenya</td>
<td>Nov 2019 - Dec 2019</td>
<td>Nov 2020 - Dec 2020</td>
</tr>
<tr class="even">
<td>Nigeria</td>
<td>Dec 2019 - Jan 2020</td>
<td>Dec 2020 - Feb 2021</td>
</tr>
</tbody>
</table>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    CALSTOP_1 <span class='op'>=</span> <span class='va'>INTFQCMC_1</span>,
    CALSTOP_2 <span class='op'>=</span> <span class='va'>INTFQCMC_2</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, let’s take a look at the calendar variables we want to merge.
You’ll only find responses in the calendar for the country in which a
woman resides. The other calendars in her row will appear as an empty
character string, the value <code>""</code>. For example, notice that
the variable <code>CALENDARKE_1</code> is blank for these women from
Burkina Faso:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>COUNTRY</span> <span class='op'>==</span> <span class='st'>"BF"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>COUNTRY</span>, <span class='va'>CALENDARBF_1</span>, <span class='va'>CALENDARKE_1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5,208 × 4
      ID COUNTRY CALENDARBF_1                                       CALENDARKE_1
   &lt;int&gt; &lt;fct&gt;   &lt;chr+lbl&gt;                                          &lt;chr+lbl&gt;   
 1     1 BF      ,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P,P,P,P,P,P… &quot;&quot;          
 2     2 BF      ,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,0,3,3,3,3,3,… &quot;&quot;          
 3     3 BF      ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,… &quot;&quot;          
 4     4 BF      ,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5,5,5,5,5,0,0,0,0,0,… &quot;&quot;          
 5     5 BF      ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,… &quot;&quot;          
 6     6 BF      ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,… &quot;&quot;          
 7     7 BF      ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,T,P,P,P,P,P,… &quot;&quot;          
 8     8 BF      ,,,,,,,,,,,B,P,P,P,P,P,P,P,P,P,0,0,0,0,0,0,0,0,0,… &quot;&quot;          
 9     9 BF      ,,,,,,,,,,,,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3… &quot;&quot;          
10    10 BF      ,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,… &quot;&quot;          
# … with 5,198 more rows</code></pre>
</div>
<h2 id="pivot-country-calendars">Pivot Country Calendars</h2>
<p>We’ll want to use <a
href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>
to reformat <code>dat</code> so that <em>each calendar variable appears
in a separate row</em>, including calendars collected in different
phases of the panel study. Let’s call our reformatted data frame
<code>cals</code>. For now, it will only include <code>ID</code>,
<code>COUNTRY</code>, and all variables that start with
<code>CAL</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>COUNTRY</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"CAL"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We’ll “pivot” <code>cals</code> in two steps. First, we’ll strip the
numeric suffix from each calendar variable: we’ll store this information
in a new column called <code>PHASE</code>. All of the calendar variables
from the same phase will then be stored in a separate row (resulting in
two rows per woman).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"CAL"</span><span class='op'>)</span>,
    names_pattern <span class='op'>=</span> <span class='st'>"(.*)_(.*)"</span>,
    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".value"</span>, <span class='st'>"PHASE"</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 35,424 × 13
      ID COUNTRY PHASE CALENDARBF         CALENDARBFWHY CALENDARKE CALENDARKEWHY
   &lt;int&gt; &lt;fct&gt;   &lt;chr&gt; &lt;chr+lbl&gt;          &lt;chr+lbl&gt;     &lt;chr+lbl&gt;  &lt;chr+lbl&gt;    
 1     1 BF      1     &quot;,,,,,,,,,,0,0,0,… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 2     1 BF      2     &quot;,,,,,,,,,,,3,3,3… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 3     2 BF      1     &quot;,,,,,,,,,,,P,P,P… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 4     2 BF      2     &quot;,,,,,,,,,,,,5,5,… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 5     3 BF      1     &quot;,,,,,,,,,,,0,0,0… &quot;&quot;            &quot;&quot;         &quot;&quot;           
 6     3 BF      2     &quot;&quot;                 &quot;&quot;            &quot;&quot;         &quot;&quot;           
 7     4 BF      1     &quot;,,,,,,,,,,,0,0,0… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 8     4 BF      2     &quot;,,,,,,,,,,,,0,0,… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
 9     5 BF      1     &quot;,,,,,,,,,,,0,0,0… &quot;,,,,,,,,,,,… &quot;&quot;         &quot;&quot;           
10     5 BF      2     &quot;&quot;                 &quot;&quot;            &quot;&quot;         &quot;&quot;           
# … with 35,414 more rows, and 6 more variables: CALENDARNG &lt;chr+lbl&gt;,
#   CALENDARNGWHY &lt;chr+lbl&gt;, CALENDARCD &lt;chr+lbl&gt;, CALENDARCDWHY &lt;chr+lbl&gt;,
#   CALSTART &lt;dbl&gt;, CALSTOP &lt;dbl&gt;</code></pre>
</div>
<p>Before we “pivot” a second time, we’ll want to identify suffixes that
we can again strip and use as new column names (just as we did with
<code>_1</code> and <code>_2</code> when we created <code>PHASE</code>).
Let’s use <code>FPSTATUS</code> for the main contraceptive calendar, and
<code>WHYSTOP</code> for the discontinuation calendar. When we <a
href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>
again, these suffixes will appear as two new columns containing each
type of calendar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename_with</a></span><span class='op'>(</span>
    <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='st'>"FPSTATUS"</span><span class='op'>)</span>,
    .cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"CALENDAR"</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"WHY"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename_with</a></span><span class='op'>(</span>
    <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='st'>"STOP"</span><span class='op'>)</span>,
    .cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"CALENDAR"</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"WHY"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"CALENDAR"</span><span class='op'>)</span>,
    names_pattern <span class='op'>=</span> <span class='st'>"CALENDAR(..)(.*)"</span>,
    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"COUNTRY_CAL"</span>, <span class='st'>".value"</span><span class='op'>)</span>,
    values_to <span class='op'>=</span> <span class='st'>"CALENDAR_STRING"</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Now, each woman occupies eight rows (4 country calendars per phase).
We’ve also stripped the 2-letter country code from each calendar name to
create <code>COUNTRY_CAL</code>: this indicates the country associated
with each calendar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 141,696 × 8
      ID COUNTRY PHASE CALSTART CALSTOP COUNTRY_CAL FPSTATUS             WHYSTOP
   &lt;int&gt; &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;       &lt;chr+lbl&gt;            &lt;chr+l&gt;
 1     1 BF      1         1417    1442 BF          &quot;,,,,,,,,,,0,0,0,0,… &quot;,,,,,…
 2     1 BF      1         1417    1442 KE          &quot;&quot;                   &quot;&quot;     
 3     1 BF      1         1417    1442 NG          &quot;&quot;                   &quot;&quot;     
 4     1 BF      1         1417    1442 CD          &quot;&quot;                   &quot;&quot;     
 5     1 BF      2         1417    1453 BF          &quot;,,,,,,,,,,,3,3,3,3… &quot;,,,,,…
 6     1 BF      2         1417    1453 KE          &quot;&quot;                   &quot;&quot;     
 7     1 BF      2         1417    1453 NG          &quot;&quot;                   &quot;&quot;     
 8     1 BF      2         1417    1453 CD          &quot;&quot;                   &quot;&quot;     
 9     2 BF      1         1417    1441 BF          &quot;,,,,,,,,,,,P,P,P,P… &quot;,,,,,…
10     2 BF      1         1417    1441 KE          &quot;&quot;                   &quot;&quot;     
# … with 141,686 more rows</code></pre>
</div>
<p>Lastly, we can drop any row where <code>COUNTRY</code> does not match
the value in <code>COUNTRY_CAL</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>COUNTRY_CAL</span> <span class='op'>==</span> <span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>COUNTRY_CAL</span><span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 35,424 × 7
      ID COUNTRY PHASE CALSTART CALSTOP FPSTATUS                         WHYSTOP
   &lt;int&gt; &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr+lbl&gt;                        &lt;chr+l&gt;
 1     1 BF      1         1417    1442 &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,… &quot;,,,,,…
 2     1 BF      2         1417    1453 &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0… &quot;,,,,,…
 3     2 BF      1         1417    1441 &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0… &quot;,,,,,…
 4     2 BF      2         1417    1453 &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,… &quot;,,,,,…
 5     3 BF      1         1417    1441 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0… &quot;&quot;     
 6     3 BF      2         1417    1453 &quot;&quot;                               &quot;&quot;     
 7     4 BF      1         1417    1441 &quot;,,,,,,,,,,,0,0,0,5,5,5,5,5,5,5… &quot;,,,,,…
 8     4 BF      2         1417    1452 &quot;,,,,,,,,,,,,0,0,0,0,0,0,0,0,0,… &quot;,,,,,…
 9     5 BF      1         1417    1441 &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0… &quot;,,,,,…
10     5 BF      2         1417    1453 &quot;&quot;                               &quot;&quot;     
# … with 35,414 more rows</code></pre>
</div>
<p>We’re nearly ready to split each string into more usable variables
for our analysis. But, before we do so: you might notice that there are
still some calendars represented by empty character strings
<code>""</code> (see <code>FPSTATUS</code> in rows 6 and 10 above).
These are cases where calendar data are not available.</p>
<h1 id="data-availability">Data Availability</h1>
<p>There are two reasons why a woman’s calendar might be
unavailable.</p>
<p>First, these women might be <strong>NIU (not in universe)</strong>,
as described on the IPUMS PMA <a
href="https://pma.ipums.org/pma-action/variables/CALENDARKE#universe_section">universe
tab</a> for each country’s contraceptive calendar. Generally, NIU cases
are women who reported no qualifying event during the calendar period: a
blank string could indicate that she was never pregnant and never
adopted or discontinued a family planning method in any month during
that period.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/universe.png" width="1134" /></p>
</div>
<aside>
The <strong>universe tab</strong> explains why some cases are
<strong>NIU (not in universe)</strong>.
</aside>
<p>Second, a blank might reflect <strong>missing</strong> data, like the
duration of a pregnancy or an episode of continuous contraceptive use.
Contraceptive calendars <strong>do not contain missing values for
individual months</strong>, so you’ll find the complete calendar missing
if data from any one month was missing.</p>
<p>Currently, about 1 in every 5 calendars is blank <code>""</code> for
one of these two reasons.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>FPSTATUS</span> <span class='op'>==</span> <span class='st'>""</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prop <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 2 × 3
  `FPSTATUS == &quot;&quot;`     n  prop
  &lt;lgl&gt;            &lt;int&gt; &lt;dbl&gt;
1 FALSE            28153 0.795
2 TRUE              7271 0.205</code></pre>
</div>
<p>In some research applications, you might want to complete the empty
calendars for women who were NIU. For example: if a woman used the
contraceptive pill from the beginning of the calendar period
continuously through the day of the interview, her calendar is currently
blank because she did not adopt or discontinue using the pill in that
time span. You might want to fill her calendar with the value
<code>7</code> repeated once for every month between
<code>CALSTART</code> and <code>CALSTOP</code>.</p>
<p>Similarly, we can complete all calendars for women who never used a
family planning method and were never pregnant during the calendar
period: in this case, we’ll repeat the value <code>0</code>.</p>
<p>Note, however, that it is <em>not</em> possible to complete calendars
for women who experienced birth or pregnancy termination during the
calendar period. If these calendars are blank, we cannot determine the
duration of the pregnancy or whether any family planning method was used
prior to the pregnancy. We’ll flag these cases with a new variable we’ll
call <code>CALMISSING</code>.</p>
<p>We’ll begin by attaching all of the <code>CMC</code> variables we
created above (except <code>INTFQCMC</code>) along with the variables <a
href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>
and <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>.
In order to match the format of <code>cals</code>, we’ll again use <a
href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>
to create separate rows for the dates collected from each
<code>PHASE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span>
    <span class='va'>ID</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"CMC"</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>matches</a></span><span class='op'>(</span><span class='st'>"INTFQ"</span><span class='op'>)</span>,
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"PREGNANT"</span><span class='op'>)</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"FPCURREFFMETHRC"</span><span class='op'>)</span>,
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    <span class='op'>!</span><span class='va'>ID</span>,
    names_pattern <span class='op'>=</span> <span class='st'>"(.*)_(.*)"</span>,
    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>".value"</span>, <span class='st'>"PHASE"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span><span class='op'>(</span><span class='va'>cals</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ID"</span>, <span class='st'>"PHASE"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 35,424 × 16
      ID PHASE KID1STBIRTHCMC FPBEGINUSECMC LASTBIRTHCMC OTHERBIRTHCMC
   &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
 1     1 1               1314            NA         1430            NA
 2     1 2               1314          1448         1430          1430
 3     2 1                 NA            NA         1390            NA
 4     2 2                 NA          1444         1443            NA
 5     3 1                 NA            NA           NA            NA
 6     3 2                 NA            NA           NA            NA
 7     4 1               1324          1428         1406            NA
 8     4 2               1324            NA         1406            NA
 9     5 1               1366            NA         1422            NA
10     5 2               1366            NA         1422            NA
# … with 35,414 more rows, and 10 more variables: PANELBIRTHCMC &lt;dbl&gt;,
#   PREGENDCMC &lt;dbl&gt;, PANELPREGENDCMC &lt;dbl&gt;, PREGNANT &lt;int+lbl&gt;,
#   FPCURREFFMETHRC &lt;int+lbl&gt;, COUNTRY &lt;fct&gt;, CALSTART &lt;dbl&gt;, CALSTOP &lt;dbl&gt;,
#   FPSTATUS &lt;chr+lbl&gt;, WHYSTOP &lt;chr+lbl&gt;</code></pre>
</div>
<p>Now, we’ll create <code>CALMISSING</code> to indicate whether women
with an empty value <code>""</code> in <code>FPSTATUS</code> were
<em>actually</em> pregnant or adopted a family planning method at some
point during the calendar period. In other words: we’ll test whether any
one of our <code>CMC</code> variables shows an event that occurred after
<code>CALSTART</code>, but is not recorded in <code>FPSTATUS</code>.
Likewise, this check will determine whether any such women are
<em>currently</em> pregnant.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    .after <span class='op'>=</span> <span class='va'>PHASE</span>,
    CALMISSING <span class='op'>=</span> <span class='va'>FPSTATUS</span> <span class='op'>==</span> <span class='st'>""</span> <span class='op'>&amp;</span> <span class='va'>WHYSTOP</span> <span class='op'>==</span> <span class='st'>""</span> <span class='op'>&amp;</span> <span class='op'>{</span>
      <span class='va'>PREGNANT</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>|</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>if_any</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"CMC"</span><span class='op'>)</span>, <span class='op'>~</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>.x</span> <span class='op'>&gt;=</span> <span class='va'>CALSTART</span><span class='op'>)</span>
    <span class='op'>}</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>CALSTART</span>, .after <span class='op'>=</span> <span class='va'>CALMISSING</span><span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 35,424 × 17
      ID PHASE CALMISSING CALSTART KID1STBIRTHCMC FPBEGINUSECMC LASTBIRTHCMC
   &lt;int&gt; &lt;chr&gt; &lt;lgl&gt;         &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;
 1     1 1     FALSE          1417           1314            NA         1430
 2     1 2     FALSE          1417           1314          1448         1430
 3     2 1     FALSE          1417             NA            NA         1390
 4     2 2     FALSE          1417             NA          1444         1443
 5     3 1     FALSE          1417             NA            NA           NA
 6     3 2     FALSE          1417             NA            NA           NA
 7     4 1     FALSE          1417           1324          1428         1406
 8     4 2     FALSE          1417           1324            NA         1406
 9     5 1     FALSE          1417           1366            NA         1422
10     5 2     TRUE           1417           1366            NA         1422
# … with 35,414 more rows, and 10 more variables: OTHERBIRTHCMC &lt;dbl&gt;,
#   PANELBIRTHCMC &lt;dbl&gt;, PREGENDCMC &lt;dbl&gt;, PANELPREGENDCMC &lt;dbl&gt;,
#   PREGNANT &lt;int+lbl&gt;, FPCURREFFMETHRC &lt;int+lbl&gt;, COUNTRY &lt;fct&gt;,
#   CALSTOP &lt;dbl&gt;, FPSTATUS &lt;chr+lbl&gt;, WHYSTOP &lt;chr+lbl&gt;</code></pre>
</div>
<p>You can see in this output, for example, that the woman in row 10
(<code>ID == 5</code> and <code>PHASE == 2</code>) should have a
calendar starting in month <code>1417</code>. She tells us in
<code>LASTBIRTHCMC</code> that she gave birth in month
<code>1422</code>, 5 months after the calendar period began, but the
string we would expect to find in <code>FPSTATUS</code> is blank. We
have flagged this row with <code>CALMISSING</code> because we won’t be
able to reconstruct her <code>FPSTATUS</code> calendar without knowing
exactly when she became pregnant for this birth, or whether she was
using a family planning method in any month prior.</p>
<p>On the other hand, women with blank <code>FPSTATUS</code> calendars
who were <em>not</em> flagged with <code>CALMISSING</code> have not
given birth or switched family planning methods during the calendar
period. We can assume that they have held their current status between
<code>CALSTART</code> and <code>CALSTOP</code>.</p>
<p>Prior to this procedure, 1 in 5 rows in <code>cals</code> contained
an empty <code>FPSTATUS</code> calendar. With help from
<code>CALMISSING</code>, we’ll now be able to reduce the proportion of
empty calendars to less than 1 in 20.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>CALMISSING</span>, <span class='va'>FPSTATUS</span> <span class='op'>==</span> <span class='st'>""</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prop <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 × 4
  CALMISSING `FPSTATUS == &quot;&quot;`     n   prop
  &lt;lgl&gt;      &lt;lgl&gt;            &lt;int&gt;  &lt;dbl&gt;
1 FALSE      FALSE            28153 0.795 
2 FALSE      TRUE              5811 0.164 
3 TRUE       TRUE              1460 0.0412</code></pre>
</div>
<p>We’ll now complete the blank calendars for women who were not flagged
by <code>CALMISSING</code>. First, we’ll recode
<code>FPCURREFFMETHRC</code> to match the values used in the
calendar:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    FPCURREFFMETHRC <span class='op'>=</span> <span class='va'>FPCURREFFMETHRC</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='https://haven.tidyverse.org/reference/zap_labels.html'>zap_labels</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
      <span class='co'># NA if "No response or missing" (1 case)</span>
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='fl'>998</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
      <span class='co'># Note: 5 is used twice, and 6 is not used </span>
      <span class='fu'><a href='https://dplyr.tidyverse.org/reference/recode.html'>recode</a></span><span class='op'>(</span>
        <span class='st'>"999"</span> <span class='op'>=</span> <span class='fl'>0</span>, <span class='st'>"101"</span> <span class='op'>=</span> <span class='fl'>1</span>, <span class='st'>"102"</span> <span class='op'>=</span> <span class='fl'>2</span>, <span class='st'>"111"</span> <span class='op'>=</span> <span class='fl'>3</span>, <span class='st'>"112"</span> <span class='op'>=</span> <span class='fl'>4</span>, <span class='st'>"121"</span> <span class='op'>=</span> <span class='fl'>5</span>,
        <span class='st'>"123"</span> <span class='op'>=</span> <span class='fl'>5</span>, <span class='st'>"131"</span> <span class='op'>=</span> <span class='fl'>7</span>, <span class='st'>"132"</span> <span class='op'>=</span> <span class='fl'>8</span>, <span class='st'>"141"</span> <span class='op'>=</span> <span class='fl'>9</span>, <span class='st'>"142"</span> <span class='op'>=</span> <span class='fl'>10</span>, <span class='st'>"151"</span> <span class='op'>=</span> <span class='fl'>11</span>, 
        <span class='st'>"152"</span> <span class='op'>=</span> <span class='fl'>12</span>, <span class='st'>"160"</span> <span class='op'>=</span> <span class='fl'>13</span>, <span class='st'>"170"</span> <span class='op'>=</span> <span class='fl'>14</span>, <span class='st'>"210"</span> <span class='op'>=</span> <span class='fl'>30</span>, <span class='st'>"220"</span> <span class='op'>=</span> <span class='fl'>31</span>, <span class='st'>"240"</span> <span class='op'>=</span> <span class='fl'>39</span>
      <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Then, we’ll create <code>CALDUR</code> to calculate the duration (in
months) of each woman’s calendar.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>CALDUR <span class='op'>=</span> <span class='va'>CALSTOP</span> <span class='op'>-</span> <span class='va'>CALSTART</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Finally, we’ll complete each empty string in <code>FPSTATUS</code>
for women not flagged by <code>CALMISSING</code> (leaving it the same
otherwise). To clean-up, we’ll also drop any variables that are no
longer needed.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>FPSTATUS <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>
    <span class='co'># If `FPSTATUS` is blank and `CALMISSING` is FALSE...</span>
    <span class='va'>FPSTATUS</span> <span class='op'>==</span> <span class='st'>""</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>CALMISSING</span>,
    <span class='co'># Repeat "," and the value in `FPCURREFFMETHRC` as many times as `CALDUR`:</span>
    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_c.html'>str_c</a></span><span class='op'>(</span><span class='st'>","</span>, <span class='va'>FPCURREFFMETHRC</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_dup.html'>str_dup</a></span><span class='op'>(</span><span class='va'>CALDUR</span><span class='op'>)</span>, 
    <span class='co'># Otherwise, recycle `FPSTATUS` as a character string:</span>
    <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='va'>FPSTATUS</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"CMC"</span><span class='op'>)</span>, <span class='va'>CALDUR</span>, <span class='va'>CALSTOP</span>, 
    <span class='va'>CALMISSING</span>, <span class='va'>PREGNANT</span>, <span class='va'>FPCURREFFMETHRC</span>
  <span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="splitting-months-into-columns">Splitting months into
columns</h1>
<p>We’ve now completed as many of the blank calendars as we can, so it’s
time to transform each calendar string into variables that will be
usable in survival analysis.</p>
<p>We’ll begin with another <a
href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>
function to position <code>FPSTATUS</code> and <code>WHYSTOP</code>
together in a single column. Notice the temporary column
<code>name</code> describes the type of calendar that appears in the
temporary column <code>value</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"FPSTATUS"</span>, <span class='st'>"WHYSTOP"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 70,848 × 6
      ID PHASE CALSTART COUNTRY name     value                                  
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;    &lt;chr+lbl&gt;                              
 1     1 1         1417 BF      FPSTATUS &quot;,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,B,P…
 2     1 1         1417 BF      WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,&quot;  
 3     1 2         1417 BF      FPSTATUS &quot;,,,,,,,,,,,3,3,3,3,3,3,0,0,0,0,0,0,0,…
 4     1 2         1417 BF      WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,…
 5     2 1         1417 BF      FPSTATUS &quot;,,,,,,,,,,,P,P,P,P,P,P,P,0,0,0,0,0,0,…
 6     2 1         1417 BF      WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,6,,,,,,,,,,&quot; 
 7     2 2         1417 BF      FPSTATUS &quot;,,,,,,,,,,,,5,5,5,5,5,5,5,5,5,B,P,P,P…
 8     2 2         1417 BF      WHYSTOP  &quot;,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,6…
 9     3 1         1417 BF      FPSTATUS &quot;,,,,,,,,,,,0,0,0,0,0,0,0,0,0,0,0,0,0,…
10     3 1         1417 BF      WHYSTOP  &quot;&quot;                                     
# … with 70,838 more rows</code></pre>
</div>
<p>Now, we’ll use <a
href="https://tidyr.tidyverse.org/reference/separate">separate</a> to
split each string into several columns. You can manually specify the
maximum number of columns you’ll need to hold all of the calendars in
your data extract, or you can let R determine the <a
href="https://rdrr.io/r/base/Extremes.html">max</a> length of each
string.<a href="#fn4" class="footnote-ref" id="fnref4"
role="doc-noteref"><sup>4</sup></a> We’ll call this number
<code>ncols</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># How many columns would be needed for the single longest calendar? </span>
<span class='va'>ncols</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_count.html'>str_count</a></span><span class='op'>(</span><span class='va'>cals</span><span class='op'>$</span><span class='va'>value</span>, <span class='st'>","</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>1</span>
<span class='va'>ncols</span> 
</code></pre>
</div>
<pre><code>[1] 48</code></pre>
</div>
<p>In <a
href="https://tidyr.tidyverse.org/reference/separate">separate</a>, we
tell R to split each string <code>into</code> 48 columns: if any given
calendar has fewer than 48 values, we <code>fill</code> the left-most
columns with the value <code>NA</code> as needed.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># Create one column for every month in the longest calendar</span>
<span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/separate.html'>separate</a></span><span class='op'>(</span><span class='va'>value</span>, into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cal"</span>, <span class='va'>ncols</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>","</span>, fill <span class='op'>=</span> <span class='st'>"left"</span>, <span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 70,848 × 53
      ID PHASE CALSTART COUNTRY name   cal48 cal47 cal46 cal45 cal44 cal43 cal42
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 1         1417 BF      FPSTA…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
 2     1 1         1417 BF      WHYST…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
 3     1 2         1417 BF      FPSTA… &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 4     1 2         1417 BF      WHYST… &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 5     2 1         1417 BF      FPSTA…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
 6     2 1         1417 BF      WHYST…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
 7     2 2         1417 BF      FPSTA… &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 8     2 2         1417 BF      WHYST… &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;    &quot;&quot;   
 9     3 1         1417 BF      FPSTA…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
10     3 1         1417 BF      WHYST…  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;
# … with 70,838 more rows, and 41 more variables: cal41 &lt;chr&gt;, cal40 &lt;chr&gt;,
#   cal39 &lt;chr&gt;, cal38 &lt;chr&gt;, cal37 &lt;chr&gt;, cal36 &lt;chr&gt;, cal35 &lt;chr&gt;,
#   cal34 &lt;chr&gt;, cal33 &lt;chr&gt;, cal32 &lt;chr&gt;, cal31 &lt;chr&gt;, cal30 &lt;chr&gt;,
#   cal29 &lt;chr&gt;, cal28 &lt;chr&gt;, cal27 &lt;chr&gt;, cal26 &lt;chr&gt;, cal25 &lt;chr&gt;,
#   cal24 &lt;chr&gt;, cal23 &lt;chr&gt;, cal22 &lt;chr&gt;, cal21 &lt;chr&gt;, cal20 &lt;chr&gt;,
#   cal19 &lt;chr&gt;, cal18 &lt;chr&gt;, cal17 &lt;chr&gt;, cal16 &lt;chr&gt;, cal15 &lt;chr&gt;,
#   cal14 &lt;chr&gt;, cal13 &lt;chr&gt;, cal12 &lt;chr&gt;, cal11 &lt;chr&gt;, cal10 &lt;chr&gt;, …</code></pre>
</div>
<p>As you can see, this produced 48 columns named <code>cal48</code> to
<code>cal1</code>, where <code>cal1</code> is the earliest month in
chronological time. You’ll notice some blank strings for women whose
calendar included empty placeholders
(e.g. <code>,,,,,,,3,3,3...</code>). We’ll now use <a
href="https://dplyr.tidyverse.org/reference/across.html">across</a> to
convert blank strings <code>""</code> to <code>NA</code> as well.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"cal"</span>, ignore.case <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>,
    <span class='op'>~</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/na_if.html'>na_if</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='st'>""</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 70,848 × 53
      ID PHASE CALSTART COUNTRY name   cal48 cal47 cal46 cal45 cal44 cal43 cal42
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 1         1417 BF      FPSTA… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 2     1 1         1417 BF      WHYST… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 3     1 2         1417 BF      FPSTA… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 4     1 2         1417 BF      WHYST… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 5     2 1         1417 BF      FPSTA… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 6     2 1         1417 BF      WHYST… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 7     2 2         1417 BF      FPSTA… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 8     2 2         1417 BF      WHYST… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
 9     3 1         1417 BF      FPSTA… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
10     3 1         1417 BF      WHYST… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
# … with 70,838 more rows, and 41 more variables: cal41 &lt;chr&gt;, cal40 &lt;chr&gt;,
#   cal39 &lt;chr&gt;, cal38 &lt;chr&gt;, cal37 &lt;chr&gt;, cal36 &lt;chr&gt;, cal35 &lt;chr&gt;,
#   cal34 &lt;chr&gt;, cal33 &lt;chr&gt;, cal32 &lt;chr&gt;, cal31 &lt;chr&gt;, cal30 &lt;chr&gt;,
#   cal29 &lt;chr&gt;, cal28 &lt;chr&gt;, cal27 &lt;chr&gt;, cal26 &lt;chr&gt;, cal25 &lt;chr&gt;,
#   cal24 &lt;chr&gt;, cal23 &lt;chr&gt;, cal22 &lt;chr&gt;, cal21 &lt;chr&gt;, cal20 &lt;chr&gt;,
#   cal19 &lt;chr&gt;, cal18 &lt;chr&gt;, cal17 &lt;chr&gt;, cal16 &lt;chr&gt;, cal15 &lt;chr&gt;,
#   cal14 &lt;chr&gt;, cal13 &lt;chr&gt;, cal12 &lt;chr&gt;, cal11 &lt;chr&gt;, cal10 &lt;chr&gt;, …</code></pre>
</div>
<p>We’ll now <a
href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a>
again, placing each month into a single column temporarily called
<code>value</code>. The label in <code>name</code> describes whether a
particular <code>value</code> originated in the <code>FPSTATUS</code> or
<code>WHYSTOP</code> calendar. We strip the numeric suffix from each
column to create <code>MONTH</code>, which indicates the sequential
month associated with each <code>value</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span>  <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"cal"</span>, ignore.case <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>, 
    names_to <span class='op'>=</span> <span class='st'>"MONTH"</span>, 
    names_prefix <span class='op'>=</span> <span class='st'>"cal"</span>
  <span class='op'>)</span>

<span class='va'>cals</span> 
</code></pre>
</div>
<pre><code># A tibble: 3,400,704 × 7
      ID PHASE CALSTART COUNTRY name     MONTH value
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;
 1     1 1         1417 BF      FPSTATUS 48    &lt;NA&gt; 
 2     1 1         1417 BF      FPSTATUS 47    &lt;NA&gt; 
 3     1 1         1417 BF      FPSTATUS 46    &lt;NA&gt; 
 4     1 1         1417 BF      FPSTATUS 45    &lt;NA&gt; 
 5     1 1         1417 BF      FPSTATUS 44    &lt;NA&gt; 
 6     1 1         1417 BF      FPSTATUS 43    &lt;NA&gt; 
 7     1 1         1417 BF      FPSTATUS 42    &lt;NA&gt; 
 8     1 1         1417 BF      FPSTATUS 41    &lt;NA&gt; 
 9     1 1         1417 BF      FPSTATUS 40    &lt;NA&gt; 
10     1 1         1417 BF      FPSTATUS 39    &lt;NA&gt; 
# … with 3,400,694 more rows</code></pre>
</div>
<p>From <code>MONTH</code> and <code>CALSTART</code>, we’ll derive
<code>CALCMC</code> to mark the <em>calendar</em> month for each
<code>value</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>CALCMC <span class='op'>=</span> <span class='va'>CALSTART</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>MONTH</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span><span class='op'>)</span>

<span class='va'>cals</span>
</code></pre>
</div>
<pre><code># A tibble: 3,400,704 × 8
      ID PHASE CALSTART COUNTRY name     MONTH value CALCMC
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;
 1     1 1         1417 BF      FPSTATUS 48    &lt;NA&gt;    1464
 2     1 1         1417 BF      FPSTATUS 47    &lt;NA&gt;    1463
 3     1 1         1417 BF      FPSTATUS 46    &lt;NA&gt;    1462
 4     1 1         1417 BF      FPSTATUS 45    &lt;NA&gt;    1461
 5     1 1         1417 BF      FPSTATUS 44    &lt;NA&gt;    1460
 6     1 1         1417 BF      FPSTATUS 43    &lt;NA&gt;    1459
 7     1 1         1417 BF      FPSTATUS 42    &lt;NA&gt;    1458
 8     1 1         1417 BF      FPSTATUS 41    &lt;NA&gt;    1457
 9     1 1         1417 BF      FPSTATUS 40    &lt;NA&gt;    1456
10     1 1         1417 BF      FPSTATUS 39    &lt;NA&gt;    1455
# … with 3,400,694 more rows</code></pre>
</div>
<p>Finally, we’ll use <a
href="https://tidyr.tidyverse.org/reference/pivot_wider">pivot_wider</a>
to align the months for each available calendar, and then arrange each
woman’s calendar by <code>CALCMC</code>. If any month includes no value
from either Phase 1 or Phase 2, we’ll use <a
href="https://dplyr.tidyverse.org/reference/filter.html">filter</a> to
remove it from our data frame (these are placeholder values for future
months).</p>
<p>In its final format, <code>cals</code> contains one row for every
month covered by the contraceptive calendar from either Phase 1 or Phase
2. You’ll notice that the two calendars contain overlapping months, as
with the dates between <code>CALCMC</code> 1417 and 1442 for the first
woman shown below.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cals</span> <span class='op'>&lt;-</span> <span class='va'>cals</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>PHASE</span>, <span class='va'>CALCMC</span>, <span class='va'>name</span>, <span class='va'>value</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_wider.html'>pivot_wider</a></span><span class='op'>(</span>
    names_from <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>name</span>, <span class='va'>PHASE</span><span class='op'>)</span>, 
    values_from <span class='op'>=</span> <span class='va'>value</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>FPSTATUS_1</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>FPSTATUS_2</span> <span class='op'>==</span> <span class='st'>""</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>ID</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>CALCMC</span><span class='op'>)</span><span class='op'>)</span> 

<span class='va'>cals</span>
</code></pre>
</div>
<pre><code># A tibble: 769,071 × 6
      ID CALCMC FPSTATUS_1 WHYSTOP_1 FPSTATUS_2 WHYSTOP_2
   &lt;int&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;    
 1     1   1453 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 2     1   1452 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 3     1   1451 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 4     1   1450 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 5     1   1449 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 6     1   1448 &lt;NA&gt;       &lt;NA&gt;      3          &lt;NA&gt;     
 7     1   1447 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
 8     1   1446 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
 9     1   1445 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
10     1   1444 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
11     1   1443 &lt;NA&gt;       &lt;NA&gt;      0          &lt;NA&gt;     
12     1   1442 0          &lt;NA&gt;      0          &lt;NA&gt;     
13     1   1441 0          &lt;NA&gt;      0          &lt;NA&gt;     
14     1   1440 0          &lt;NA&gt;      0          &lt;NA&gt;     
15     1   1439 0          &lt;NA&gt;      0          &lt;NA&gt;     
16     1   1438 0          &lt;NA&gt;      0          &lt;NA&gt;     
17     1   1437 0          &lt;NA&gt;      0          &lt;NA&gt;     
18     1   1436 0          &lt;NA&gt;      0          &lt;NA&gt;     
19     1   1435 0          &lt;NA&gt;      0          &lt;NA&gt;     
20     1   1434 0          &lt;NA&gt;      0          &lt;NA&gt;     
21     1   1433 0          &lt;NA&gt;      0          &lt;NA&gt;     
22     1   1432 0          &lt;NA&gt;      0          &lt;NA&gt;     
23     1   1431 0          &lt;NA&gt;      0          &lt;NA&gt;     
24     1   1430 B          &lt;NA&gt;      B          &lt;NA&gt;     
25     1   1429 P          &lt;NA&gt;      P          &lt;NA&gt;     
26     1   1428 P          &lt;NA&gt;      P          &lt;NA&gt;     
27     1   1427 P          &lt;NA&gt;      P          &lt;NA&gt;     
28     1   1426 P          &lt;NA&gt;      P          &lt;NA&gt;     
29     1   1425 P          &lt;NA&gt;      P          &lt;NA&gt;     
30     1   1424 P          &lt;NA&gt;      P          &lt;NA&gt;     
31     1   1423 P          &lt;NA&gt;      P          &lt;NA&gt;     
32     1   1422 P          &lt;NA&gt;      0          &lt;NA&gt;     
33     1   1421 0          &lt;NA&gt;      0          &lt;NA&gt;     
34     1   1420 0          &lt;NA&gt;      0          &lt;NA&gt;     
35     1   1419 0          &lt;NA&gt;      0          &lt;NA&gt;     
36     1   1418 0          &lt;NA&gt;      0          &lt;NA&gt;     
37     1   1417 0          &lt;NA&gt;      0          &lt;NA&gt;     
38     2   1452 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
39     2   1451 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
40     2   1450 &lt;NA&gt;       &lt;NA&gt;      5          &lt;NA&gt;     
# … with 769,031 more rows</code></pre>
</div>
<h1 id="analysis">Analysis</h1>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>We mentioned at the beginning of this post that there are many ways
to work with the contraceptive calendar data once you’ve formatted it
this way. For example, we just saw that the <code>FPSTATUS_1</code> and
<code>FPSTATUS_2</code> columns are a <em>nearly</em> perfect match for
the woman marked <code>ID == 1</code>: she reports that she used no
method of contraception between month <code>1417</code> until month
<code>1421</code>. Then, in Phase 1 she recalled that she became
pregnant in month <code>1422</code>; in Phase 2, she instead recalled
that she became pregnant in month <code>1423</code>. In both phases, she
reports that she gave birth in month <code>1430</code>, and then
returned to using no family planning method.</p>
<p>We encourage researchers to explore sources of <strong>recall
bias</strong> that may account for discrepancies between the Phase 1 and
Phase 2 calendars. Generally, we assume that individuals remember events
more reliably when they are in recent memory, but this may not always be
true! For more on the reliability of responses in contraceptive
calendars across PMA samples, we strongly recommend checking out work by
Anglewicz et al. <span class="citation"
data-cites="Anglewicz2022-mx">(<a href="#ref-Anglewicz2022-mx"
role="doc-biblioref">2022</a>)</span>.</p>
<p>Here, we’d like to highlight just one way that the PMA panel design
might help researchers understand patterns in the calendar data. When we
introduced the Phase 1 contraceptive calendars <a
href="..//2021-05-15-paa-2021/">one year ago</a>, we mentioned that
Phase 2 calendars would allow researchers to compare the rate of
adoption for women who were using no method at Phase 1; we also
suggested that you might compare adoption rates for women with <a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">unmet
need</a> or <a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">plans
to adopt</a> a method within the next year. Let’s now check to see
whether these factors had any effect on the monthly contraceptive use
status for each month between Phase 1 and Phase 2.</p>
<p>First, we’ll need to identify women who were not using any family
planning method at Phase 1. These are cases where <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC_1</a>
is coded <code>999</code> for <strong>NIU (not in universe)</strong>.
We’ll drop any other cases from our original data frame
<code>dat</code>, and we’ll call this new data frame
<code>nonusers</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>FPCURREFFMETHRC_1</span> <span class='op'>==</span> <span class='fl'>999</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We’ll follow steps in a <a
href="../2022-04-15-phase2-indicators/index.html">previous post</a> to
identify women who meet the PMA criteria for “unmet need” in <a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN_1</a>,
and also those who planned to adopt a family planning method within one
year at Phase 1 as shown in <a
href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL_1</a>
and <a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN_1</a>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    UNMETYN_1 <span class='op'>=</span> <span class='va'>UNMETYN_1</span> <span class='op'>==</span> <span class='fl'>1</span>,
    FPPLANYR_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>FPPLANVAL_1</span> <span class='op'>&lt;=</span> <span class='fl'>12</span> <span class='op'>~</span> <span class='cn'>TRUE</span>, <span class='co'># Within 12 months </span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'>==</span> <span class='fl'>2</span> <span class='op'>&amp;</span> <span class='va'>FPPLANVAL_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='cn'>TRUE</span>, <span class='co'># Within 1 year</span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>~</span> <span class='cn'>TRUE</span>, <span class='co'># Soon / now, after current pregnancy</span>
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='cn'>FALSE</span> <span class='co'># Includes date unknown, no response, or no intention (FPUSPLAN)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>In that same post, we shared code you can use to create a custom <a
href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme</a>
for graphics built with <a
href="https://ggplot2.tidyverse.org">ggplot2</a>. We named our theme
<code>theme_pma</code>; if you’d like to review the code for our
graphics theme, click the button below.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code for theme_pma
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span>

<span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add.html'>font_add</a></span><span class='op'>(</span>
  family <span class='op'>=</span> <span class='st'>"cabrito"</span>, 
  regular <span class='op'>=</span> <span class='st'>"../../fonts/cabritosansnormregular-webfont.ttf"</span>
<span class='op'>)</span>
<span class='fu'>showtext</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/update_defaults.html'>update_geom_defaults</a></span><span class='op'>(</span><span class='st'>"text"</span>, <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"cabrito"</span>, size <span class='op'>=</span> <span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>theme_pma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>%+replace%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
    text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"cabrito"</span>, size <span class='op'>=</span> <span class='fl'>13</span><span class='op'>)</span>,
    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, color <span class='op'>=</span> <span class='st'>"#00263A"</span>, 
                              hjust <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    strip.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span>, angle <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
    panel.spacing <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
    axis.title.x <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>t <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Before we begin our analysis, let’s see the proportion of
<code>nonusers</code> in each country who had unmet need or plans to
adopt a family planning method within one year at Phase 1.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<details>
<summary>
Show code for this plot
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>UNMETYN_1</span>, <span class='va'>FPPLANYR_1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span> 
    UNMETYN_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>UNMETYN_1</span>, <span class='st'>"Unmet Need\n"</span>, <span class='st'>"No Unmet Need\n"</span><span class='op'>)</span>,
    FPPLANYR_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>FPPLANYR_1</span>, <span class='st'>"Plan 1 Yr\n"</span>, <span class='st'>"No Plan 1 Yr\n"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>prop <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/proportions.html'>prop.table</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span>, tot <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='co'># joint percentages</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>UNMETYN_1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>propcol <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>/</span><span class='va'>tot</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='co'># column margins </span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>FPPLANYR_1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>proprow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span><span class='op'>/</span><span class='va'>tot</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='co'># row margins </span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    propcol <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>UNMETYN_1</span>, <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='va'>propcol</span>, <span class='fl'>.1</span><span class='op'>)</span><span class='op'>)</span>,
    proprow <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='va'>FPPLANYR_1</span>, <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='va'>proprow</span>, <span class='fl'>.1</span><span class='op'>)</span><span class='op'>)</span>,
    proplbl <span class='op'>=</span>  <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/percent_format.html'>percent</a></span><span class='op'>(</span><span class='va'>prop</span>, <span class='fl'>.1</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>propcol</span>, y <span class='op'>=</span> <span class='va'>proprow</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_tile</a></span><span class='op'>(</span>fill <span class='op'>=</span> <span class='st'>"#98579BB0"</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='va'>prop</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span>, scales <span class='op'>=</span> <span class='st'>"free"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_text.html'>geom_text</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>label <span class='op'>=</span> <span class='va'>proplbl</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Non-users: Unmet Need and Intentions to Adopt a Method within 1 Year"</span>,
    subtitle <span class='op'>=</span> <span class='st'>"Percentage among sampled women not currently using any method at Phase 1"</span>,
    x <span class='op'>=</span> <span class='cn'>NULL</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>theme_pma</span> <span class='op'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>%+replace%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>panel.grid <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, legend.position <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="phase2-calendar_files/figure-html5/unnamed-chunk-39-1.png" width="1152" /></p>
</div>
<p>As you can see, a majority of Phase 1 <code>nonusers</code> in each
country had both no unmet need and no plans to adopt a method within the
next year. We might expect these women to be <em>least likely</em> to
adopt a method within the subsequent months covered by the Phase 2
contraceptive calendar. Conversely, we might expect that women who
planned to adopt a method within the year would be <em>most likely</em>
to adopt a method during the calendar period, but this might be
mitigated by factors related to unmet need.</p>
<p>Let’s now attach the contraceptive calendar data from Phase 2 to
<code>nonusers</code>. We’ll exclude months before
<code>INTFQCMC_1</code> and women we identified with
<code>CALMISSING</code> (where all values in <code>FPSTATUS_2</code> are
now <code>NA</code>). Finally, we’ll exclude women for whom either
<code>UNMETYN_1</code> or <code>FPPLANYR_1</code> is missing, NIU, or
otherwise coded <code>NA</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>COUNTRY</span>, <span class='va'>INTFQCMC_1</span>, <span class='va'>UNMETYN_1</span>, <span class='va'>FPPLANYR_1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span><span class='op'>(</span><span class='va'>cals</span>, <span class='va'>.</span>, by <span class='op'>=</span> <span class='st'>"ID"</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span>
    <span class='va'>CALCMC</span> <span class='op'>&gt;=</span> <span class='va'>INTFQCMC_1</span>, 
    <span class='op'>!</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>if_any</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>FPSTATUS_2</span>, <span class='va'>UNMETYN_1</span>, <span class='va'>FPPLANYR_1</span><span class='op'>)</span>, <span class='va'>is.na</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The next several steps will help us remove every month for each woman
<em>except</em> for the last consecutive month in which she was not
using a family planning method after the Phase 1 interview. For those
who were still not using a method by the date of the Phase 2 interview,
we might say say she “survived” the full observation period. We’ll use
the <a href="https://github.com/therneau/survival">survival</a> package
to model the likelihood that a woman would have progressed through each
month of the calendar without adopting a family planning method.</p>
<p>First, we’ll classify every month in each woman’s calendar with a new
variable <code>USE</code> indicating whether she used any family
planning method that month. We’ll then create <code>MO</code> to count
the number of months that have passed between each month and the
earliest month in <code>CALCMC</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>transmute</a></span><span class='op'>(</span>
    <span class='va'>ID</span>, <span class='va'>COUNTRY</span>, <span class='va'>CALCMC</span>, 
    <span class='va'>FPSTATUS_2</span>, <span class='va'>UNMETYN_1</span>, <span class='va'>FPPLANYR_1</span>,
    MO <span class='op'>=</span> <span class='va'>CALCMC</span> <span class='op'>-</span> <span class='va'>INTFQCMC_1</span>,
    USE <span class='op'>=</span> <span class='op'>!</span><span class='va'>FPSTATUS_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"0"</span>, <span class='st'>"B"</span>, <span class='st'>"P"</span>, <span class='st'>"T"</span><span class='op'>)</span>
  <span class='op'>)</span> 

<span class='va'>nonusers</span> 
</code></pre>
</div>
<pre><code># A tibble: 116,860 × 8
      ID COUNTRY CALCMC FPSTATUS_2 UNMETYN_1 FPPLANYR_1    MO USE  
   &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;     &lt;lgl&gt;      &lt;dbl&gt; &lt;lgl&gt;
 1     1 BF        1453 3          FALSE     TRUE          11 TRUE 
 2     1 BF        1452 3          FALSE     TRUE          10 TRUE 
 3     1 BF        1451 3          FALSE     TRUE           9 TRUE 
 4     1 BF        1450 3          FALSE     TRUE           8 TRUE 
 5     1 BF        1449 3          FALSE     TRUE           7 TRUE 
 6     1 BF        1448 3          FALSE     TRUE           6 TRUE 
 7     1 BF        1447 0          FALSE     TRUE           5 FALSE
 8     1 BF        1446 0          FALSE     TRUE           4 FALSE
 9     1 BF        1445 0          FALSE     TRUE           3 FALSE
10     1 BF        1444 0          FALSE     TRUE           2 FALSE
11     1 BF        1443 0          FALSE     TRUE           1 FALSE
12     1 BF        1442 0          FALSE     TRUE           0 FALSE
13     2 BF        1452 5          FALSE     FALSE         11 TRUE 
14     2 BF        1451 5          FALSE     FALSE         10 TRUE 
15     2 BF        1450 5          FALSE     FALSE          9 TRUE 
16     2 BF        1449 5          FALSE     FALSE          8 TRUE 
17     2 BF        1448 5          FALSE     FALSE          7 TRUE 
18     2 BF        1447 5          FALSE     FALSE          6 TRUE 
19     2 BF        1446 5          FALSE     FALSE          5 TRUE 
20     2 BF        1445 5          FALSE     FALSE          4 TRUE 
# … with 116,840 more rows</code></pre>
</div>
<p>Next, we’ll create <code>USEMO</code> to copy the month recorded in
<code>MO</code> for each month of <code>USE</code> (otherwise, <a
href="https://dplyr.tidyverse.org/reference/case_when">case_when</a>
assigns the value <code>NA</code>). If there are any months of
<code>USE</code> for an individual woman, we’ll identify the first such
month with <code>ADOPT</code>; if there are no cases of
<code>USE</code>, <code>ADOPT</code> will record the last month in
<code>MO</code>. Finally we’ll use <code>RC</code> to indicate whether
<code>ADOPT</code> is “right censored” - these are cases where
<code>ADOPT</code> is the last month in <code>MO</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>ID</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    USEMO <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span><span class='va'>USE</span> <span class='op'>~</span> <span class='va'>MO</span><span class='op'>)</span>,
    ADOPT <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>USE</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>USEMO</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>MO</span><span class='op'>)</span><span class='op'>)</span>,
    RC <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span><span class='va'>ADOPT</span> <span class='op'>==</span> <span class='va'>MO</span> <span class='op'>~</span> <span class='op'>!</span><span class='va'>USE</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>ungroup</a></span><span class='op'>(</span><span class='op'>)</span> 

<span class='va'>nonusers</span> 
</code></pre>
</div>
<pre><code># A tibble: 116,860 × 11
      ID COUNTRY CALCMC FPSTATUS_2 UNMETYN_1 FPPLANYR_1    MO USE   USEMO ADOPT RC   
   &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;     &lt;lgl&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;
 1     1 BF        1453 3          FALSE     TRUE          11 TRUE     11     6 NA   
 2     1 BF        1452 3          FALSE     TRUE          10 TRUE     10     6 NA   
 3     1 BF        1451 3          FALSE     TRUE           9 TRUE      9     6 NA   
 4     1 BF        1450 3          FALSE     TRUE           8 TRUE      8     6 NA   
 5     1 BF        1449 3          FALSE     TRUE           7 TRUE      7     6 NA   
 6     1 BF        1448 3          FALSE     TRUE           6 TRUE      6     6 FALSE
 7     1 BF        1447 0          FALSE     TRUE           5 FALSE    NA     6 NA   
 8     1 BF        1446 0          FALSE     TRUE           4 FALSE    NA     6 NA   
 9     1 BF        1445 0          FALSE     TRUE           3 FALSE    NA     6 NA   
10     1 BF        1444 0          FALSE     TRUE           2 FALSE    NA     6 NA   
11     1 BF        1443 0          FALSE     TRUE           1 FALSE    NA     6 NA   
12     1 BF        1442 0          FALSE     TRUE           0 FALSE    NA     6 NA   
13     2 BF        1452 5          FALSE     FALSE         11 TRUE     11     3 NA   
14     2 BF        1451 5          FALSE     FALSE         10 TRUE     10     3 NA   
15     2 BF        1450 5          FALSE     FALSE          9 TRUE      9     3 NA   
16     2 BF        1449 5          FALSE     FALSE          8 TRUE      8     3 NA   
17     2 BF        1448 5          FALSE     FALSE          7 TRUE      7     3 NA   
18     2 BF        1447 5          FALSE     FALSE          6 TRUE      6     3 NA   
19     2 BF        1446 5          FALSE     FALSE          5 TRUE      5     3 NA   
20     2 BF        1445 5          FALSE     FALSE          4 TRUE      4     3 NA   
# … with 116,840 more rows</code></pre>
</div>
<p>Notice, for example, that the first month of <code>USE</code> for
<code>ID == 1</code> occurs in month 6. Hence, <code>ADOPT == 6</code>
and, because she adopted a method before the end of the calendar,
<code>RC == FALSE</code>.</p>
<p>Finally, we’ll now drop every row except for those matching
<code>ADOPT</code>. This leaves one row for each woman in
<code>nonusers</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>nonusers</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>ADOPT</span> <span class='op'>==</span> <span class='va'>MO</span><span class='op'>)</span>

<span class='va'>nonusers</span> 
</code></pre>
</div>
<pre><code># A tibble: 9,206 × 11
      ID COUNTRY CALCMC FPSTATUS_2 UNMETYN_1 FPPLANYR_1    MO USE   USEMO ADOPT RC   
   &lt;int&gt; &lt;fct&gt;    &lt;dbl&gt; &lt;chr&gt;      &lt;lgl&gt;     &lt;lgl&gt;      &lt;dbl&gt; &lt;lgl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;
 1     1 BF        1448 3          FALSE     TRUE           6 TRUE      6     6 FALSE
 2     2 BF        1444 5          FALSE     FALSE          3 TRUE      3     3 FALSE
 3     3 BF        1453 0          FALSE     FALSE         12 FALSE    NA    12 TRUE 
 4     6 BF        1453 0          FALSE     FALSE         12 FALSE    NA    12 TRUE 
 5     7 BF        1452 0          FALSE     FALSE         11 FALSE    NA    11 TRUE 
 6     8 BF        1452 0          TRUE      FALSE         11 FALSE    NA    11 TRUE 
 7    13 BF        1441 5          FALSE     TRUE           0 TRUE      0     0 FALSE
 8    16 BF        1449 5          FALSE     FALSE          8 TRUE      8     8 FALSE
 9    17 BF        1452 0          FALSE     TRUE          11 FALSE    NA    11 TRUE 
10    18 BF        1452 0          FALSE     FALSE         11 FALSE    NA    11 TRUE 
11    21 BF        1452 0          FALSE     FALSE         11 FALSE    NA    11 TRUE 
12    22 BF        1453 0          FALSE     FALSE         12 FALSE    NA    12 TRUE 
13    26 BF        1452 0          FALSE     FALSE         11 FALSE    NA    11 TRUE 
14    28 BF        1453 0          FALSE     FALSE         12 FALSE    NA    12 TRUE 
15    29 BF        1454 0          FALSE     FALSE         13 FALSE    NA    13 TRUE 
16    30 BF        1445 3          FALSE     TRUE           4 TRUE      4     4 FALSE
17    31 BF        1453 0          FALSE     FALSE         12 FALSE    NA    12 TRUE 
18    32 BF        1454 0          FALSE     FALSE         13 FALSE    NA    13 TRUE 
19    33 BF        1452 P          TRUE      TRUE          11 FALSE    NA    11 TRUE 
20    34 BF        1452 B          TRUE      FALSE         11 FALSE    NA    11 TRUE 
# … with 9,186 more rows</code></pre>
</div>
<p>We’ll now fit three survival models predicting the duration of
continuous non-use for the women in <code>nonusers</code>: one model for
<code>UNMETYN_1</code>, one for <code>FPPLANYR_1</code>, and one for
their interaction effect, which we’ll call <code>INTERACT_1</code>. For
each model, <a
href="https://rdrr.io/cran/survival/man/survfit.html">survfit</a>
reports the likelihood that a baseline non-user would have adopted any
family planning method for each month in the calendar period. We’ll run
each model separately for each country, and we’ll use <a
href="https://generics.r-lib.org/reference/tidy.html">broom::tidy</a> to
create a tidy summary table for each model.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adopt_models</span> <span class='op'>&lt;-</span> <span class='va'>nonusers</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='co'># Create a variable capturing the interaction between intentions and unmet need</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>INTERACT_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
    <span class='va'>UNMETYN_1</span> <span class='op'>&amp;</span> <span class='va'>FPPLANYR_1</span> <span class='op'>~</span> <span class='st'>"Unmet Need, Plan 1 Yr"</span>,
    <span class='va'>UNMETYN_1</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>FPPLANYR_1</span> <span class='op'>~</span> <span class='st'>"Unmet Need, No Plan 1 Yr"</span>,
    <span class='op'>!</span><span class='va'>UNMETYN_1</span> <span class='op'>&amp;</span> <span class='va'>FPPLANYR_1</span> <span class='op'>~</span> <span class='st'>"No Unmet Need, Plan 1 Yr"</span>,
    <span class='op'>!</span><span class='va'>UNMETYN_1</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>FPPLANYR_1</span> <span class='op'>~</span> <span class='st'>"No Unmet Need, No Plan 1 Yr"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='co'># Separate survival models for each country </span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    unmet <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>MO</span>, <span class='op'>!</span><span class='va'>RC</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>UNMETYN_1</span>, data <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_group</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>list</span>, 
    plan <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>MO</span>, <span class='op'>!</span><span class='va'>RC</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>FPPLANYR_1</span>, data <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_group</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>list</span>, 
    interact <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>MO</span>, <span class='op'>!</span><span class='va'>RC</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>INTERACT_1</span>, data <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_group</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='va'>list</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='co'># Tidy the output and relabel `COUNTRY` for the figure</span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.list</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></span><span class='op'>(</span><span class='va'>.x</span>, <span class='fu'>broom</span><span class='fu'>::</span><span class='va'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>)</span><span class='op'>)</span>,
    COUNTRY <span class='op'>=</span> <span class='va'>COUNTRY</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/recode.html'>recode</a></span><span class='op'>(</span>
      <span class='st'>"BF"</span> <span class='op'>=</span> <span class='st'>"Burkina Faso"</span>,
      <span class='st'>"CD"</span> <span class='op'>=</span> <span class='st'>"DRC"</span>,
      <span class='st'>"KE"</span> <span class='op'>=</span> <span class='st'>"Kenya"</span>,
      <span class='st'>"NG"</span> <span class='op'>=</span> <span class='st'>"Nigeria"</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Let’s start with the model featuring <code>UNMETYN_1</code>. If you
<a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a> the
<code>unmet</code> model output, you’ll see a separate row for each
month reported for women with “No Unmet Need” and “Unmet Need”.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_unmet</span> <span class='op'>&lt;-</span> <span class='va'>adopt_models</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>unmet</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>strata <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>strata</span>, <span class='st'>"TRUE"</span><span class='op'>)</span>, <span class='st'>"Unmet Need"</span>, <span class='st'>"No Unmet Need"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/relocate.html'>relocate</a></span><span class='op'>(</span><span class='va'>strata</span>, .after <span class='op'>=</span> <span class='va'>COUNTRY</span><span class='op'>)</span>

<span class='va'>m_unmet</span>
</code></pre>
</div>
<pre><code># A tibble: 117 × 12
   COUNTRY      strata   time n.risk n.event n.censor estimate std.error conf.high conf.low plan    
   &lt;fct&gt;        &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;list&gt;  
 1 Burkina Faso No Unm…     0   2245     157        0    0.930   0.00579     0.941    0.920 &lt;tibble&gt;
 2 Burkina Faso No Unm…     1   2088      20        0    0.921   0.00617     0.932    0.910 &lt;tibble&gt;
 3 Burkina Faso No Unm…     2   2068      21        0    0.912   0.00656     0.924    0.900 &lt;tibble&gt;
 4 Burkina Faso No Unm…     3   2047      25        0    0.901   0.00701     0.913    0.888 &lt;tibble&gt;
 5 Burkina Faso No Unm…     4   2022      27        0    0.889   0.00747     0.902    0.876 &lt;tibble&gt;
 6 Burkina Faso No Unm…     5   1995      22        0    0.879   0.00784     0.892    0.865 &lt;tibble&gt;
 7 Burkina Faso No Unm…     6   1973      27        0    0.867   0.00827     0.881    0.853 &lt;tibble&gt;
 8 Burkina Faso No Unm…     7   1946      26        0    0.855   0.00868     0.870    0.841 &lt;tibble&gt;
 9 Burkina Faso No Unm…     8   1920      30        0    0.842   0.00915     0.857    0.827 &lt;tibble&gt;
10 Burkina Faso No Unm…     9   1890      37        0    0.825   0.00971     0.841    0.810 &lt;tibble&gt;
11 Burkina Faso No Unm…    10   1853      35       97    0.810   0.0102      0.826    0.794 &lt;tibble&gt;
12 Burkina Faso No Unm…    11   1721      27      906    0.797   0.0107      0.814    0.781 &lt;tibble&gt;
13 Burkina Faso No Unm…    12    788       5      687    0.792   0.0110      0.809    0.775 &lt;tibble&gt;
14 Burkina Faso No Unm…    13     96       3       70    0.767   0.0214      0.800    0.736 &lt;tibble&gt;
15 Burkina Faso No Unm…    14     23       0       23    0.767   0.0214      0.800    0.736 &lt;tibble&gt;
16 Burkina Faso Unmet …     0    632      86        0    0.864   0.0158      0.891    0.838 &lt;tibble&gt;
17 Burkina Faso Unmet …     1    546      15        0    0.840   0.0173      0.869    0.812 &lt;tibble&gt;
18 Burkina Faso Unmet …     2    531       6        0    0.831   0.0180      0.860    0.802 &lt;tibble&gt;
19 Burkina Faso Unmet …     3    525       9        0    0.816   0.0189      0.847    0.787 &lt;tibble&gt;
20 Burkina Faso Unmet …     4    516       6        0    0.807   0.0195      0.838    0.777 &lt;tibble&gt;
# … with 97 more rows, and 1 more variable: interact &lt;list&gt;</code></pre>
</div>
<p>The column <code>n.risk</code> shows the total number of non-users
remaining after the number of months passed in <code>time</code>. The
column <code>estimate</code> shows the estimated probability that a
randomly selected woman would remain in <code>n.risk</code> by that
month (<code>conf.high</code> and <code>conf.low</code> report a 95%
confidence interval by default). For example, row 1 shows that there
were 2245 women in the Phase 1 Burkina Faso sample who were not using
family planning did not meet PMA criteria for “unmet need”. Among these,
<code>n.event</code> shows that 157 adopted a family planning method
less than one month after the interview: this leaves 93.0% of the group
remaining before one month had passed.</p>
<p>Below that, row 16 shows that there were 632 women in the Phase 1
Burkina Faso sample who were not using family planning, but <em>did</em>
meet PMA criteria for “unmet need”. Among these, <code>n.event</code>
shows that 86 adopted a family planning method less than one month after
the interview: this leaves 86.4% of the group remaining before one month
had passed.</p>
<p>We’ll produce a “time-to-event” plot by inverting the probabilities
reported in <code>event</code> and its accompanying confidence interval.
This plot uses <a
href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_step</a>
to draw a step-wise function, and <a
href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a>
to create a shaded confidence interval for each step.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>m_unmet</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>strata</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.double</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>time</span>, <span class='op'>~</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>.x</span><span class='op'>)</span>,
    xmax <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>time</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>time</span><span class='op'>)</span>, <span class='va'>time</span>, <span class='va'>time</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>, <span class='co'># horizontal ci shading</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>estimate</span>, fill <span class='op'>=</span> <span class='va'>strata</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_step</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_rect</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>time</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>,
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='fl'>0</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>label_percent</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"Unmet Need"</span> <span class='op'>=</span> <span class='st'>"#F2300E"</span>, 
    <span class='st'>"No Unmet Need"</span> <span class='op'>=</span> <span class='st'>"#352749"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Predicted Time to FP Adoption by Phase 1 Unmet Need Status"</span>,
    x <span class='op'>=</span> <span class='st'>"Consecutive Months after Phase 1 FQ Interview"</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, fill <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>+</span>  
  <span class='va'>theme_pma</span> 
</code></pre>
</div>
<p><img src="phase2-calendar_files/figure-html5/unnamed-chunk-46-1.png" width="1152" /></p>
</div>
<p>In general, we see evidence that non-users with unmet need at Phase 1
were significantly quicker to adopt a method compared to women with no
unmet need in each country.</p>
<p>Let’s now consider how the adoption rate might be influenced to by
<code>FPPLANYR_1</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adopt_models</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>plan</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>strata <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_detect.html'>str_detect</a></span><span class='op'>(</span><span class='va'>strata</span>, <span class='st'>"TRUE"</span><span class='op'>)</span>, <span class='st'>"Plan 1 Yr"</span>, <span class='st'>"No Plan 1 Yr"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>strata</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.double</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>time</span>, <span class='op'>~</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>.x</span><span class='op'>)</span>,
    xmax <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>time</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>time</span><span class='op'>)</span>, <span class='va'>time</span>, <span class='va'>time</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>, 
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>estimate</span>, fill <span class='op'>=</span> <span class='va'>strata</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_step</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_rect</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>time</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>,
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='fl'>0</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>label_percent</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#EBCC2A"</span>, 
    <span class='st'>"No Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#899DA4"</span> 
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>  
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Predicted Time to FP Adoption by Intentions Within 1 Year of Phase 1"</span>,
    x <span class='op'>=</span> <span class='st'>"Consecutive Months after Phase 1 FQ Interview"</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, fill <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>theme_pma</span> 
</code></pre>
</div>
<p><img src="phase2-calendar_files/figure-html5/unnamed-chunk-47-1.png" width="1152" /></p>
</div>
<p>Here, we see that women who planned to adopt a method within 1 year
following the Phase 1 interview were significantly quicker to begin
using one compared to women who had no such plans (except within the
first few months for women in Nigeria, where this difference was not
statistically significant). Finally, let’s consider the interaction
reported in <code>INTERACT_1</code>.</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>adopt_models</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/nest.html'>unnest</a></span><span class='op'>(</span><span class='va'>interact</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>strata</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span>
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'>where</span><span class='op'>(</span><span class='va'>is.double</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='op'>!</span><span class='va'>time</span>, <span class='op'>~</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>.x</span><span class='op'>)</span>,
    xmax <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>time</span> <span class='op'>==</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>time</span><span class='op'>)</span>, <span class='va'>time</span>, <span class='va'>time</span> <span class='op'>+</span> <span class='fl'>1</span><span class='op'>)</span>, 
    strata <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_remove.html'>str_remove</a></span><span class='op'>(</span><span class='va'>strata</span>, <span class='st'>".*="</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>time</span>, y <span class='op'>=</span> <span class='va'>estimate</span>, fill <span class='op'>=</span> <span class='va'>strata</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_step</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_tile.html'>geom_rect</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>time</span>, xmax <span class='op'>=</span> <span class='va'>xmax</span>, ymin <span class='op'>=</span> <span class='va'>conf.low</span>, ymax <span class='op'>=</span> <span class='va'>conf.high</span><span class='op'>)</span>,
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='fl'>0</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>label_percent</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_manual.html'>scale_fill_manual</a></span><span class='op'>(</span>values <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    <span class='st'>"Unmet Need, Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#98579B"</span>,
    <span class='st'>"Unmet Need, No Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#00263A"</span>, 
    <span class='st'>"No Unmet Need, Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#CCBA72"</span>,
    <span class='st'>"No Unmet Need, No Plan 1 Yr"</span> <span class='op'>=</span> <span class='st'>"#81A88D"</span>
  <span class='op'>)</span><span class='op'>)</span>  <span class='op'>+</span>  
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Predicted Time to FP Adoption by Phase 1 Intentions and Unmet Need"</span>,
    x <span class='op'>=</span> <span class='st'>"Consecutive Months after Phase 1 FQ Interview"</span>, y <span class='op'>=</span> <span class='cn'>NULL</span>, fill <span class='op'>=</span> <span class='cn'>NULL</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>theme_pma</span> 
</code></pre>
</div>
<p><img src="phase2-calendar_files/figure-html5/unnamed-chunk-48-1.png" width="1152" data-distill-preview=1 /></p>
</div>
<p>The interaction between <code>UNMETYN_1</code> and
<code>FPPLANYR_1</code> seems to confirm at least one of our hypotheses:
non-users who had no unmet need and no plans to adopt a method within
the year were significantly slower to do so (again, except for the first
few months shown in Nigeria). Women without plans to adopt a method were
also somewhat slower to adopt a method if they experienced unmet need,
but there are considerable differences in the strength of this finding
across countries and over the length of the calendar period. Overall,
women who planned to adopt a method were significantly quicker to do so,
but the mitigating effects of unmet need are generally unclear.</p>
<p>We hope this preliminary analysis serves as an entry point for your
own exploration of the contraceptive calendar data included in each PMA
panel survey. Stay tuned here for updates in the coming months, when
we’ll return to the calendar to see how rainfall, temperature, and other
climate shocks impact monthly family planning behavior.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent"
role="doc-bibliography">
<div id="ref-Anglewicz2022-mx" class="csl-entry" role="doc-biblioentry">
Anglewicz, Philip, Dana Sarnak, Alison Gemmill, and Stan Becker. 2022.
<span>“Characteristics Associated with Consistency in Reporting of
Contraceptive Use: Assessing the Reliability of the Contraceptive
Calendar in Eight Countries.”</span> In <em><span>PAA</span> 2022 Annual
Meeting</em>. Atlanta, GA: Population Association of America. <a
href="https://paa.confex.com/paa/2022/meetingapp.cgi/Paper/26280">https://paa.confex.com/paa/2022/meetingapp.cgi/Paper/26280</a>.
</div>
</div>
<section class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>The related variable <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETH#codes_section">FPCURREFFMETH</a>
reports the most effective method reported by each woman. In <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>,
these responses are combined with detailed information about her use of
the lactational amenorrhea method (LAM), emergency contraception, or
specific types of injectable methods.<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Burkina Faso, Kenya, DRC (Kinshasa
and Kongo Central), and Nigeria (Kano and Lagos)<a href="#fnref2"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p><a
href="https://pma.ipums.org/pma-action/variables/COUNTRYSTR#codes_section">COUNTRYSTR</a>
also contains ISO codes for each country, but it contains blank values
for women with responses from only one phase.<a href="#fnref3"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>Here, we’re counting the number of
commas in each string, so we add <code>+1</code>
(e.g. <code>0,0,0</code> has two commas, but three responses).<a
href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="references">References</h3>
<div id="references-listing"></div>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
