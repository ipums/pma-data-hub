<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Calculating Key Indicators for Family Planning Panel Data</title>

  <meta property="description" itemprop="description" content="We show how to reproduce measures featured in PMA panel reports, and how to visualize significant differences between groups in figures built with ggplot2."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-04-19"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-04-19"/>
  <meta name="article:author" content="Matt Gunther"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Calculating Key Indicators for Family Planning Panel Data"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="We show how to reproduce measures featured in PMA panel reports, and how to visualize significant differences between groups in figures built with ggplot2."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Calculating Key Indicators for Family Planning Panel Data"/>
  <meta property="twitter:description" content="We show how to reproduce measures featured in PMA panel reports, and how to visualize significant differences between groups in figures built with ggplot2."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","categories","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Calculating Key Indicators for Family Planning Panel Data"]},{"type":"character","attributes":{},"value":["We show how to reproduce measures featured in PMA panel reports, and how to visualize significant differences between groups in figures built with ggplot2.\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["Panel Data","Data Visualization","Data Analysis","Family Planning","Weights","Sample Clusters","ggplot2","srvyr"]},{"type":"character","attributes":{},"value":["2022-04-19"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data/pma_00105.dat.gz","data/pma_00105.xml","data/pma_00106.dat.gz","data/pma_00106.xml","images/checkout.png","images/samples.png","phase2-indicators_files/anchor-4.2.2/anchor.min.js","phase2-indicators_files/bowser-1.9.3/bowser.min.js","phase2-indicators_files/distill-2.2.21/template.v2.js","phase2-indicators_files/figure-html5/unnamed-chunk-15-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-16-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-17-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-18-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-19-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-20-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-21-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-22-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-23-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-24-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-25-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-26-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-27-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-28-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-29-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-30-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-31-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-32-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-33-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-34-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-35-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-36-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-37-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-38-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-39-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-40-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-41-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-42-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-43-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-44-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-45-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-47-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-5-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-6-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-7-1.png","phase2-indicators_files/figure-html5/unnamed-chunk-8-1.png","phase2-indicators_files/header-attrs-2.11/header-attrs.js","phase2-indicators_files/header-attrs-2.14/header-attrs.js","phase2-indicators_files/jquery-3.6.0/jquery-3.6.0.js","phase2-indicators_files/jquery-3.6.0/jquery-3.6.0.min.js","phase2-indicators_files/jquery-3.6.0/jquery-3.6.0.min.map","phase2-indicators_files/popper-2.6.0/popper.min.js","phase2-indicators_files/tippy-6.2.7/tippy-bundle.umd.min.js","phase2-indicators_files/tippy-6.2.7/tippy-light-border.css","phase2-indicators_files/tippy-6.2.7/tippy.css","phase2-indicators_files/tippy-6.2.7/tippy.umd.min.js","phase2-indicators_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="phase2-indicators_files/header-attrs-2.14/header-attrs.js"></script>
  <script src="phase2-indicators_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="phase2-indicators_files/popper-2.6.0/popper.min.js"></script>
  <link href="phase2-indicators_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="phase2-indicators_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="phase2-indicators_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="phase2-indicators_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="phase2-indicators_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="phase2-indicators_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="phase2-indicators_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Calculating Key Indicators for Family Planning Panel Data","description":"We show how to reproduce measures featured in PMA panel reports, and how to visualize significant differences between groups in figures built with ggplot2.","authors":[{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-04-19T00:00:00.000-05:00","citationText":"Gunther, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Calculating Key Indicators for Family Planning Panel Data</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">Panel Data</div>
<div class="dt-tag">Data Visualization</div>
<div class="dt-tag">Data Analysis</div>
<div class="dt-tag">Family Planning</div>
<div class="dt-tag">Weights</div>
<div class="dt-tag">Sample Clusters</div>
<div class="dt-tag">ggplot2</div>
<div class="dt-tag">srvyr</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>We show how to reproduce measures featured in PMA panel reports,
and how to visualize significant differences between groups in figures
built with ggplot2.</p></p>
</div>

<div class="d-byline">
  Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>2022-04-19
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#populations-of-interest">Populations of Interest</a></li>
<li><a href="#population-inference">Population Inference</a></li>
<li><a href="#visualization">Visualization</a></li>
<li><a href="#key-indicators">Key Indicators</a>
<ul>
<li><a href="#contraceptive-use-or-non-use">Contraceptive Use or
Non-Use</a></li>
<li><a href="#contraceptive-method-type">Contraceptive Method
Type</a></li>
<li><a href="#contraceptive-dynamics-by-subgroup">Contraceptive Dynamics
by Subgroup</a>
<ul>
<li><a href="#age">Age</a></li>
<li><a href="#education-level">Education level</a></li>
<li><a href="#marital-status">Marital status</a></li>
<li><a href="#parity">Parity</a></li>
</ul></li>
<li><a href="#other-panel-dynamics">Other Panel Dynamics</a>
<ul>
<li><a href="#unmet-need">Unmet need</a></li>
<li><a href="#partner-support">Partner support</a></li>
<li><a href="#intentions">Intentions</a></li>
</ul></li>
</ul></li>
<li><a href="#wrap-up">Wrap-up</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>We’ve mentioned in previous posts in <a
href="../../#category:Panel_Data">this series</a> that data from the new
<a href="../2022-03-01-phase2-discovery/index.html">PMA panel study</a>
gives researchers an important tool for understanding how women’s family
planning demand and utilization changes over time. In particular, PMA
surveys cover topics like:</p>
<ul>
<li>pregnancy intentions and outcomes</li>
<li>current use of long-acting, short-acting, and traditional
contraceptives</li>
<li>discontinuation of family planning</li>
<li>intentions for future use of family planning</li>
<li>unmet need for family planning</li>
<li>partner’s support for use of family planning</li>
</ul>
<p>IPUMS PMA recently released <strong>harmonized data</strong> from
four of the participating countries where the first two phases of data
collection in this three-year panel study have already been completed.
In this post, we’ll demonstrate how to use an <a
href="../2022-03-15-phase2-formats/">IPUMS PMA data extract</a> to
calculate and compare key family planning indicators across multiple
samples.</p>
<p>Our partners at PMA have published indicators for each of these
samples, individually. Phase 2 panel results summaries are available
for:</p>
<ul>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/Burkina%20National_Phase%202_Panel_Results%20Brief_English_Final.pdf">Burkina
Faso</a></li>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kinshasa_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC
- Kinshasa</a></li>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/DRC%20Kongo%20Central_%20Phase%202%20Panel%20Results%20Brief_English_Final.pdf">DRC
- Kongo Central</a></li>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/Kenya%20National_Phase%202_Panel%20Results%20Brief_Final.pdf">Kenya</a></li>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20KANO_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria
- Kano</a></li>
<li><a
href="https://www.pmadata.org/sites/default/files/data_product_results/Nigeria%20LAGOS_Phase%202_Panel_Results%20Brief_Final.pdf">Nigeria
- Lagos</a></li>
</ul>
<aside>
Interested in building the <strong>alluvial plots</strong> seen in these
reports? Join us again in two weeks, when we’ll dig into the <a
href="https://corybrunson.github.io/ggalluvial/index.html">ggalluvial</a>
package!
</aside>
<p>Here, we’ll share code you can use to reproduce the findings in each
report, and we’ll demonstrate one simple approach to visualizing
indicators across samples with <a
href="https://ggplot2.tidyverse.org/index.html">ggplot2</a>, a popular
graphics package included in the <a
href="https://tidyverse.tidyverse.org/index.html">tidyverse</a> toolkit
for R.</p>
<h1 id="setup">Setup</h1>
<p>To get started, you’ll need to load three main packages:</p>
<ul>
<li><a href="https://tidyverse.tidyverse.org/index.html">tidyverse</a>,
which includes <a
href="https://ggplot2.tidyverse.org/index.html">ggplot2</a> and other
data manipulation tools</li>
<li><a href="https://tech.popdata.org/ipumsr/">ipumsr</a> for working
with IPUMS data</li>
<li><a href="http://gdfe.co/srvyr/index.html">srvyr</a> for use of
survey design information (survey weights and sample cluster IDs)</li>
</ul>
<aside>
<a href="http://gdfe.co/srvyr/index.html">srvyr</a> brings <a
href="https://tidyverse.tidyverse.org/index.html">tidyverse</a> syntax
to the popular <a
href="http://r-survey.r-forge.r-project.org/survey/">survey</a> package.
</aside>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://gdfe.co/srvyr/'>srvyr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We’ll feature data organized in <strong>wide format</strong> for each
of the six samples currently available from IPUMS PMA. You’ll find the
“wide” option under the “Longitudinal” sample button on our <a
href="https://pma.ipums.org/pma-action/samples">Select Samples</a>
page.</p>
<aside>
IPUMS PMA also publishes panel data in <strong>long format</strong>.
Check out our complete <a href="../2022-03-15-phase2-formats/">guide to
longitudinal data extracts</a> for details.
</aside>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/samples.png" width="832" /></p>
</div>
<p>Notice that, under “Sample Members”, we’ve selected the button for
“Female Respondents”. This excludes records for all household members
who are not, themselves, members of the panel study. You’ll find one row
for each woman who completed all or part of the Female Questionnaire for
at least one phase of the study.</p>
<aside>
For details on panel enrollment and loss to follow-up, see our <a
href="../2022-04-01-phase2-members/">panel membership</a> guide.
</aside>
<p>Add the following variables to you Data Cart, then click the <a
href="https://pma.ipums.org/pma-action/extract_requests/variables">View
Cart</a> button to begin checkout (<a
href="https://pma.ipums.org/pma-action/faq#ques28">preselected</a>
variables are added automatically).</p>
<ul>
<li><a
href="https://pma.ipums.org/pma-action/variables/RESULTFQ#codes_section">RESULTFQ</a>
- Result of female questionnaire</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a>
- Phase 2 female panel weight</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/RESIDENT#codes_section">RESIDENT</a>
- Household residence / membership</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/AGE#codes_section">AGE</a>
- Age in female questionnaire</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>
- Pregnancy status</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a>
- Number of birth events</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a>
- Highest level of school attended (4 categories)</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a>
- Marital status</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>
- Province, DRC</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>
- State, Nigeria</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>
- Contraceptive user</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>
- Most effective current FP method</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a>
- Total unmet need</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a>
- Husband / partner would be supportive of FP use</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a>
- When will start using FP method in the future - value</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a>
- When will start using FP method in the future - unit</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a>
- PMA country (preselected)</li>
<li><a
href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a>
- Enumeration area (preselected)</li>
</ul>
<p>Before completing checkout, make sure that you’ve selected the
<code>dat</code> data format (fixed-width text).</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/checkout.png" width="843" /></p>
</div>
<p>Finally, you’ll need to download 2 files: an <code>xml</code>
metadata file and a <code>dat.gz</code> compressed data file. We’ve
saved both of these files in the “data” folder in R’s working directory,
so we’ll import both to create a dataframe called <code>dat</code>:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00106.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00106.dat.gz"</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="populations-of-interest">Populations of Interest</h1>
<p>We’ve mentioned in previous posts that PMA samples are only valid for
the <a
href="../2022-03-01-phase2-discovery/#inclusion-criteria-for-analysis">de
facto</a> population: these are women who slept in the household during
the night before the interview for the Household Questionnaire in both
phases. These women are coded either <code>11</code> or <code>22</code>
in both <code>RESIDENT_1</code> and <code>RESIDENT_2</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>RESIDENT_1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11</span>, <span class='fl'>22</span><span class='op'>)</span> <span class='op'>&amp;</span> <span class='va'>RESIDENT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11</span>, <span class='fl'>22</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We also mentioned in our <a
href="../2022-04-01-phase2-members/">sample membership guide</a> that
women who completed the Phase 1 Female Questionnaire may have been
<strong>lost to follow-up</strong> at Phase 2. As a reminder, we’ll need
to drop any cases where <code>RESULTFQ_2</code> is not coded
<code>1</code> for “completed”.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>RESULTFQ_2</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Additionally, a small number of women in each sample elected not to
respond to key questions regarding current use of contraceptives. These
cases are coded <code>90</code> and above, as shown on the <a
href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>
Codes tab. In a <strong>wide</strong> extract, these cases can be
identified with <code>CP_1</code> and <code>CP_2</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>CP_1</span> <span class='op'>&lt;</span> <span class='fl'>90</span>, <span class='va'>CP_2</span> <span class='op'>&lt;</span> <span class='fl'>90</span><span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Finally, recall that only the Burkina Faso and Kenya samples are
<strong>nationally representative</strong>. Samples from DRC represent
regions identified by <a
href="https://pma.ipums.org/pma-action/variables/GEOCD#codes_section">GEOCD</a>,
while samples from Nigeria represent regions identified by <a
href="https://pma.ipums.org/pma-action/variables/GEONG#codes_section">GEONG</a>.
In order to distinguish each population of interest, we’ll define a
custom variable <code>POP</code> that shows each sample’s <a
href="https://pma.ipums.org/pma-action/variables/COUNTRY#codes_section">COUNTRY</a>
label concatenated with each of these regions where appropriate.</p>
<ul>
<li><code>POP</code> - Population of interest</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>POP <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>GEOCD</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"DRC -"</span>, <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>GEOCD</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>GEONG</span><span class='op'>)</span> <span class='op'>~</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span><span class='op'>(</span><span class='st'>"Nigeria -"</span>, <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>GEONG</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<p>The remaining sample size for each population of interest is simply a
<a href="https://dplyr.tidyverse.org/reference/count.html">count</a> of
each level in <code>POP</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 × 2
  POP                     n
  &lt;chr&gt;               &lt;int&gt;
1 Burkina Faso         5207
2 DRC - Kinshasa       1967
3 DRC - Kongo Central  1511
4 Kenya                6934
5 Nigeria - Kano        998
6 Nigeria - Lagos      1088</code></pre>
</div>
<h1 id="population-inference">Population Inference</h1>
<p>We’ll use the <a href="http://gdfe.co/srvyr/index.html">srvyr</a>
package to incorporate survey design information into each of the
population estimates calculated below. This includes <a
href="https://pma.ipums.org/pma-action/variables/PANELWEIGHT#codes_section">PANELWEIGHT</a>,
which represents the calculated inverse selection probability for all
panel members, adjusted for loss to follow-up.</p>
<p>You might remember from <a
href="../2022-03-01-phase2-discovery/#survey-design-elements">earlier
posts</a> that PMA surveys are collected within spatially-defined
<strong>sample clusters</strong>. We’ll also include identifying numbers
for each cluster as survey design information via <a
href="https://pma.ipums.org/pma-action/variables/EAID#codes_section">EAID</a>.
Here, we’ll use clusters identified in <code>EAID_1</code>.<a
href="#fn1" class="footnote-ref" id="fnref1"
role="doc-noteref"><sup>1</sup></a></p>
<p>Most PMA samples are also collected within separate strata indicated
by <a
href="https://pma.ipums.org/pma-action/variables/STRATA#codes_section">STRATA</a>.
We’ve <a
href="../2022-03-01-phase2-discovery/#survey-design-elements">previously
noted</a> that <code>STRATA</code> is <em>not available</em> for samples
collected from DRC - Kinshasa and DRC - Kongo Central, so we
demonstrated how to create placeholder codes for those samples in a
variable we called <code>STRATA_RECODE</code>. To review:
<code>STRATA_RECODE</code> uses unique numeric codes from
<code>STRATA</code>, except that it also includes unique identifiers for
each sampled region in <code>GEOCD</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    STRATA_RECODE <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>GEOCD</span><span class='op'>)</span>, 
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>STRATA_1</span><span class='op'>)</span>, 
      <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>GEOCD</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 

<span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>STRATA_1</span>, <span class='va'>GEOCD</span>, <span class='va'>STRATA_RECODE</span><span class='op'>)</span> 
</code></pre>
</div>
<pre><code># A tibble: 28 × 4
                            STRATA_1              GEOCD STRATA_RECODE     n
                           &lt;int+lbl&gt;          &lt;int+lbl&gt;         &lt;dbl&gt; &lt;int&gt;
 1 40410 [Bungoma - urban, Kenya]    NA                         40410   153
 2 40411 [Bungoma - rural, Kenya]    NA                         40411   488
 3 40412 [Kakamega - urban, Kenya]   NA                         40412   133
 4 40413 [Kakamega - rural, Kenya]   NA                         40413   438
 5 40414 [Kericho - urban, Kenya]    NA                         40414   249
 6 40415 [Kericho - rural, Kenya]    NA                         40415   453
 7 40416 [Kiambu - urban, Kenya]     NA                         40416   213
 8 40417 [Kiambu - rural, Kenya]     NA                         40417   311
 9 40418 [Kilifi - urban, Kenya]     NA                         40418   170
10 40419 [Kilifi - rural, Kenya]     NA                         40419   455
11 40420 [Kitui - urban, Kenya]      NA                         40420   153
12 40421 [Kitui - rural, Kenya]      NA                         40421   585
13 40422 [Nairobi - urban, Kenya]    NA                         40422   493
14 40423 [Nandi - urban, Kenya]      NA                         40423   260
15 40424 [Nandi - rural, Kenya]      NA                         40424   711
16 40425 [Nyamira - urban, Kenya]    NA                         40425   143
17 40426 [Nyamira - rural, Kenya]    NA                         40426   382
18 40427 [Siaya - urban, Kenya]      NA                         40427   130
19 40428 [Siaya - rural, Kenya]      NA                         40428   437
20 40429 [West Pokot - urban, Kenya] NA                         40429   104
21 40430 [West Pokot - rural, Kenya] NA                         40430   473
22 56606 [Lagos, Nigeria]            NA                         56606  1088
23 56611 [Kano - Urban]              NA                         56611   437
24 56612 [Kano - Rural]              NA                         56612   561
25 85401 [Urban, Burkina Faso]       NA                         85401  3053
26 85402 [Rural, Burkina Faso]       NA                         85402  2154
27    NA                              1 [Kinshasa]                  1  1967
28    NA                              2 [Kongo Central]             2  1511</code></pre>
</div>
<p>The <a href="http://gdfe.co/srvyr/index.html">srvyr</a> function <a
href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>
allows us to pass the information in <code>PANELWEIGHT</code>,
<code>EAID_1</code>, and <code>STRATA_RECODE</code> to other package
functions like <a
href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.
We’ll also demonstrate how to use this information in formal
significance tests within each sample via <a
href="http://gdfe.co/srvyr/reference/svychisq.html">svychisq</a>.</p>
<aside>
Check out <a
href="../2022-03-01-phase2-discovery/#survey-design-elements">this
post</a> for more information on PMA survey design and the <a
href="http://gdfe.co/srvyr/index.html">srvyr</a> package.
</aside>
<p>Let’s begin with a simple example. The variable <a
href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>
indicates whether a woman was currently using any family planning
method. The variables <code>CP_1</code> and <code>CP_2</code> in our
<strong>wide</strong> extract represent responses collected at Phase 1
and Phase 2, respectively. With help from <a
href="http://gdfe.co/srvyr/index.html">srvyr</a>, we’ll obtain a
population-level estimate of the proportion of women who were using a
method at Phase 2, given their status at Phase 1.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CP_1</span>, <span class='va'>CP_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>cp_tbl</span>
</code></pre>
</div>
<pre><code># A tibble: 24 × 6
# Groups:   POP [6]
   POP                      CP_1      CP_2   coef `_low` `_upp`
   &lt;chr&gt;               &lt;int+lbl&gt; &lt;int+lbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Burkina Faso          0 [No]    0 [No]  0.790  0.763  0.815 
 2 Burkina Faso          0 [No]    1 [Yes] 0.210  0.185  0.237 
 3 Burkina Faso          1 [Yes]   0 [No]  0.347  0.306  0.391 
 4 Burkina Faso          1 [Yes]   1 [Yes] 0.653  0.609  0.694 
 5 DRC - Kinshasa        0 [No]    0 [No]  0.739  0.685  0.787 
 6 DRC - Kinshasa        0 [No]    1 [Yes] 0.261  0.213  0.315 
 7 DRC - Kinshasa        1 [Yes]   0 [No]  0.275  0.239  0.314 
 8 DRC - Kinshasa        1 [Yes]   1 [Yes] 0.725  0.686  0.761 
 9 DRC - Kongo Central   0 [No]    0 [No]  0.736  0.685  0.782 
10 DRC - Kongo Central   0 [No]    1 [Yes] 0.264  0.218  0.315 
11 DRC - Kongo Central   1 [Yes]   0 [No]  0.270  0.207  0.343 
12 DRC - Kongo Central   1 [Yes]   1 [Yes] 0.730  0.657  0.793 
13 Kenya                 0 [No]    0 [No]  0.697  0.676  0.717 
14 Kenya                 0 [No]    1 [Yes] 0.303  0.283  0.324 
15 Kenya                 1 [Yes]   0 [No]  0.200  0.183  0.217 
16 Kenya                 1 [Yes]   1 [Yes] 0.800  0.783  0.817 
17 Nigeria - Kano        0 [No]    0 [No]  0.946  0.910  0.968 
18 Nigeria - Kano        0 [No]    1 [Yes] 0.0544 0.0321 0.0905
19 Nigeria - Kano        1 [Yes]   0 [No]  0.440  0.308  0.581 
20 Nigeria - Kano        1 [Yes]   1 [Yes] 0.560  0.419  0.692 
21 Nigeria - Lagos       0 [No]    0 [No]  0.757  0.713  0.796 
22 Nigeria - Lagos       0 [No]    1 [Yes] 0.243  0.204  0.287 
23 Nigeria - Lagos       1 [Yes]   0 [No]  0.240  0.196  0.290 
24 Nigeria - Lagos       1 [Yes]   1 [Yes] 0.760  0.710  0.804 </code></pre>
</div>
<p>Here, we first use <a
href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a> to
divide the data extract into individual samples defined by
<code>POP</code>. We then reference each of these samples as <a
href="https://dplyr.tidyverse.org/reference/context.html">cur_data</a>
inside a summary function defined by <a
href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a> -
this ensures that the population estimates obtained from our combined
data extract are identical to those you would obtain if you downloaded
one extract for each sample and analyzed them separately.</p>
<p>Within <a
href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a>, we
use <a
href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>
to specify information about the design of each sample, and we then use
a second <a
href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a> to
identify each of our variables of interest, <code>CP_1</code> and
<code>CP_2</code>. Finally, we use a second <a
href="http://gdfe.co/srvyr/reference/summarise.html">summarise</a>
function to calculate a <a
href="http://gdfe.co/srvyr/index.html">srvyr</a> summary statistic: in
this case, we use <a
href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>
to estimate proportions in the population.</p>
<p>The population estimate for each row appears in the column
<code>_coef</code>. Looking at row 1, we would estimate that 79% of
women aged 15-49 in Burkina Faso used <em>no method</em> both at Phase 1
and again at Phase 2. The columns <code>_low</code> and
<code>_upp</code> report the limits of a 95% confidence interval: 76.3%
and 81.5%.</p>
<aside>
You may change the confidence interval to, for example, 99% by setting
<code>level = 0.99</code> in <a
href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.
</aside>
<p>Comparing these confidence intervals gives us an informal,
conservative way to test for a significant difference between outcomes
for each <code>POP</code>: if the intervals for any pair of outcomes in
the same sample include no common values, we’ll say that a significant
difference exists. <em>Formal testing may also reveal significant
differences between pairs of outcomes where these intervals overlap only
slightly.</em> Our approach is well suited for data visualization, but
it should not replace formal testing. Fortunately, you can adapt our
code to replace (or complement) the output from <a
href="http://gdfe.co/srvyr/reference/survey_mean.html">survey_mean</a>.</p>
<p>For example, here we demonstrate how to calculate a Rao-Scott
chi-square test for significant differences between the estimated
population proportions for each <code>POP</code> and the proportions we
would <em>expect</em> to observe if Phase 2 outcomes were statistically
independent from Phase 1 conditions.<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a> Because we’re interested
in just one summary statistic per sample, we no longer need to <a
href="http://gdfe.co/srvyr/reference/group_by.html">group_by</a>
<code>CP_1</code> and <code>CP_2</code>; instead, we’ll use the formula
<code>~CP_1 + CP_2</code> in the function <a
href="https://rdrr.io/cran/survey/man/svychisq.html">svychisq</a>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rao_tbl</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>,  strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>rao <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/svychisq.html'>svychisq</a></span><span class='op'>(</span><span class='op'>~</span><span class='va'>CP_1</span> <span class='op'>+</span> <span class='va'>CP_2</span>, design <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='va'>list</span><span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>rao_tbl</span>
</code></pre>
</div>
<pre><code># A tibble: 6 × 2
# Groups:   POP [6]
  POP                 rao    
  &lt;chr&gt;               &lt;list&gt; 
1 Burkina Faso        &lt;htest&gt;
2 DRC - Kinshasa      &lt;htest&gt;
3 DRC - Kongo Central &lt;htest&gt;
4 Kenya               &lt;htest&gt;
5 Nigeria - Kano      &lt;htest&gt;
6 Nigeria - Lagos     &lt;htest&gt;</code></pre>
</div>
<p>Our new summary column <code>rao</code> contains output for each
sample’s test in a <a
href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/list">list</a>.
From here, you can extract output elements <a
href="https://dplyr.tidyverse.org/articles/rowwise.html">rowwise</a> by
name like so:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rao_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rowwise.html'>rowwise</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    `F` <span class='op'>=</span> <span class='va'>rao</span><span class='op'>$</span><span class='va'>statistic</span>, 
    p.value <span class='op'>=</span> <span class='va'>rao</span><span class='op'>$</span><span class='va'>p.value</span>,
    sig95 <span class='op'>=</span> <span class='va'>p.value</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 × 5
# Rowwise:  POP
  POP                 rao          F   p.value sig95
  &lt;chr&gt;               &lt;list&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;lgl&gt;
1 Burkina Faso        &lt;htest&gt;  468.  4.62e- 50 TRUE 
2 DRC - Kinshasa      &lt;htest&gt;  216.  4.80e- 21 TRUE 
3 DRC - Kongo Central &lt;htest&gt;  123.  9.43e- 16 TRUE 
4 Kenya               &lt;htest&gt; 1140.  8.58e-102 TRUE 
5 Nigeria - Kano      &lt;htest&gt;   89.2 2.23e-  9 TRUE 
6 Nigeria - Lagos     &lt;htest&gt;  204.  2.85e- 19 TRUE </code></pre>
</div>
<h1 id="visualization">Visualization</h1>
<p>We’ll use simple <strong>grouped bar charts</strong> to show
population estimates for each proportion below. A grouped bar chart
differs from the <strong>stacked bar charts</strong> shown in PMA
reports in that each response is plotted along an axis (rather than
stacked together in a single bar). We’ll show <strong>grouped bar
charts</strong> here so that we can also include <strong>error
bars</strong> representing a 95% confidence interval for each
proportion.</p>
<p>For example, let’s plot the estimates created in <code>cp_tbl</code>
above. As a preliminary step, we’ll recode <code>CP_1</code> and
<code>CP_2</code> with <a
href="https://forcats.tidyverse.org/reference/as_factor.html">as_factor</a>
and sort their levels with <a
href="https://forcats.tidyverse.org/reference/fct_relevel.html">fct_relevel</a>.
This ensures that the <em>value labels</em> for each variable will be
printed on our plot.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'>&lt;-</span> <span class='va'>cp_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>CP_1</span>, <span class='va'>CP_2</span><span class='op'>)</span>,
      <span class='op'>~</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_relevel.html'>fct_relevel</a></span><span class='op'>(</span><span class='st'>"No"</span>, <span class='st'>"Yes"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Next, we’ll use <a
href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2</a>
to build the plot. Because our data includes multiple samples, we’ll use
<a
href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a>
to plot all summary data in multiple panels. The functions <a
href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a>
and <a
href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_errorbar</a>
plot the grouped bars and error bars, respectively. A baseline plot
should look something like this:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CP_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span>, cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CP_1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>stat <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_errorbar</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>`_low`</span>, xmax <span class='op'>=</span> <span class='va'>`_upp`</span><span class='op'>)</span>, width <span class='op'>=</span> <span class='fl'>0.2</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-15-1.png" width="1152" /></p>
</div>
<p>One of the powerful features of <a
href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot2</a>
is that you can use <a
href="https://ggplot2.tidyverse.org/reference/ggtheme.html">pre-built
themes</a> to customize this baseline layout. We’ll build on <a
href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a>
to create our own <code>theme_pma</code> (with custom fonts incorporated
by the <a
href="https://cran.r-project.org/package=sysfonts">sysfonts</a> and <a
href="https://cran.rstudio.com/web/packages/showtext/vignettes/introduction.html">showtext</a>
packages). <strong>Feel free to use our theme, or tweak it to create
your own!</strong></p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span>

<span class='fu'>sysfonts</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/sysfonts/man/font_add.html'>font_add</a></span><span class='op'>(</span>
  family <span class='op'>=</span> <span class='st'>"cabrito"</span>, 
  regular <span class='op'>=</span> <span class='st'>"../../fonts/cabritosansnormregular-webfont.ttf"</span>
<span class='op'>)</span>
<span class='fu'>showtext</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>theme_pma</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_minimal</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://ggplot2.tidyverse.org/reference/theme_get.html'>%+replace%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
    text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"cabrito"</span>, size <span class='op'>=</span> <span class='fl'>13</span><span class='op'>)</span>,
    plot.title <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>22</span>, color <span class='op'>=</span> <span class='st'>"#00263A"</span>, 
                              hjust <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
    plot.subtitle <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>hjust <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>,
    strip.background <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    strip.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>16</span>, angle <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
    panel.spacing <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/grid/unit.html'>unit</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"lines"</span><span class='op'>)</span>,
    axis.title.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>0</span>, margin <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>margin</a></span><span class='op'>(</span>r <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Throughout this post, we’ll be repeating the same functions to create
grouped bars, error bars, and labels for our plot. In order to avoid
repeating ourselves each time, we’ll combine these functions together
with <code>theme_pma</code> in a single function called
<code>pma_bars</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>pma_bars</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span>
  <span class='va'>title</span> <span class='op'>=</span> <span class='cn'>NULL</span>,     <span class='co'># an optional title </span>
  <span class='va'>subtitle</span> <span class='op'>=</span> <span class='cn'>NULL</span>,  <span class='co'># an optional subtitle </span>
  <span class='va'>xaxis</span> <span class='op'>=</span> <span class='cn'>NULL</span>,     <span class='co'># an optional label for the x-axis (displayed above)</span>
  <span class='va'>yaxis</span> <span class='op'>=</span> <span class='cn'>NULL</span>      <span class='co'># an optional label for the y-axis (displayed left)</span>
<span class='op'>)</span><span class='op'>{</span>
  <span class='va'>components</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='kw'>if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/exists.html'>exists</a></span><span class='op'>(</span><span class='st'>"theme_pma"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span><span class='va'>theme_pma</span><span class='op'>}</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='va'>title</span>,
      subtitle <span class='op'>=</span> <span class='va'>subtitle</span>,
      y <span class='op'>=</span> <span class='fu'><a href='https://stringr.tidyverse.org/reference/str_wrap.html'>str_wrap</a></span><span class='op'>(</span><span class='va'>yaxis</span>, <span class='fl'>10</span><span class='op'>)</span>,
      x <span class='op'>=</span> <span class='cn'>NULL</span>,
      fill <span class='op'>=</span> <span class='cn'>NULL</span>
    <span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>
      position <span class='op'>=</span> <span class='st'>'bottom'</span>,
      sec.axis <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/sec_axis.html'>sec_axis</a></span><span class='op'>(</span>trans <span class='op'>=</span> <span class='op'>~</span><span class='va'>.</span>, name <span class='op'>=</span> <span class='va'>xaxis</span>, breaks <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>,
      labels <span class='op'>=</span> <span class='fu'>scales</span><span class='fu'>::</span><span class='fu'><a href='https://scales.r-lib.org/reference/label_percent.html'>label_percent</a></span><span class='op'>(</span><span class='op'>)</span>
    <span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_discrete.html'>scale_y_discrete</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='va'>rev</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_bar.html'>geom_bar</a></span><span class='op'>(</span>stat <span class='op'>=</span> <span class='st'>"identity"</span>, fill <span class='op'>=</span> <span class='st'>"#98579BB0"</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_errorbar</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>xmin <span class='op'>=</span> <span class='va'>`_low`</span>, xmax <span class='op'>=</span> <span class='va'>`_upp`</span><span class='op'>)</span>, 
      width <span class='op'>=</span> <span class='fl'>0.2</span>, 
      color <span class='op'>=</span> <span class='st'>"#00263A"</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Going forward, we’ll incorporate <code>pma_bars</code> together with
a <a
href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a>
and <a
href="https://ggplot2.tidyverse.org/reference/index.html#facetting">facet</a>
function for a given set of variables like so:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CP_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span>, cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CP_1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Change in Contracptive Use Status"</span>,
    subtitle <span class='op'>=</span> <span class='st'>"A grouped bar chart, faceted by population of interest"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 1"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-18-1.png" width="1152" /></p>
</div>
<h1 id="key-indicators">Key Indicators</h1>
<h2 id="contraceptive-use-or-non-use">Contraceptive Use or Non-Use</h2>
<p>Let’s continue our examination of <a
href="https://pma.ipums.org/pma-action/variables/CP#codes_section">CP</a>.
In the PMA reports for each sample linked above, you’ll notice that
women who were pregnant at either phase are distinguished from women who
reported use or non-use in <code>CP_1</code> or <code>CP_2</code>. We’ll
identify these women in the variable <a
href="https://pma.ipums.org/pma-action/variables/PREGNANT#codes_section">PREGNANT</a>,
and then we’ll create a combined indicator called
<code>FPSTATUS</code>.</p>
<ul>
<li><code>FPSTATUS</code> - Pregnant, using contraception, or using no
contraception</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    FPSTATUS_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>PREGNANT_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Pregnant"</span>,
      <span class='va'>CP_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Using FP"</span>,
      <span class='va'>CP_1</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"Not Using FP"</span>
    <span class='op'>)</span>, 
    FPSTATUS_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>PREGNANT_2</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Pregnant"</span>,
      <span class='va'>CP_2</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Using FP"</span>,
      <span class='va'>CP_2</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='st'>"Not Using FP"</span>
    <span class='op'>)</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>FPSTATUS_1</span>, <span class='va'>FPSTATUS_2</span><span class='op'>)</span>,
      <span class='op'>~</span><span class='va'>.x</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_relevel.html'>fct_relevel</a></span><span class='op'>(</span><span class='st'>"Pregnant"</span>, <span class='st'>"Not Using FP"</span>, <span class='st'>"Using FP"</span><span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We’ll now revise <code>cp_tbl</code> to include information from
<code>FPSTATUS_1</code> and <code>FPSTATUS_2</code>. This will help us
answer key questions like:</p>
<ul>
<li>Are women who were pregnant at Phase 1 more likely to use or not use
family planning at Phase 2?</li>
<li>Are women who were using (or not using) contraception at Phase 1
likely to maintain the same status at Phase 2?</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>FPSTATUS_1</span>, <span class='va'>FPSTATUS_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Next, we’ll plot <code>cp_tbl</code> with <code>pma_bars</code>:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cp_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>FPSTATUS_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>FPSTATUS_1</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVE USE OR NON-USE"</span>,
    <span class='st'>"Percent women age 15-49 who changed contraceptive use status"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 1 Status"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Status"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-21-1.png" width="1152" data-distill-preview=1 /></p>
</div>
<p>To reiterate: comparing the error bars within each of these 18 panels
gives us a informal, but conservative test for significant difference.
We’ll say that a significant difference occurs where two pairs of error
bars <strong>do not overlap</strong> (but additional testing may be
necessary to determine whether a significant difference occurs where
error bars overlap only slightly). A few observations:</p>
<ul>
<li>For women who were pregnant at Phase 1, there is usually no apparent
difference between using and not using family planning at Phase 2. Kenya
and Nigeria - Kano are the exception: in Kenya, pregnant women at Phase
1 were appear more likely to be using FP at Phase 2, while the opposite
is true in Kano.<br />
</li>
<li>Overall, non-pregnant women at Phase 1 appeared more likely to
maintain the same status (use or non-use) at Phase 2 than they were to
switch or become pregnant.</li>
</ul>
<h2 id="contraceptive-method-type">Contraceptive Method Type</h2>
<p>PMA surveys also ask contraceptive users to indicate which method
they are currently using at each phase of the study. If a woman reports
using more than one method, <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETH#codes_section">FPCURREFFMETH</a>
shows her most <em>effective</em> currently used method. These responses
are combined with detailed information about use of the lactational
amenorrhea method (LAM), emergency contraception, or injectable type in
<a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>.
PMA reports use <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>
to determine whether each woman’s most effective current method is a
short-acting, long-acting, or traditional method.</p>
<p>Long-acting methods include:</p>
<ul>
<li>IUDs</li>
<li>implants</li>
<li>male sterilization</li>
<li>female sterilization</li>
</ul>
<p>Short-acting methods include:</p>
<ul>
<li>injectables (intramuscular and subcutaneous)</li>
<li>the pill</li>
<li>emergency contraception</li>
<li>male condoms</li>
<li>female condoms</li>
<li>LAM</li>
<li>diaphragm</li>
<li>foam/jelly</li>
<li>standard days method</li>
</ul>
<p>Traditional methods include:</p>
<ul>
<li>rhythm</li>
<li>withdrawal</li>
<li>other traditional</li>
</ul>
<p>These methods are coded sequentially by group in <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>.
Women who are “NIU (not in universe)” were using no method.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>FPCURREFFMETHRC_1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 19 × 2
                           FPCURREFFMETHRC_1     n
                                   &lt;int+lbl&gt; &lt;int&gt;
 1 101 [Female Sterilization]                  198
 2 102 [Male Sterilization]                      1
 3 111 [Implants]                             2248
 4 112 [IUD]                                   226
 5 121 [Injectables (3 months)]               1412
 6 123 [Injectables (Sayana Press)]            296
 7 131 [Pill]                                  547
 8 132 [Emergency Contraception]               243
 9 141 [Male condom]                           791
10 142 [Female condom]                           1
11 151 [Diaphragm]                               1
12 152 [Foam]                                    1
13 160 [Standard Days/Cycle Beads Method]       70
14 170 [Lactational amenorrhea method (LAM)]    24
15 210 [Rhythm]                                569
16 220 [Withdrawal]                            351
17 240 [Other traditional]                     153
18 998 [No response or missing]                  1
19 999 [NIU (not in universe)]               10572</code></pre>
</div>
<p>We’ll use <a
href="https://dplyr.tidyverse.org/reference/across.html">across</a> to
recode the Phase 1 and Phase 2 versions of <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>
simultaneously. We’ll also attach the prefix <code>CAT</code> to each
variable, indicating that we’ve created “categorized” versions of
each.</p>
<ul>
<li><code>CAT_FPSFPCURREFFMETHRC_1</code> - Phase 1 contraceptive method
type</li>
<li><code>CAT_FPSFPCURREFFMETHRC_2</code> - Phase 2 contraceptive method
type</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>FPCURREFFMETHRC_1</span>, <span class='va'>FPCURREFFMETHRC_2</span><span class='op'>)</span>,
      <span class='op'>~</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
        <span class='va'>.x</span> <span class='op'>&lt;</span> <span class='fl'>120</span> <span class='op'>~</span> <span class='st'>"long-acting"</span>,
        <span class='va'>.x</span> <span class='op'>&lt;</span> <span class='fl'>200</span> <span class='op'>~</span> <span class='st'>"short-acting"</span>,
        <span class='va'>.x</span> <span class='op'>&lt;</span> <span class='fl'>900</span> <span class='op'>~</span> <span class='st'>"traditional"</span>,
        <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"none"</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
        <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_relevel.html'>fct_relevel</a></span><span class='op'>(</span> <span class='st'>"long-acting"</span>, <span class='st'>"short-acting"</span>, <span class='st'>"traditional"</span>, <span class='st'>"none"</span><span class='op'>)</span>,
      .names <span class='op'>=</span> <span class='st'>"CAT_{.col}"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Next, we’ll generate population estimates for our derived variables,
<code>CAT_FPCURREFFMETHRC_1</code> and
<code>CAT_FPCURREFFMETHRC_2</code>.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>meth_tbl</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CAT_FPCURREFFMETHRC_1</span>, <span class='va'>CAT_FPCURREFFMETHRC_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>We’ll again use <code>pma_bars</code> to plot the results.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>meth_tbl</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CAT_FPCURREFFMETHRC_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CAT_FPCURREFFMETHRC_1</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVE METHOD TYPE"</span>,
    <span class='st'>"Percent of women age 15-49 who changed contraceptive method or use status"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 1 Method"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Method"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-25-1.png" width="1152" /></p>
</div>
<p>What do we learn from this plot? Let’s consider each column in
turn:</p>
<ul>
<li>Users of “long-acting” methods at Phase 1 appear more likely to have
used “long-acting” methods at Phase 2 than to have changed status
(except perhaps in Kano, where the intervals for “long-acting” and
“none” overlap at Phase 2).</li>
<li>Users of “short-acting” methods at Phase 1 appeared generally likely
to use them again at Phase 2, but some samples show that women are
equally likely to be using “none” at Phase 2. A difference between these
two outcomes is visually apparent only in Kinshasa, Kenya, and Lagos
(where women were more likely to be using “short-acting” methods than
“none”).</li>
<li>The status of Phase 1 “traditional” users is generally unclear at
Phase 2. In Kinshasa, Kongo Central, and Lagos, these women seem most
likely to remain “traditional” users at Phase 2. Elsewhere, there are no
clear trends.</li>
<li>Users of “none” at Phase 1 were clearly most likely to remain as
such at Phase 2.</li>
</ul>
<h2 id="contraceptive-dynamics-by-subgroup">Contraceptive Dynamics by
Subgroup</h2>
<p>We can also use <a
href="https://pma.ipums.org/pma-action/variables/FPCURREFFMETHRC#codes_section">FPCURREFFMETHRC</a>
to see whether women switched methods, stopped using any method, started
using any method, or made no changes. Let’s summarize this information
as <code>CHG_FPCURR</code>:</p>
<ul>
<li><code>CHG_FPCURR</code> - Change in contraceptive use between Phase
1 and Phase 2</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    CHG_FPCURR <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>FPCURREFFMETHRC_1</span> <span class='op'>&gt;</span> <span class='fl'>900</span> <span class='op'>&amp;</span> <span class='va'>FPCURREFFMETHRC_2</span> <span class='op'>&gt;</span> <span class='fl'>900</span> <span class='op'>~</span> <span class='st'>"Continued non-use"</span>,
      <span class='va'>FPCURREFFMETHRC_1</span> <span class='op'>&gt;</span> <span class='fl'>900</span> <span class='op'>~</span> <span class='st'>"Started using"</span>,
      <span class='va'>FPCURREFFMETHRC_2</span> <span class='op'>&gt;</span> <span class='fl'>900</span> <span class='op'>~</span> <span class='st'>"Stopped using"</span>,
      <span class='va'>FPCURREFFMETHRC_1</span> <span class='op'>!=</span> <span class='va'>FPCURREFFMETHRC_2</span> <span class='op'>~</span> <span class='st'>"Changed methods"</span>,
      <span class='va'>FPCURREFFMETHRC_1</span> <span class='op'>==</span> <span class='va'>FPCURREFFMETHRC_2</span> <span class='op'>~</span> <span class='st'>"Continued method"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>PMA reports disaggregate the outcomes captured in
<code>CHG_FPCURR</code> by age, marital status, education level, and
parity (number of live childbirths).</p>
<h3 id="age">Age</h3>
<p>We’ll use PMA’s categorization of <code>AGE_2</code> to examine
differences between women in three categories.</p>
<ul>
<li><code>CAT_AGE_2</code> - Phase 2 age (3 categories)</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    CAT_AGE_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>AGE_2</span> <span class='op'>&lt;</span> <span class='fl'>20</span> <span class='op'>~</span> <span class='st'>"15-19"</span>,
      <span class='va'>AGE_2</span> <span class='op'>&lt;</span> <span class='fl'>25</span> <span class='op'>~</span> <span class='st'>"20-24"</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"25-49"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Plotting <code>CAT_AGE_2</code> on the y-axis allows us to compare
confidence intervals across age groups. For example, notice that women
aged 15-19 in every population seem more likely to continue non-use than
women who are aged 20-24 or 25-49 (column 3).</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CAT_AGE_2</span>, <span class='va'>CHG_FPCURR</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CAT_AGE_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CHG_FPCURR</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVEUSE STATUS, BY AGE"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Age"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-28-1.png" width="1152" /></p>
</div>
<h3 id="education-level">Education level</h3>
<p>The variable <a
href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a>
standardizes educational categories across countries (see <a
href="https://pma.ipums.org/pma-action/variables/EDUCATT#codes_section">EDUCATT</a>
for country-specific codes). To match PMA reports, we’ll recode <a
href="https://pma.ipums.org/pma-action/variables/EDUCATTGEN#codes_section">EDUCATTGEN</a>
into just three groups:</p>
<ul>
<li><code>CAT_EDUCATTGEN_2</code> - Phase 2 education level (3
categories)</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    CAT_EDUCATTGEN_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>EDUCATTGEN_2</span> <span class='op'>&lt;</span> <span class='fl'>3</span> <span class='op'>~</span> <span class='st'>"None / Primary"</span>,
      <span class='va'>EDUCATTGEN_2</span> <span class='op'>==</span> <span class='fl'>3</span> <span class='op'>~</span> <span class='st'>"Secondary"</span>,
      <span class='va'>EDUCATTGEN_2</span> <span class='op'>==</span> <span class='fl'>4</span> <span class='op'>~</span> <span class='st'>"Tertiary"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>As with age, we’ll plot <code>CAT_EDUCATTGEN_2</code> on the y-axis.
There aren’t many clear takeaways here: confidence intervals overlap in
each column for almost every education level, so visual inspection
reveals no clear significant differences:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>EDUCATTGEN_2</span> <span class='op'>&lt;</span> <span class='fl'>90</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='co'># drop if missing </span>
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CAT_EDUCATTGEN_2</span>, <span class='va'>CHG_FPCURR</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CAT_EDUCATTGEN_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CHG_FPCURR</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVEUSE STATUS, BY EDUCATION LEVEL"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Education Level"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-30-1.png" width="1152" /></p>
</div>
<h3 id="marital-status">Marital status</h3>
<p>The variable <a
href="https://pma.ipums.org/pma-action/variables/MARSTAT#codes_section">MARSTAT</a>
indicates each woman’s marital / partnership status. PMA considers women
“in union” to be those who are currently married (code <code>21</code>)
or currently living with their partner (code <code>22</code>).
Otherwise, women who were never married, divorced / separated, or
widowed are considered “not in union”.</p>
<ul>
<li><code>CAT_MARSTAT_2</code> - Phase 2 marital status (2
categories)</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    CAT_MARSTAT_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>MARSTAT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fl'>21</span><span class='op'>:</span><span class='fl'>22</span> <span class='op'>~</span> <span class='st'>"In union"</span>,
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"Not in union"</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>Here, we see that women who were <em>not</em> in a union at Phase 2
were significantly more likely to continue non-use of contraception
compared to married / partnered women in each population. On the other
hand, women who <em>were</em> in a union mainly appeared more likely to
continue using the same method, or perhaps to change methods (most
clearly in Kenya).</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CAT_MARSTAT_2</span>, <span class='va'>CHG_FPCURR</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CAT_MARSTAT_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CHG_FPCURR</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVE METHOD TYPE, BY MARITAL STATUS"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Marital Status"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-32-1.png" width="1152" /></p>
</div>
<h3 id="parity">Parity</h3>
<p>Parity refers to the number of times a women has given live birth
(excluding stillbirths). This information is recorded in the IPUMS
variable <a
href="https://pma.ipums.org/pma-action/variables/BIRTHEVENT#codes_section">BIRTHEVENT</a>,
in which the values <code>0</code> and <code>99</code> (not in universe)
can both be interpreted as “none”.</p>
<ul>
<li><code>CAT_BIRTHEVENT_2</code> - Phase 2 number of live births (4
categories)</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    CAT_BIRTHEVENT_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>BIRTHEVENT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>99</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"None"</span>,
      <span class='va'>BIRTHEVENT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"One-two"</span>,
      <span class='va'>BIRTHEVENT_2</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Three-four"</span>,
      <span class='va'>BIRTHEVENT_2</span> <span class='op'>&gt;=</span> <span class='fl'>5</span> <span class='op'>~</span> <span class='st'>"Five +"</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_relevel.html'>fct_relevel</a></span><span class='op'>(</span><span class='st'>"None"</span>, <span class='st'>"One-two"</span>, <span class='st'>"Three-four"</span>, <span class='st'>"Five +"</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>There are few clear patterns related to parity, except that women who
have never given birth are also more likely to continue non-use of
contraception between phases.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>BIRTHEVENT_2</span> <span class='op'>!=</span> <span class='fl'>98</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='co'># drops 2 missing cases (code 98)</span>
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>CAT_BIRTHEVENT_2</span>, <span class='va'>CHG_FPCURR</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>CAT_BIRTHEVENT_2</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>CHG_FPCURR</span><span class='op'>)</span>, rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"CHANGE IN CONTRACEPTIVE METHOD TYPE, BY PARITY"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 2 Childbirths"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-34-1.png" width="1152" /></p>
</div>
<h2 id="other-panel-dynamics">Other Panel Dynamics</h2>
<p>The final page in each PMA report covers family planning dynamics
related to unmet need, partner support, and plans for future use of
family planning methods. In each case, we’ll be focusing on women who
were <em>not</em> using any method at Phase 1. We’ll show how each of
these dynamics impacts the likelihood that Phase 1 non-users would have
adopted any family planning method at Phase 2.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>CP_1</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h3 id="unmet-need">Unmet need</h3>
<p>PMA defines unmet need for family planning according to each woman’s
fertility preferences, current use of family planning methods, and risk
factors for pregnancy. Women may have “unmet need” for birth spacing
(e.g. pregnant women whose pregnancy was mistimed) or for limiting
births (e.g. pregnant women whose pregnancy was unwanted), while women
are considered “not at risk” if they are not sexually active or cannot
become pregnant. The variable <a
href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a>
provides detailed information on types of need for each woman, and on
related variables that were used to calculate unmet need.</p>
<p>The binary variable <a
href="https://pma.ipums.org/pma-action/variables/UNMETYN#codes_section">UNMETYN</a>
recodes <a
href="https://pma.ipums.org/pma-action/variables/UNMETNEED#codes_section">UNMETNEED</a>
as either “Unmet need”, or “No unmet need”. We’ll reword these labels
only slightly to minimize the amount of repeated text on our plot:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>UNMETYN_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>UNMETYN_1</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='st'>"Yes"</span>, <span class='st'>"No"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>UNMETYN_1</span>, <span class='va'>CP_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>CP_2</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>UNMETYN_1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"UNMET NEED FOR FAMILY PLANNING"</span>,
    <span class='st'>"Percent of women age 15-49 who were not using a method at Phase 1"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 2: Adopted a method"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 1: Unmet Need"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-36-1.png" width="1152" /></p>
</div>
<p>Overall, these results suggest that non-users with unmet need for
family planning at Phase 1 were more likely to adopt a method at Phase 2
compared to non-users who had none (e.g. women who were not sexually
active, could not become pregnant, etc.). However, formal testing is
needed to determine whether these trends were statistically significant
in Burkina Faso and Nigeria - Lagos.</p>
<h3 id="partner-support">Partner support</h3>
<p>Women who were not using family planning and not pregnant at Phase 1
were asked whether they thought their husband / partner would be
supportive of use of family planning in the future. These results are
recorded in <a
href="https://pma.ipums.org/pma-action/variables/FPPARTSUPPORT#codes_section">FPPARTSUPPORT</a>.
We’ll exclude non-partnered women here, as they are “NIU (not in
universe)”.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>FPPARTSUPPORT_1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>97</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>FPPARTSUPPORT_1 <span class='op'>=</span> <span class='va'>FPPARTSUPPORT_1</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='va'>as_factor</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>FPPARTSUPPORT_1</span>, <span class='va'>CP_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>CP_2</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>FPPARTSUPPORT_1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"PARTNER SUPPORT FOR FAMILY PLANNING"</span>,
    <span class='st'>"Percent of women age 15-49 who were not using a method at Phase 1"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 2: Adopted a method"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 1: Partner would support FP"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-37-1.png" width="1152" /></p>
</div>
<p>We’ve included responses for women who were unsure whether their
partner would or would not support future use of FP (“Dont know”), but
Phase 2 outcomes for these women were usually not visually distinct from
those who answered “Yes” or “No”. Formal testing is needed to determine
whether any significant differences exist.</p>
<p>Meanwhile, women with Phase 1 partner support in DRC - Kongo Central
and Kenya were more likely to adopt a method than not. Outcomes for
women in other populations are not visibly different based on partner
support, one way or the other (again, formal testing may prove
otherwise).</p>
<h3 id="intentions">Intentions</h3>
<p>Lastly, we’ll demonstrate the impact of women’s plans for future
family planning use at Phase 1. The variable <a
href="https://pma.ipums.org/pma-action/variables/FPUSPLAN#codes_section">FPUSPLAN</a>
indicates whether women had plans for future use <em>at any point</em>
in the future, but here we’ll consider whether women had plans to adopt
a method <em>within the next year</em> to correspond with the timing of
Phase 2 surveys.</p>
<p>There are two variables that describe the approximate time when women
said they would adopt a family planning method (if at all). <a
href="https://pma.ipums.org/pma-action/variables/FPPLANVAL#codes_section">FPPLANVAL</a>
contains a raw number that should be matched with a <em>unit</em> of
time (months, years) or a categorical response (“soon / now”, “after the
birth of this child”) in <a
href="https://pma.ipums.org/pma-action/variables/FPPLANWHEN#codes_section">FPPLANWHEN</a>:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>FPPLANWHEN_1</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 7 × 2
                        FPPLANWHEN_1     n
                           &lt;int+lbl&gt; &lt;int&gt;
1  1 [Months]                          932
2  2 [Years]                          3039
3  3 [Soon / Now]                      685
4  4 [After the birth of this child]   338
5 97 [Don&#39;t know]                      893
6 98 [No response or missing]           18
7 99 [NIU (not in universe)]          4668</code></pre>
</div>
<p>We’ll create <code>FPPLANYR_1</code> to indicate whether each woman
planned to use family planning within a year’s time at Phase 1.</p>
<ul>
<li><code>FPPLANYR_1</code> - Phase 1 plans to use FP within one
year</li>
</ul>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    FPPLANYR_1 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>FPPLANVAL_1</span> <span class='op'>&lt;=</span> <span class='fl'>12</span> <span class='op'>~</span> <span class='st'>"Yes"</span>, <span class='co'># Within 12 months </span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'>==</span> <span class='fl'>2</span> <span class='op'>&amp;</span> <span class='va'>FPPLANVAL_1</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"Yes"</span>, <span class='co'># Within 1 year</span>
      <span class='va'>FPPLANWHEN_1</span> <span class='op'><a href='https://rdrr.io/r/base/match.html'>%in%</a></span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"Yes"</span>, <span class='co'># Soon / now or after current pregnancy</span>
      <span class='cn'>TRUE</span> <span class='op'>~</span> <span class='st'>"No"</span> <span class='co'># Includes date unknown, no response, or no intention (FPUSPLAN)</span>
    <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Our final plot shows the difference in FP adoption between women who
planned to do so within the year, compared with women with no such
plans.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>cur_data</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weight <span class='op'>=</span> <span class='va'>PANELWEIGHT</span>, id <span class='op'>=</span> <span class='va'>EAID_1</span>, strata <span class='op'>=</span> <span class='va'>STRATA_RECODE</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>FPPLANYR_1</span>, <span class='va'>CP_2</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span><span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span>, prop <span class='op'>=</span> <span class='cn'>TRUE</span>, prop_method <span class='op'>=</span> <span class='st'>"logit"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='va'>CP_2</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='http://gdfe.co/srvyr/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>coef</span>, y <span class='op'>=</span> <span class='va'>FPPLANYR_1</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_grid.html'>facet_grid</a></span><span class='op'>(</span>rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>POP</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>pma_bars</span><span class='op'>(</span>
    <span class='st'>"INTENTION TO USE FAMIILY PLANNING WITHIN ONE YEAR"</span>,
    <span class='st'>"Percent of women age 15-49 who were not using a method at Phase 1"</span>,
    xaxis <span class='op'>=</span> <span class='st'>"Phase 2: Adopted a method"</span>,
    yaxis <span class='op'>=</span> <span class='st'>"Phase 1: Plan to use FP"</span>
  <span class='op'>)</span>
</code></pre>
</div>
<p><img src="phase2-indicators_files/figure-html5/unnamed-chunk-40-1.png" width="1152" /></p>
</div>
<p>In every population, Phase 1 non-users who planned to adopt a method
by Phase 2 were significantly more likely to do so. However, a
significant <em>majority</em> of Phase 1 non-users with plans to adopt a
method actually did so only in Kenya, where the 95% confidence interval
for “Yes” responses includes only proportions greater than the 50%
threshold. In fact, women who adopted a method at Phase 2 represent a
significant <em>minority</em> of Phase 1 non-users who planned to do so
in Burkina Faso, DRC - Kongo Central, and Nigeria - Kano.</p>
<h1 id="wrap-up">Wrap-up</h1>
<p>As we’ve seen, <strong>grouped bar charts</strong> give us a simple
way to identify clear differences between Phase 2 outcomes for subgroups
defined by baseline family planning conditions or key demographic
features. Additionally, when we <strong>facet</strong> populations of
interest on the same axis, we can easily compare differences between
subgroups for many samples in a single figure.</p>
<p>One drawback to this approach is that it’s more conservative than
formal statistical tests. We are not able to easily spot differences
near the conventional 95% certainty threshold. However, we demonstrated
how you can adapt our code to conduct formal hypothesis tests like the
<a href="https://rdrr.io/cran/survey/man/svychisq.html">Rao-Scott
chi-square test</a> for weighted proportions.</p>
<p>Another drawback to this approach is that we’ve been unable to
showcase estimates for the proportion of responses at any <em>one</em>
phase of the study. For example, in our last figure, we estimated that
about 35% of women who <em>planned to use</em> contraception within the
year at Phase 1 did so at Phase 2; our figure does not show how many
women planned to use contraception within the year <em>as a share of the
Phase 1 population</em>.</p>
<p>To better understand the change over time relative to the size of
each subgroup in our analysis, we’ll turn to a slightly more complicated
data visualization method. In our next post, we’ll show how to create
<strong>alluvial plots</strong>, like those shown in the first two pages
of each PMA report.</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<section class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Because women are considered “lost to
follow-up” if they moved outside the study area, <code>EAID_1</code> and
<code>EAID_2</code> are identical for all panel members: you can use
either one to identify sample clusters.<a href="#fnref1"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>The Rao-Scott second-order correction
to Pearson’s chi-square test is used to incorporate survey design
information from <a
href="http://gdfe.co/srvyr/reference/as_survey_design.html">as_survey_design</a>,
reflecting weighted population estimates. Wald-type chi-square tests are
also available: see <a
href="https://rdrr.io/cran/survey/man/svychisq.html">svychisq</a> for
details.<a href="#fnref2" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
