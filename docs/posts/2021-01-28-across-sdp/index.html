<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Data Analysis Hub: Recode and Summarize Variables from Multiple Response Questions</title>

<meta property="description" itemprop="description" content="Use dplyr::across to summarize variables with a similar naming pattern."/>

<link rel="canonical" href="https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/"/>
<link rel="icon" type="image/png" href="../../images/favicon/favicon-32x32.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-01-28"/>
<meta property="article:created" itemprop="dateCreated" content="2021-01-28"/>
<meta name="article:author" content="Matt Gunther"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Analysis Hub: Recode and Summarize Variables from Multiple Response Questions"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="Use dplyr::across to summarize variables with a similar naming pattern."/>
<meta property="og:url" content="https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/"/>
<meta property="og:image" content="https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/images/logos.png"/>
<meta property="og:image:width" content="960"/>
<meta property="og:image:height" content="540"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Analysis Hub"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Analysis Hub: Recode and Summarize Variables from Multiple Response Questions"/>
<meta property="twitter:description" content="Use dplyr::across to summarize variables with a similar naming pattern."/>
<meta property="twitter:url" content="https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/"/>
<meta property="twitter:image" content="https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/images/logos.png"/>
<meta property="twitter:image:width" content="960"/>
<meta property="twitter:image:height" content="540"/>
<meta property="twitter:site" content="@ipumsGH"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","categories","date","output","preview","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Recode and Summarize Variables from Multiple Response Questions"]},{"type":"character","attributes":{},"value":["Use dplyr::across to summarize variables with a similar naming pattern."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["Individuals in Context","Data Manipulation","Service Delivery Points","across","ipumsr"]},{"type":"character","attributes":{},"value":["01-28-2021"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["images/logos.png"]},{"type":"character","attributes":{},"value":["https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["across-sdp_files/anchor-4.2.2/anchor.min.js","across-sdp_files/bowser-1.9.3/bowser.min.js","across-sdp_files/distill-2.2.21/template.v2.js","across-sdp_files/font-awesome-5.13.0/css/all.min.css","across-sdp_files/font-awesome-5.13.0/css/v4-shims.min.css","across-sdp_files/font-awesome-5.13.0/js/script.js","across-sdp_files/font-awesome-5.13.0/webfonts/fa-brands-400.eot","across-sdp_files/font-awesome-5.13.0/webfonts/fa-brands-400.svg","across-sdp_files/font-awesome-5.13.0/webfonts/fa-brands-400.ttf","across-sdp_files/font-awesome-5.13.0/webfonts/fa-brands-400.woff","across-sdp_files/font-awesome-5.13.0/webfonts/fa-brands-400.woff2","across-sdp_files/font-awesome-5.13.0/webfonts/fa-regular-400.eot","across-sdp_files/font-awesome-5.13.0/webfonts/fa-regular-400.svg","across-sdp_files/font-awesome-5.13.0/webfonts/fa-regular-400.ttf","across-sdp_files/font-awesome-5.13.0/webfonts/fa-regular-400.woff","across-sdp_files/font-awesome-5.13.0/webfonts/fa-regular-400.woff2","across-sdp_files/font-awesome-5.13.0/webfonts/fa-solid-900.eot","across-sdp_files/font-awesome-5.13.0/webfonts/fa-solid-900.svg","across-sdp_files/font-awesome-5.13.0/webfonts/fa-solid-900.ttf","across-sdp_files/font-awesome-5.13.0/webfonts/fa-solid-900.woff","across-sdp_files/font-awesome-5.13.0/webfonts/fa-solid-900.woff2","across-sdp_files/header-attrs-2.6/header-attrs.js","across-sdp_files/header-attrs-2.7/header-attrs.js","across-sdp_files/jquery-1.11.3/jquery.min.js","across-sdp_files/webcomponents-2.0.0/webcomponents.js","data/pma_00008.dat.gz","data/pma_00008.xml","data/pma_00011.dat.gz","data/pma_00011.xml","images/dplyr.png","images/ipumsr.png","images/logos.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://assets.ipums.org/_css/font-faces.css');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #00263A;
  --header-color:    #00263A;
  --body-color:      #00263A;
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    cabrito_sans_norm_regular;
  --mono-font:       Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-font:       cabrito_sans_norm_regular;
  --navbar-font:     cabrito_sans_norm_regular;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

h1{
  font-family: 'cabrito_sans_norm_regular';
  text-transform: uppercase;
  color: #00263A;
}

d-article h1{
  line-height: 1.1em;
}

d-article h2{
    font-size: 30px;
    font-family: "cabrito_sans_cond_demi";
    text-transform: uppercase;
    color: #00263A;
}

d-article h3{
  font-size: 26px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
}

d-article h4{
  font-size: 24px;
  font-family: 'cabrito_sans_norm_regular';
  color: #00263A;
  text-transform: unset;
  margin-top: 1.5rem;
  margin-bottom: 1em;
}

d-article h5{
  font-size: 24px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
}

d-article li {
    margin-bottom: 0;
    margin-left: 1rem;
    padding-left: 0;
}

body{
  font-family: 'cabrito_subset';
}

b, strong {
  font-family: "cabrito_sans_cond_demi";
}

p>a {
    color: #98579B
}

li>a {
    color: #98579B;
}

.btn {
    font-family: "cabrito_subset";
    font-size: 16px;
    background-color: #F0E6F0;
    margin-bottom: 20px;
    border-width: 1px;
    padding-top: 6px;
    padding-bottom: 6px;
    cursor: pointer;
}

.distill-site-header .title {
    text-transform: uppercase;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .logo img{
  max-height: 50px; /* Makes logo bigger, default was 20px */
  vertical-align: middle;
  margin-bottom: 0;
}

.distill-site-header .nav-right {
    float: right;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .nav-left {
    display: inline-block;
    line-height: 38px;
    vertical-align: middle;
}

.algolia-autocomplete {
  line-height: 25px;
}

d-article iframe {
    border: 0;
    margin-bottom: 0;
    width: 100%;
}

d-article aside a {
  color: #98579B;
}

code {
    font-family: Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
	font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
/* only text inside of <p> tags */
d-article > p {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}

/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
	font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
	font-size: var(--aside-size, 12px);
	color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
	font-size: var(--fig-cap-size, 13px);
	color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
	font-size: var(--heading-size, 0.6rem);
	color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
	font-size: var(--body-size, 0.8rem);
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
	font-size: var(--heading-size, 18px);
}

.d-contents nav a {
	font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
	color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
	font-size: var(--title-size, 18px);
	font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a:hover {
	color: var(--hover-color, white);
}

.distill-site-header {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
	color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-191039907-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-191039907-2');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Recode and Summarize Variables from Multiple Response Questions","description":"Use dplyr::across to summarize variables with a similar naming pattern.","authors":[{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-01-28T00:00:00.000+00:00","citationText":"Gunther, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://pma.ipums.org/pma/">
<img src="../../images/logo-white.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Data Analysis Hub</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Posts</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Courses
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../introduction.html">Introduction to IPUMS PMA Data Analysis</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
R Tips
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../posts/2020-12-10-get-ipums-pma-data/index.html">Import IPUMS PMA Data into R</a>
<a href="../../posts/2020-12-10-get-r-and-packages/index.html">R, RStudio, and R Packages</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Community
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../CONTRIBUTING.html">Contributing guide</a>
<a href="../../CODE_OF_CONDUCT.html">Code of conduct</a>
<a href="../../LICENSE.html">License</a>
<a href="https://github.com/ipums/pma-data-hub/">GitHub</a>
</div>
</div>
<a href="../../about.html">About</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/ipumsGH">
<i class="fab fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://github.com/ipums/pma-data-hub" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Recode and Summarize Variables from Multiple Response Questions</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:Individuals_in_Context" class="dt-tag">Individuals in Context</a>
  <a href="../../index.html#category:Data_Manipulation" class="dt-tag">Data Manipulation</a>
  <a href="../../index.html#category:Service_Delivery_Points" class="dt-tag">Service Delivery Points</a>
  <a href="../../index.html#category:across" class="dt-tag">across</a>
  <a href="../../index.html#category:ipumsr" class="dt-tag">ipumsr</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>Use dplyr::across to summarize variables with a similar naming pattern.</p></p>
</div>

<div class="d-byline">
  Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>01-28-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#sdp-multiple-response-questions">SDP Multiple Response Questions</a></li>
<li><a href="#setup-load-an-example-dataset-into-r">Setup: Load an Example Dataset into R</a></li>
<li><a href="#recoding-variables-with-ipumsr">Recoding Variables with ipumsr</a></li>
<li><a href="#introducing-dplyracross">Introducing dplyr::across</a></li>
<li><a href="#summarize-variable-groups-by-facility">Summarize Variable Groups by Facility</a></li>
<li><a href="#summarize-variable-groups-by-eaid">Summarize Variable Groups by EAID</a></li>
</ul>
</nav>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<p>In our <a href="../2021-01-26-sdp-data/index.html">last post</a>, we introduced PMA Service Delivery Point (SDP) data as an important resource for understanding the health services environment experienced by individuals sampled in PMA Household and Female data. For our second post in this <a href="../../index.html#category:Individuals_in_Context">Individuals in Context</a> series, we’ll now take deeper dive into one of the important topics in SDP data: the range and availability of contraceptive methods provided at each facility.</p>
<p>A common feature of the variables in this topic - and in many other topics - is that you’ll find several binary indicators constructed from the same <strong>multiple resposne</strong> item on the SDP questionnaire. We’ll see that IPUMS PMA uses a common naming convention to help users group these variables together for use in functions like <a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a>.</p>
<h1 id="sdp-multiple-response-questions">SDP Multiple Response Questions</h1>
<p>Every SDP respondent receives a question associated with the variable <a href="https://pma.ipums.org/pma-action/variables/FPOFFERED">FPOFFERED</a>, which indicates whether to facility usually offers family planning services or products:</p>
<pre><code>Do you usually offer family planning services / products?

  [] Yes
  [] No
  [] No response</code></pre>
<p>If yes, they’ll then receive a multiple response-type question asking about the contraceptive methods provided to clients. The range of options provided on the questionnaire may vary across samples, but most look something like this:</p>
<pre><code>Which of the following methods are provided to clients at this facility? 

  [] Female sterilization
  [] Male sterilization
  [] Implant
  [] IUD
  [] Injectables - Depo Provera
  [] Injectables - Sayana Press
  [] Pill
  [] Emergency Contraception
  [] Male Condom
  [] Female Condom
  [] Diaphragm
  [] Foam/Jelly
  [] Std. Days / Cycle beads
  [] None of the above
  [] No response</code></pre>
<aside>
If the response to <b>FPOFFERED</b> was not “Yes”, this question will be skipped and marked “NIU (not in universe)”.
</aside>
<p>This is a multiple response question: each method in the list could be answered individually (<code>Yes</code> or <code>No</code>), or the respondent could reply <code>None of the above</code> or provide <code>No response</code>. The IPUMS PMA extract system generates one variable for each of the methods in the list:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/FSTPROV">FSTPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/MSTPROV">MSTPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/IMPPROV">IMPPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/IUDPROV">IUDPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DEPOPROV">DEPOPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/SAYPROV">SAYPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/PILLPROV">PILLPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/EMRGPROV">EMRGPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CONPROV">CONPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FCPROV">FCPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DIAPROV">DIAPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FJPROV">FJPROV</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CYCBPROV">CYCBPROV</a></li>
</ul>
<p>The questionnaire continues for each one of the methods provided at a given facility. Next, it checks for the current availability of each of the provided methods:</p>
<pre><code>You mentioned that you typically provide the [METHOD] at this facility,
can you show it to me? If no, probe: Is the [METHOD] out of stock today?

  [] In-stock and observed
  [] In-stock but not observed
  [] Out of stock
  [] No Response</code></pre>
<p>The variables associated with each response end with the same suffix <code>OBS</code>:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/IMPOBS">IMPOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/IUDOBS">IUDOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DEPOOBS">DEPOOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/SAYOBS">SAYOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/PILLOBS">PILLOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/EMRGOBS">EMRGOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CONOBS">CONOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FCOBS">FCOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DIAOBS">DIAOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FJOBS">FJOBS</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CYCBOBS">CYCBOBS</a></li>
</ul>
<aside>
<p>Sterilization methods were not included in this question.</p>
<p>Note: if a given method was not provided at a facility, it would be skipped and marked <b>“NIU (not in universe)”</b>.</p>
You can always visit a variable’s <b>Universe</b> tab for details.
</aside>
<p>If a facility <em>did</em> have a particular method in-stock, it received a question asking whether supplies were unavailable any time in the previous three months:</p>
<pre><code>Has the [METHOD] been out of stock at any time in the last 3 months?

  [] Yes 
  [] No 
  [] Don&#39;t know
  [] No response</code></pre>
<p>This question becomes a series of variables ending with the suffix <code>OUT3MO</code>:</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/IMPOUT3MO">IMPOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/IUDOUT3MO">IUDOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DEPOOUT3MO">DEPOOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/SAYOUT3MO">SAYOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/PILLOUT3MO">PILLOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/EMRGOUT3MO">EMRGOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CONOUT3MO">CONOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FCOUT3MO">FCOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DIAOUT3MO">DIAOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FJOUT3MO">FJOUT3MO</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CYCBOUT3MO">CYCBOUT3MO</a></li>
</ul>
<aside>
<p>Again, sterilization methods were not included in this question.</p>
Note: if a given method <i>was not</i> in-stock at a facility where it’s normally provided, it would be skipped and marked <b>“NIU (not in universe)”</b>.
</aside>
<p>On the other hand, if a facility that normally provides a given method <em>did not</em> have supplies in-stock during the interview, it received a different question about the duration of the current stockout:</p>
<pre><code>How many days has the [METHOD] been out of stock?

  Number of days____</code></pre>
<p>The resulting variables - each ending with the suffix <code>OUTDAY</code> - take an integer value representing the stockout duration in days (except where the value is a non-response code, see <a href="#recoding-variables-with-ipumsr">below</a>):</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/IMPOUTDAY">IMPOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/IUDOUTDAY">IUDOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DEPOOUTDAY">DEPOOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/SAYOUTDAY">SAYOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/PILLOUTDAY">PILLOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/EMRGOUTDAY">EMRGOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CONOUTDAY">CONOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FCOUTDAY">FCOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/DIAOUTDAY">DIAOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/FJOUTDAY">FJOUTDAY</a></li>
<li><a href="https://pma.ipums.org/pma-action/variables/CYCBOUTDAY">CYCBOUTDAY</a></li>
</ul>
<aside>
<p>Again, sterilization methods were not included in this question.</p>
Note: if a given method <i>was</i> in-stock at a facility where it’s normally provided, it would be skipped and marked <b>“NIU (not in universe)”</b>.
</aside>
<h1 id="setup-load-an-example-dataset-into-r">Setup: Load an Example Dataset into R</h1>
<p>As you can see, we’re left with quite a few variables from just these 4 questions! That’s very useful if you’re interested in the availability of one method, in particular, <strong>but what if you want to get a picture of the full range of methods provided at a particular facility?</strong></p>
<p>Fortunately, the repeated use of variable suffixes (<code>PROV</code>, <code>OBS</code>, <code>OUT3MO</code>, and <code>OUTDAY</code>) make these variables highly suitable for column-wise processing with <a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a>.</p>
<p>Let’s start with an example data extract containing all of the variables listed above, collected from just two samples:</p>
<ul>
<li>Burkina Faso - 2018 R6</li>
<li>Burkina Faso - 2017 R5</li>
</ul>
<p>Once you’ve downloaded an extract, open RStudio and load the packages <a href="https://tidyverse.tidyverse.org/">tidyverse</a> and <a href="http://tech.popdata.org/ipumsr/">ipumsr</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
Check out our posts on <a href="../2020-12-10-get-r-and-packages/index.html#r-packages">R Packages</a> and <a href="../2020-12-10-get-ipums-pma-data/index.html">Loading IPUMS PMA data into R</a>.
</aside>
<p>Next, use the file paths for your data extract to load it into R:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='fu'>ipumsr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00008.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00008.dat.gz"</span>
<span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
Remember: change these file paths to match your own extract!
</aside>
<p>Using <code>dplyr::ends_with</code>, we’ll select only <code>FACILITYID</code>, <code>SAMPLE</code>, <code>EAID</code>, and the variables using one of the four suffixes <code>PROV</code>, <code>OBS</code>, <code>OUT3MO</code>, or <code>OUTDAY</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span>  
  <span class='fu'>select</span><span class='op'>(</span>
    <span class='va'>FACILITYID</span>,
    <span class='va'>SAMPLE</span>, 
    <span class='va'>EAID</span>, 
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>,
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span>,
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUT3MO"</span><span class='op'>)</span>,
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUTDAY"</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>That leaves us with 234 rows - each a facility from one of our two samples - and 49 variables:</p>
<div class="layout-chunk" data-layout="l-body-outset">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span>
</code></pre>
</div>
<pre><code># A tibble: 234 x 49
   FACILITYID          SAMPLE  EAID  CONPROV CYCBPROV DEPOPROV DIAPROV
    &lt;int+lbl&gt;       &lt;int+lbl&gt; &lt;dbl&gt; &lt;int+lb&gt; &lt;int+lb&gt; &lt;int+lb&gt; &lt;int+l&gt;
 1       7250 85405 [Burkina…  7142  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 2       7399 85405 [Burkina…  7879  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 3       7506 85405 [Burkina…  7483  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 4       7982 85405 [Burkina…  7185  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 5       7065 85405 [Burkina…  7859  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 6       7729 85405 [Burkina…  7082  1 [Yes]  0 [No]   1 [Yes]  0 [No]
 7       7490 85405 [Burkina…  7650  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 8       7311 85405 [Burkina…  7955  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
 9       7524 85405 [Burkina…  7323  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
10       7932 85405 [Burkina…  7774  1 [Yes]  1 [Yes]  1 [Yes]  0 [No]
# … with 224 more rows, and 42 more variables: EMRGPROV &lt;int+lbl&gt;,
#   FCPROV &lt;int+lbl&gt;, FSTPROV &lt;int+lbl&gt;, FJPROV &lt;int+lbl&gt;,
#   IMPPROV &lt;int+lbl&gt;, IUDPROV &lt;int+lbl&gt;, MSTPROV &lt;int+lbl&gt;,
#   PILLPROV &lt;int+lbl&gt;, SAYPROV &lt;int+lbl&gt;, CONOBS &lt;int+lbl&gt;,
#   CYCBOBS &lt;int+lbl&gt;, DEPOOBS &lt;int+lbl&gt;, DIAOBS &lt;int+lbl&gt;,
#   EMRGOBS &lt;int+lbl&gt;, FCOBS &lt;int+lbl&gt;, FJOBS &lt;int+lbl&gt;,
#   IMPOBS &lt;int+lbl&gt;, IUDOBS &lt;int+lbl&gt;, PILLOBS &lt;int+lbl&gt;,
#   SAYOBS &lt;int+lbl&gt;, CONOUT3MO &lt;int+lbl&gt;, CYCBOUT3MO &lt;int+lbl&gt;,
#   DEPOOUT3MO &lt;int+lbl&gt;, DIAOUT3MO &lt;int+lbl&gt;, EMRGOUT3MO &lt;int+lbl&gt;,
#   FCOUT3MO &lt;int+lbl&gt;, FJOUT3MO &lt;int+lbl&gt;, IMPOUT3MO &lt;int+lbl&gt;,
#   IUDOUT3MO &lt;int+lbl&gt;, PILLOUT3MO &lt;int+lbl&gt;, SAYOUT3MO &lt;int+lbl&gt;,
#   CONOUTDAY &lt;int+lbl&gt;, CYCBOUTDAY &lt;int+lbl&gt;, DEPOOUTDAY &lt;int+lbl&gt;,
#   DIAOUTDAY &lt;int+lbl&gt;, EMRGOUTDAY &lt;int+lbl&gt;, FCOUTDAY &lt;int+lbl&gt;,
#   FJOUTDAY &lt;int+lbl&gt;, IMPOUTDAY &lt;int+lbl&gt;, IUDOUTDAY &lt;int+lbl&gt;,
#   PILLOUTDAY &lt;int+lbl&gt;, SAYOUTDAY &lt;int+lbl&gt;</code></pre>
</div>
<h1 id="recoding-variables-with-ipumsr">Recoding Variables with ipumsr</h1>
<p>A key feature to remember about IPUMS PMA extracts is that variables often have value labels, which are text labels assigned to the different values taken by a variable. When we load the extract into R with an <code>ipumsr</code> function, these variables are imported as <code>labelled</code> objects rather than the more common <code>factor</code> class of objects.</p>
<aside>
<a href="http://tech.popdata.org/ipumsr/articles/value-labels.html">More information</a> on the difference between factors and IPUMS labelled variables.
</aside>
<p>As a result, IPUMS data users need to take some unusual steps when recoding a variable or handling <code>NA</code> values. Happily, the <code>ipumsr</code> package provide a few functions (starting with the prefix <code>lbl_</code>) that make this process very easy.</p>
<p>Let’s take a look at the variable <code>CONOBS</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 5 x 2
                                    CONOBS     n
*                                &lt;int+lbl&gt; &lt;int&gt;
1  1 [In-stock and observed]                 204
2  2 [In-stock but not observed]               3
3  3 [Out of stock]                            5
4 94 [Not interviewed (SDP questionnaire)]     4
5 99 [NIU (not in universe)]                  18</code></pre>
</div>
<p>Notice that we have two values representing SDPs with male condoms “in-stock”: SDPs where the interviewer personally observed the condoms get <code>1</code>, while those where condoms where reported in-stock - but not actually observed by the interviewer - get <code>2</code>.</p>
<p>Depending on your research question, the interviewer’s personal observation of each method may or may not be important. You might decide that you’d prefer to <strong>recode</strong> this variable into a simple binary measure that could be easily plugged into a regression model as a dummy variable later on. To do that, you could use the <code>ipumsr</code> function <a href="http://tech.popdata.org/ipumsr/reference/lbl_relabel.html">lbl_relabel</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>CONOBS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>CONOBS</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"In-stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"Out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 2
                                    CONOBS     n
*                                &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [Out of stock]                            5
2  1 [In-stock]                              207
3 94 [Not interviewed (SDP questionnaire)]     4
4 99 [NIU (not in universe)]                  18</code></pre>
</div>
<aside>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/ipumsr.png" width="514" /></p>
</div>
© 2017 (<a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL 2.0</a>)
</aside>
<p>That collapses the values <code>1</code> and <code>2</code> together, and it moves the value <code>3</code> (“Out of stock”) to <code>0</code>. However, we’ve still got a the values <code>94</code> and <code>99</code>, which are each a different type of non-response. The easiest strategy here would be to recode any value larger than <code>90</code> as <code>NA</code>, and we could do that with another <code>ipumsr</code> function, <a href="http://tech.popdata.org/ipumsr/reference/lbl_na_if.html">lbl_na_if</a>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    CONOBS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>CONOBS</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"in-stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span>,
    CONOBS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_na_if.html'>lbl_na_if</a></span><span class='op'>(</span>
      <span class='va'>CONOBS</span>,
      <span class='op'>~</span><span class='va'>.val</span> <span class='op'>&gt;</span> <span class='fl'>90</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 2
             CONOBS     n
*         &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [out of stock]     5
2  1 [in-stock]       207
3 NA                   22</code></pre>
</div>
<p>This works great for our example variable, <code>CONOBS</code>. Unfortunately, though, we can’t always rely on the rule <code>~.val &gt; 90</code> to handle missing responses. For variables like <code>CONOUTDAY</code>, a value above 90 could be a valid response: what if a facility experienced a stockout lasting 94 days? For this reason, the non-response values for <code>CONOUTDAY</code> are padded with additional digits:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOUTDAY</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 7 x 2
                                   CONOUTDAY     n
*                                  &lt;int+lbl&gt; &lt;int&gt;
1    1                                           1
2    3                                           1
3   10                                           1
4   15                                           1
5   60                                           1
6 9994 [Not interviewed (SDP questionnaire)]     4
7 9999 [NIU (not in universe)]                 225</code></pre>
</div>
<p>We could write a different <code>lbl_na_if</code> function for our <code>OUTDAY</code> variables, but <code>ipumsr</code> provides a much nicer workaround: we can specify non-response <em>labels</em> rather than <em>values</em>, as long as we make sure to use all of the different non-response labels appearing throughout our dataset:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    CONOBS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>CONOBS</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"in-stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span>,
    CONOBS <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_na_if.html'>lbl_na_if</a></span><span class='op'>(</span>
      <span class='va'>CONOBS</span>,
      <span class='op'>~</span><span class='va'>.lbl</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='st'>"Not interviewed (SDP questionnaire)"</span>,
        <span class='st'>"Don't know"</span>,
        <span class='st'>"No response or missing"</span>,
        <span class='st'>"NIU (not in universe)"</span>
      <span class='op'>)</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 2
             CONOBS     n
*         &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [out of stock]     5
2  1 [in-stock]       207
3 NA                   22</code></pre>
</div>
<p>Now, we’ll be able to recode <em>all</em> of our variables with the same pair of functions! To do that, we’ll first need to take a look at the column-wise workflow made available by <code>dplyr::across</code>.</p>
<h1 id="introducing-dplyracross">Introducing dplyr::across</h1>
<p>While there are several ways to apply a function across a set of variables in R, the simplest method comes from a new addition to the <code>dplyr</code> package that’s loaded when you run <code>library(tidyverse)</code>. The function <a href="https://dplyr.tidyverse.org/reference/across.html">dplyr::across</a> takes two arguments: a function, and a selection of columns where you want that function to be applied.</p>
<aside>
<b>dplyr</b> is included when you load <b>library(tidyverse)</b>
</aside>
<p>Remember that we want collapse the values <code>1 - In-stock and observed</code> and <code>2 - In-stock but not observed</code> for <em>all</em> of the variables ending with <code>OBS</code>, not just <code>CONOBS</code>. Using <code>across</code> and a selection of variables ending with <code>OBS</code>, we’ll apply the same <code>lbl_relabel</code> function we used on <code>CONOBS</code> above:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"in-stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span><span class='op'>)</span> 
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 2
                                    CONOBS     n
*                                &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [out of stock]                            5
2  1 [in-stock]                              207
3 94 [Not interviewed (SDP questionnaire)]     4
4 99 [NIU (not in universe)]                  18</code></pre>
</div>
<aside>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/dplyr.png" width="1107" /></p>
</div>
© 2018 RStudio (<a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0</a>)
</aside>
<p>Here, we stick <code>lbl_relabel</code> inside a lambda function with syntax from <a href="https://purrr.tidyverse.org/reference/index.html">purrr</a>: the <code>~</code> designates a tidy lambda function, which in turn uses <code>.x</code> as a kind of pronoun referencing each of the variables returned by <code>ends_with("OBS")</code>. We’re showing that <code>CONOBS</code> still gets recoded as before, but so do all of the other variables in its group!</p>
<p>We’ll use <code>across</code> again with <code>lbl_na_if</code>, but this time we want to produce <code>NA</code> values for <em>all of the variables in our dataset</em>. In place of <code>ends_with("OBS")</code>, we’ll use the selection function <code>everything()</code>. This will take care of all the recoding we want to do, so we’ll also reassign our data with <code>sdp &lt;- sdp</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>&lt;-</span> <span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='st'>"in-stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>%in%</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>,
      <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='st'>"out of stock"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>3</span>
    <span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_na_if.html'>lbl_na_if</a></span><span class='op'>(</span>
      <span class='va'>.x</span>,
      <span class='op'>~</span><span class='va'>.lbl</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
        <span class='st'>"Not interviewed (SDP questionnaire)"</span>,
        <span class='st'>"Don't know"</span>,
        <span class='st'>"No response or missing"</span>,
        <span class='st'>"NIU (not in universe)"</span>
      <span class='op'>)</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</div>
<p>Let’s pick a few variables to check out work:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 2
             CONOBS     n
*         &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [out of stock]     5
2  1 [in-stock]       207
3 NA                   22</code></pre>
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>IMPOBS</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 3 x 2
             IMPOBS     n
*         &lt;dbl+lbl&gt; &lt;int&gt;
1  0 [out of stock]     3
2  1 [in-stock]       204
3 NA                   27</code></pre>
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>CONOUTDAY</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 6 x 2
  CONOUTDAY     n
* &lt;int+lbl&gt; &lt;int&gt;
1         1     1
2         3     1
3        10     1
4        15     1
5        60     1
6        NA   229</code></pre>
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>count</span><span class='op'>(</span><span class='va'>IMPOUTDAY</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 2
  IMPOUTDAY     n
* &lt;int+lbl&gt; &lt;int&gt;
1         1     1
2        14     1
3        90     1
4        NA   231</code></pre>
</div>
<h1 id="summarize-variable-groups-by-facility">Summarize Variable Groups by Facility</h1>
<p>Everything looks great! Now that we’ve finished reformatting the data, remember that our ultimate goal is to get some sense of the scope of methods available at a particular facility.</p>
<p>We’d like to use something like <code>across</code> again here, but this time we’ll only want to apply our function to a selection of columns <em>within the same row</em> (because each row of our dataset represents one facility). To do this, we’ll divide the dataset <a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a>, and then use the related function <a href="https://dplyr.tidyverse.org/articles/rowwise.html">c_across</a> to apply a calculation across columns within each row.</p>
<p>For instance, suppose we want to create <code>NUM_METHODS_PROV</code> to show the total number of methods provided at each facility. Let’s look at the <code>PROV</code> variables for the first few facilities:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> <span class='fu'>select</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 234 x 13
    CONPROV  CYCBPROV DEPOPROV DIAPROV EMRGPROV  FCPROV FSTPROV FJPROV
   &lt;int+lb&gt; &lt;int+lbl&gt; &lt;int+lb&gt; &lt;int+l&gt; &lt;int+lb&gt; &lt;int+l&gt; &lt;int+l&gt; &lt;int+&gt;
 1  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 1 [Yes] 0 [No]
 2  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 1 [Yes] 0 [No]
 3  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 0 [No]  0 [No]
 4  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 0 [No]  0 [No]
 5  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  1 [Yes] 1 [Yes] 1 [Yes] 0 [No]
 6  1 [Yes]   0 [No]   1 [Yes]  0 [No]  0 [No]  1 [Yes] 1 [Yes] 0 [No]
 7  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 0 [No]  0 [No]
 8  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 1 [Yes] 0 [No]
 9  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 0 [No]  0 [No]
10  1 [Yes]   1 [Yes]  1 [Yes]  0 [No]  0 [No]  1 [Yes] 0 [No]  0 [No]
# … with 224 more rows, and 5 more variables: IMPPROV &lt;int+lbl&gt;,
#   IUDPROV &lt;int+lbl&gt;, MSTPROV &lt;int+lbl&gt;, PILLPROV &lt;int+lbl&gt;,
#   SAYPROV &lt;int+lbl&gt;</code></pre>
</div>
<p>To calculate <code>NUM_METHODS_PROV</code>, we can just find the sum of values across all of the <code>PROV</code> variables (thanks to our recoding work, the only possible values here are <code>1</code> for “yes”, or <code>0</code> for “no”). Notice that <code>c_across</code> takes only one argument: a selection function like <code>ends_with("PROV")</code>. That’s because <code>c_across</code> works like the familiar concatenate function <code>c()</code> used to provide a vector of values to a function like <code>sum(c(1,2,3))</code>.</p>
<p>First, use <code>rowwise()</code> to signal that we’ll only calculate the sum across variables in the same row. Then, use <code>c_across()</code> to find the <code>sum()</code> of <code>PROV</code> variables in each row:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rowwise</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>transmute</span><span class='op'>(</span>NUM_METHODS_PROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 234 x 1
# Rowwise: 
   NUM_METHODS_PROV
              &lt;int&gt;
 1               10
 2               10
 3                8
 4                8
 5               10
 6                9
 7                8
 8               10
 9                8
10                8
# … with 224 more rows</code></pre>
</div>
<p>We can now create a summary variable for each of the four variable groups. Let’s create:</p>
<ul>
<li><code>NUM_METHODS_PROV</code> - number of methods provided</li>
<li><code>NUM_METHODS_INSTOCK</code> - number of methods in-stock</li>
<li><code>NUM_METHODS_OUT3MO</code> - number of methods out of stock in the last 3 months</li>
<li><code>MEAN_OUTDAY</code> - the mean length of a stockout for all out of stock methods</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rowwise</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>transmute</span><span class='op'>(</span>
    NUM_METHODS_PROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    NUM_METHODS_INSTOCK <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OBS"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    NUM_METHODS_OUT3MO <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUT3MO"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>,
    MEAN_OUTDAY <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"OUTDAY"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 234 x 4
# Rowwise: 
   NUM_METHODS_PROV NUM_METHODS_INSTOCK NUM_METHODS_OUT3MO MEAN_OUTDAY
              &lt;int&gt;               &lt;dbl&gt;              &lt;int&gt;       &lt;dbl&gt;
 1               10                   8                  0         NaN
 2               10                   7                  0           8
 3                8                   8                  0         NaN
 4                8                   8                  0         NaN
 5               10                   9                  0         NaN
 6                9                   7                  0         NaN
 7                8                   7                  0         365
 8               10                   8                  1         NaN
 9                8                   8                  1         NaN
10                8                   7                  0          30
# … with 224 more rows</code></pre>
</div>
<aside>
<b>MEAN_OUTDAY</b> is <b>NaN</b> (not a number) if no methods were out of stock.
</aside>
<h1 id="summarize-variable-groups-by-eaid">Summarize Variable Groups by EAID</h1>
<p>In our <a href="../2021-01-26-sdp-data/index.html">last post</a>, we mentioned that the best use case for SDP data is to aggregate information collected from facilities working in the same geographic sampling units - or <strong>enumeration areas</strong> - used to select individuals for PMA Household and Female samples. In our next post, we’ll take a close look at the variable group <a href="https://pma.ipums.org/pma-action/variables/EASERVED">EASERVED</a>, which lists all of the enumeration area codes where a facility is known to provide health services. We’ll then introduce a strategy using <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">tidyr::pivot_longer</a> to summarize the full scope of services available to women living in a particular enumeration area.</p>
<p>For now, let’s simply consider all of the sampled facilities <em>located in</em> a particular enumeration area. That is, rather than calculating the number of methods provided by <em>one</em> facility <code>NUM_METHODS_PROV</code>, let’s create one variable for each method indicating whether the method was provided by at least one facility in a given enumeration area <code>EAID</code> in a given <code>SAMPLE</code>.</p>
<p>For instance, look at the number of facilities providing IUDs in enumeration area <code>7111</code> for the Burkina Faso sample collected in 2017:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>EAID</span> <span class='op'>==</span> <span class='fl'>7111</span>, <span class='va'>SAMPLE</span> <span class='op'>==</span> <span class='fl'>85405</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>EAID</span>, <span class='va'>SAMPLE</span>, <span class='va'>FACILITYID</span>, <span class='va'>PILLPROV</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 4 x 4
   EAID                            SAMPLE FACILITYID  PILLPROV
  &lt;dbl&gt;                         &lt;int+lbl&gt;  &lt;int+lbl&gt; &lt;int+lbl&gt;
1  7111 85405 [Burkina Faso 2017 Round 5]       7210   1 [Yes]
2  7111 85405 [Burkina Faso 2017 Round 5]       7029   0 [No] 
3  7111 85405 [Burkina Faso 2017 Round 5]       7441   1 [Yes]
4  7111 85405 [Burkina Faso 2017 Round 5]       7403   1 [Yes]</code></pre>
</div>
<p>We want to use a <code>summarize</code> function to create a variable like <code>ANY_PILLPROV</code>, which should simply indicate whether any of these four facilities provide contraceptive pills. Three of them <em>do</em> provide pills, so we want <code>ANY_PILLPROV</code> to be <code>TRUE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>EAID</span> <span class='op'>==</span> <span class='fl'>7111</span>, <span class='va'>SAMPLE</span> <span class='op'>==</span> <span class='fl'>85405</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>ANY_PILLPROV <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>PILLPROV</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 1
  ANY_PILLPROV
  &lt;lgl&gt;       
1 TRUE        </code></pre>
</div>
<p>Now that we’re familiar with <code>across</code>, we should be able to do the same thing to all <code>PROV</code> variables for this particular group of facilities. Let’s also introduce a naming convention where we <a href="https://glue.tidyverse.org/">glue</a> the prefix <code>ANY_</code> to the column name referenced by the pronoun <code>.x</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>EAID</span> <span class='op'>==</span> <span class='fl'>7111</span>, <span class='va'>SAMPLE</span> <span class='op'>==</span> <span class='fl'>85405</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span><span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"ANY_{.col}"</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 1 x 13
  ANY_CONPROV ANY_CYCBPROV ANY_DEPOPROV ANY_DIAPROV ANY_EMRGPROV
  &lt;lgl&gt;       &lt;lgl&gt;        &lt;lgl&gt;        &lt;lgl&gt;       &lt;lgl&gt;       
1 TRUE        TRUE         TRUE         FALSE       FALSE       
# … with 8 more variables: ANY_FCPROV &lt;lgl&gt;, ANY_FSTPROV &lt;lgl&gt;,
#   ANY_FJPROV &lt;lgl&gt;, ANY_IMPPROV &lt;lgl&gt;, ANY_IUDPROV &lt;lgl&gt;,
#   ANY_MSTPROV &lt;lgl&gt;, ANY_PILLPROV &lt;lgl&gt;, ANY_SAYPROV &lt;lgl&gt;</code></pre>
</div>
<aside>
It looks like <b>none of the sampled facilities in enumeration area 7111 provided emergency contraception in 2017.</b> This could be very important context for understanding the health services available to women sampled from that area!
</aside>
<p>Let’s repeat the same procedure for every enumeration area in each of our samples. Rather than using a <code>filter</code> to select one <code>EAID</code> in one <code>SAMPLE</code>, we’ll use <code>group_by</code> to work with each <code>EAID</code> in each <code>SAMPLE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EAID</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"ANY_{.col}"</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 142 x 15
# Groups:   EAID, SAMPLE [142]
    EAID      SAMPLE ANY_CONPROV ANY_CYCBPROV ANY_DEPOPROV ANY_DIAPROV
   &lt;dbl&gt;   &lt;int+lbl&gt; &lt;lgl&gt;       &lt;lgl&gt;        &lt;lgl&gt;        &lt;lgl&gt;      
 1  7003 85405 [Bur… TRUE        TRUE         TRUE         FALSE      
 2  7003 85408 [Bur… TRUE        TRUE         TRUE         FALSE      
 3  7006 85405 [Bur… TRUE        TRUE         TRUE         FALSE      
 4  7006 85408 [Bur… TRUE        TRUE         TRUE         FALSE      
 5  7009 85405 [Bur… TRUE        FALSE        TRUE         FALSE      
 6  7009 85408 [Bur… TRUE        TRUE         TRUE         FALSE      
 7  7016 85405 [Bur… TRUE        TRUE         TRUE         FALSE      
 8  7016 85408 [Bur… TRUE        TRUE         TRUE         FALSE      
 9  7026 85405 [Bur… TRUE        TRUE         TRUE         FALSE      
10  7042 85405 [Bur… TRUE        TRUE         TRUE         FALSE      
# … with 132 more rows, and 9 more variables: ANY_EMRGPROV &lt;lgl&gt;,
#   ANY_FCPROV &lt;lgl&gt;, ANY_FSTPROV &lt;lgl&gt;, ANY_FJPROV &lt;lgl&gt;,
#   ANY_IMPPROV &lt;lgl&gt;, ANY_IUDPROV &lt;lgl&gt;, ANY_MSTPROV &lt;lgl&gt;,
#   ANY_PILLPROV &lt;lgl&gt;, ANY_SAYPROV &lt;lgl&gt;</code></pre>
</div>
<p>This is still quite a bit of information! Suppose we want to summarize it even further: let’s calculate <code>NUM_METHODS_PROV</code> again with our summary output. This time, <code>NUM_METHODS_PROV</code> will count the number of methods provided by at least one facility in each group.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>sdp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>EAID</span>, <span class='va'>SAMPLE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>
    .groups <span class='op'>=</span> <span class='st'>"keep"</span>,
    <span class='fu'>across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='va'>.x</span> <span class='op'>==</span> <span class='fl'>1</span><span class='op'>)</span>, .names <span class='op'>=</span> <span class='st'>"ANY_{.col}"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>transmute</span><span class='op'>(</span>NUM_METHODS_PROV<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'>c_across</span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>ends_with</a></span><span class='op'>(</span><span class='st'>"PROV"</span><span class='op'>)</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code># A tibble: 142 x 3
# Groups:   EAID, SAMPLE [142]
    EAID                            SAMPLE NUM_METHODS_PROV
   &lt;dbl&gt;                         &lt;int+lbl&gt;            &lt;int&gt;
 1  7003 85405 [Burkina Faso 2017 Round 5]                8
 2  7003 85408 [Burkina Faso 2018 Round 6]                8
 3  7006 85405 [Burkina Faso 2017 Round 5]                8
 4  7006 85408 [Burkina Faso 2018 Round 6]                8
 5  7009 85405 [Burkina Faso 2017 Round 5]                8
 6  7009 85408 [Burkina Faso 2018 Round 6]               10
 7  7016 85405 [Burkina Faso 2017 Round 5]                8
 8  7016 85408 [Burkina Faso 2018 Round 6]                8
 9  7026 85405 [Burkina Faso 2017 Round 5]                8
10  7042 85405 [Burkina Faso 2017 Round 5]               10
# … with 132 more rows</code></pre>
</div>
<p>These summaries are exactly the type of SDP data we’d like to attach to a Household and Female dataset! Watch for our next post, where we’ll show how to create summaries by <em>both</em> <code>EAID</code> and <code>EASERVED</code>, and then match them to records from female respondents sampled from Burkina Faso in 2017 and 2018.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2021-01-28-across-sdp/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Recode%20and%20Summarize%20Variables%20from%20Multiple%20Response%20Questions&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-01-28-across-sdp%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-01-28-across-sdp%2F&amp;title=Recode%20and%20Summarize%20Variables%20from%20Multiple%20Response%20Questions">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://pma-data-hub.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://ipums.github.io/pma-data-hub/posts/2021-01-28-across-sdp/';
  this.page.identifier = 'posts/2021-01-28-across-sdp/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://pma-data-hub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/ipums/pma-data-hub/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota</p>
  <p>Licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a></p>
  <p>Site built with <a href="https://rstudio.github.io/distill/">Distill for R Markdown</a></p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
