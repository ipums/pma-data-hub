<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Data Analysis Hub: Making the Contraceptive Calendar Data Work For You</title>

<meta property="description" itemprop="description" content="R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting."/>

<link rel="canonical" href="https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/"/>
<link rel="icon" type="image/png" href="../../images/favicon/favicon-32x32.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-05-15"/>
<meta property="article:created" itemprop="dateCreated" content="2021-05-15"/>
<meta name="article:author" content="Matt Gunther"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Analysis Hub: Making the Contraceptive Calendar Data Work For You"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting."/>
<meta property="og:url" content="https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/"/>
<meta property="og:image" content="https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/images/featured.png"/>
<meta property="og:image:width" content="2880"/>
<meta property="og:image:height" content="1800"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Analysis Hub"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Analysis Hub: Making the Contraceptive Calendar Data Work For You"/>
<meta property="twitter:description" content="R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting."/>
<meta property="twitter:url" content="https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/"/>
<meta property="twitter:image" content="https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/images/featured.png"/>
<meta property="twitter:image:width" content="2880"/>
<meta property="twitter:image:height" content="1800"/>
<meta property="twitter:site" content="@ipumsGH"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","preview","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Making the Contraceptive Calendar Data Work For You"]},{"type":"character","attributes":{},"value":["R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["05-15-2021"]},{"type":"character","attributes":{},"value":["PMA Publications","PAA 2021","Contraceptive Calendar","Stata"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["images/featured.png"]},{"type":"character","attributes":{},"value":["https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["data/pma_00001.dat.gz","data/pma_00001.xml","event-materials/chat.txt","event-materials/IPUMS_PMA_Webinar_Slides.pptx","event-materials/paa_2021_side_event.do","event-materials/paa2021.Rmd","images/featured.png","images/R.png","images/stata_pill.png","paa-2021_files/anchor-4.2.2/anchor.min.js","paa-2021_files/bowser-1.9.3/bowser.min.js","paa-2021_files/distill-2.2.21/template.v2.js","paa-2021_files/figure-html5/unnamed-chunk-13-1.png","paa-2021_files/header-attrs-2.7/header-attrs.js","paa-2021_files/jquery-1.11.3/jquery.min.js","paa-2021_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://assets.ipums.org/_css/font-faces.css');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #00263A;
  --header-color:    #00263A;
  --body-color:      #00263A;
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    cabrito_sans_norm_regular;
  --mono-font:       Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-font:       cabrito_sans_norm_regular;
  --navbar-font:     cabrito_sans_norm_regular;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

h1{
  font-family: 'cabrito_sans_norm_regular';
  text-transform: uppercase;
  color: #00263A;
}

d-title h1{
  font-weight: 500;
}

d-article h1{
  font-size: 36px;
  line-height: 1.1em;
  font-weight: 100;
}

d-article h2{
    font-size: 30px;
    font-family: "cabrito_sans_cond_demi";
    text-transform: uppercase;
    color: #00263A;
    font-weight: 100;
}

d-article h3{
  font-size: 26px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article h4{
  font-size: 24px;
  font-family: 'cabrito_sans_norm_regular';
  color: #00263A;
  text-transform: unset;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article h5{
  font-size: 24px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article li {
    margin-bottom: 0;
    margin-left: 1rem;
    padding-left: 0;
    color: #00263A;
}

d-article table {
    color: #00263A;
}
.d-contents nav > ul > li > a {
    font-weight: 100;
}

body{
  font-family: 'cabrito_subset';
}

b, strong {
  font-family: "cabrito_sans_cond_demi";
  font-weight: 100;
}

p>a {
    color: #98579B
}

li>a {
    color: #98579B;
}

.btn {
    font-family: "cabrito_subset";
    font-size: 16px;
    background-color: #F0E6F0;
    margin-bottom: 20px;
    border-width: 1px;
    padding-top: 6px;
    padding-bottom: 6px;
    cursor: pointer;
}

.distill-site-header .title {
    text-transform: uppercase;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .logo img{
  max-height: 50px; /* Makes logo bigger, default was 20px */
  vertical-align: middle;
  margin-bottom: 0;
}

.distill-site-header .nav-right {
    float: right;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .nav-left {
    display: inline-block;
    line-height: 38px;
    vertical-align: middle;
}

.algolia-autocomplete {
  line-height: 25px;
}

d-article iframe {
    border: 0;
    margin-bottom: 0;
    width: 100%;
}

d-article aside a {
  color: #98579B;
}

@media(max-width: 767px){
  aside{
    width: 50%;
    position: relative;
    left: 25%;
    padding-bottom: 20px;
  }
}

code {
  font-family: Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
	font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
/* only text inside of <p> tags */
d-article > p {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}

/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
	font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
	font-size: var(--aside-size, 12px);
	color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
	font-size: var(--fig-cap-size, 13px);
	color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
	font-size: var(--heading-size, 0.6rem);
	color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
	font-size: var(--body-size, 0.8rem);
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
	font-size: var(--heading-size, 18px);
}

.d-contents nav a {
	font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
	color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
	font-size: var(--title-size, 18px);
	font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a:hover {
	color: var(--hover-color, white);
}

.distill-site-header {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
	color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.7/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-191039907-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-191039907-2');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Making the Contraceptive Calendar Data Work For You","description":"R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting.","authors":[{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-05-15T00:00:00.000+00:00","citationText":"Gunther, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://pma.ipums.org/pma/">
<img src="../../images/logo-white.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Data Analysis Hub</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Posts</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Courses
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../introduction.html">Introduction to IPUMS PMA Data Analysis</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
R Tips
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../posts/2020-12-10-get-ipums-pma-data/index.html">Import IPUMS PMA Data into R</a>
<a href="../../posts/2020-12-10-get-r-and-packages/index.html">R, RStudio, and R Packages</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Community
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../CONTRIBUTING.html">Contributing guide</a>
<a href="../../CODE_OF_CONDUCT.html">Code of conduct</a>
<a href="../../LICENSE.html">License</a>
<a href="https://github.com/ipums/pma-data-hub/">GitHub</a>
</div>
</div>
<a href="../../about.html">About</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/ipumsGH">
<i class="fab fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://github.com/ipums/pma-data-hub" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Making the Contraceptive Calendar Data Work For You</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:PMA_Publications" class="dt-tag">PMA Publications</a>
  <a href="../../index.html#category:PAA_2021" class="dt-tag">PAA 2021</a>
  <a href="../../index.html#category:Contraceptive_Calendar" class="dt-tag">Contraceptive Calendar</a>
  <a href="../../index.html#category:Stata" class="dt-tag">Stata</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>R and Stata code with video from an event held at the Population Association of America 2021 Annual Meeting.</p></p>
</div>

<div class="d-byline">
  Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>05-15-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#breakout-session-r-users">Breakout Session: R Users</a></li>
<li><a href="#breakout-session-stata-users">Breakout Session: Stata Users</a></li>
<li><a href="#download-links">Download Links</a></li>
</ul>
</nav>
</div>
<p>On May 4th, PMA and IPUMS PMA co-hosted a <a href="https://www.populationassociation.org/paa-2021/home">Population Association of America 2021</a> virtual data workshop showcasing the new PMA <a href="https://pma.ipums.org/pma-action/variables/group?id=fem_cal">contraceptive calendar</a> data available for these samples:</p>
<ul>
<li>Burkina Faso 2020</li>
<li>Congo (DR), Kinshasa 2019</li>
<li>Congo (DR), Kongo Central 2019</li>
<li>Kenya 2019</li>
<li>Nigeria, Kano 2019</li>
<li>Nigeria, Lagos 2019</li>
</ul>
<p>These data represent contraceptive use, pregnancy, pregnancy termination, and birth information recalled by female respondents for each of several months preceding the PMA interview. Women sampled in Burkina Faso and Democratic Republic of the Congo were each asked to recall monthly information for up to 24 months, while women sampled from Kenya and Nigeria were asked to recall monthly information for up to 36 months. Their responses are recorded in a single comma delimited string, where information about each month is represented by one of the following codes:</p>
<ul>
<li>B = Birth</li>
<li>P = Pregnant</li>
<li>T = Pregnancy ended</li>
<li>0 = No family planning method used</li>
<li>1 = Female Sterilization</li>
<li>2 = Male Sterilization</li>
<li>3 = Implant</li>
<li>4 = IUD</li>
<li>5 = Injectables</li>
<li>7 = Pill</li>
<li>8 = Emergency Contraception</li>
<li>9 = Male Condom</li>
<li>10 = Female Condom</li>
<li>11 = Diaphragm</li>
<li>12 = Foam / Jelly</li>
<li>13 = Standard Days / Cycle beads</li>
<li>14 = LAM</li>
<li>30 = Rhythm method</li>
<li>31 = Withdrawal</li>
<li>39 = Other traditional methods</li>
</ul>
<p>In this video, PMA and IPUMS PMA explain the background behind contraceptive calendar data and show some of the ways you might consider using it in longitudinal analysis. We also give a conceptual overview of the steps <strong>both R and Stata users</strong> should take to reshape the data into a <strong>long format</strong>. After the overview, R and Stata users split into separate breakout sessions to work with a hands-on coding example using data from the Kenya 2019 sample; this example shows how to build a <a href="https://en.wikipedia.org/wiki/Kaplan%E2%80%93Meier_estimator">Kaplan-Meier survival curve</a> for cohorts of women who were using the same family planning method in the first month of the contraceptive calendar.</p>
<aside>
Check out our recent post on <a href="../2021-04-15-migration-discovery/index.html">migration recall data</a> for information and practice with longitudinal data structures. The same 2019 and 2020 samples that contain contraceptive calendar data also include migration recall data.
</aside>
<p><br/> <iframe src="https://www.youtube.com/embed/OkKVXspzH6k" height="315" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <br/></p>
<aside>
<a href="event-materials/IPUMS_PMA_Webinar_Slides.pptx">Download Powerpoint slides here</a>. A transcript of the chat from this session (including typed responses from the Q&amp;A) is also available <a href="event-materials/chat.txt">here</a> (participant names are redacted).
</aside>
<h1 id="breakout-session-r-users">Breakout Session: R Users</h1>
<p>R users can load a fixed-width IPUMS PMA data extract with help from the <a href="http://tech.popdata.org/ipumsr/">ipumsr</a> package (if you’re new to this blog, check out detailed instructions <a href="file:///Users/Matt/R/pma-data-hub/docs/posts/2020-12-10-get-ipums-pma-data/index.html">here</a>). We also use packages from <a href="https://tidyverse.tidyverse.org/">tidyverse</a> to reformat the data, as well as <a href="https://cran.r-project.org/web/packages/survival/index.html">survival</a> and <a href="https://cran.r-project.org/web/packages/ggfortify/index.html">ggfortify</a> for specific survival analysis functions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/therneau/survival'>survival</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/sinhrks/ggfortify'>ggfortify</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>tibble.print_min <span class='op'>=</span> <span class='fl'>20</span>, tibble.min_extra_cols <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>

<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00001.xml"</span>,
  data <span class='op'>=</span> <span class='st'>"data/pma_00001.dat.gz"</span>
<span class='op'>)</span> 
</code></pre>
</div>
</div>
<aside>
This code looks for my data file and DDI codebook in a folder called “data” inside of my R working directory. Make sure to change these paths as needed!
</aside>
<p>When you open any IPUMS PMA data extract from the Household and Female Survey, you’ll find the data organized with one respondent per row. Here, there are 9,549 rows each representing one female respondent (all other household members have been excluded):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>dat</span> 
</code></pre>
</div>
<pre><code># A tibble: 9,549 x 17
         SAMPLE COUNTRY  YEAR HHID  PERSONID ELIGIBLE   EAID CONSENTFQ
      &lt;int+lbl&gt; &lt;int+l&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;int+lb&gt;  &lt;dbl&gt; &lt;int+lbl&gt;
 1 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 2 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 3 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 4 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 5 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 6 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 7 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 8 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
 9 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
10 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
11 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
12 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
13 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
14 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
15 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
16 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
17 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
18 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
19 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
20 40410 [Keny… 7 [Ken…  2019 4042… 4042019… 1 [Yes,… 4.04e8   1 [Yes]
# … with 9,529 more rows, and 9 more variables: FQINSTID &lt;chr&gt;,
#   CONSENTHQ &lt;int+lbl&gt;, FQWEIGHT &lt;dbl&gt;, STRATA &lt;int+lbl&gt;,
#   SUBNATIONAL &lt;int+lbl&gt;, AGE &lt;int+lbl&gt;, BIRTHEVENT &lt;int+lbl&gt;,
#   WORKYR &lt;int+lbl&gt;, CALENDARKE &lt;chr+lbl&gt;</code></pre>
</div>
<p><em>For the purpose of this exercise only</em> we create a short identifying number for each respondent called <code>ID</code>. Then, we select only the variables <code>ID</code> and <code>CALENDARKE</code> (dropping all of the other variables pre-selected for every IPUMS PMA extract).</p>
<aside>
In practice, you should use the variable <code>PERSONID</code> to track unique respondents; we use <code>ID</code> instead here only because it fits better on the screen.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rowid_to_column</span><span class='op'>(</span><span class='st'>"ID"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>CALENDARKE</span><span class='op'>)</span>

<span class='va'>dat</span>
</code></pre>
</div>
<pre><code># A tibble: 9,549 x 2
      ID CALENDARKE                                                   
   &lt;int&gt; &lt;chr+lbl&gt;                                                    
 1     1 0,0,B,P,P,P,P,P,P,P,P,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,…
 2     2 ,7,7,7,7,7,7,7,7,0,B,P,P,P,P,P,P,P,P,0,0,0,0,0,9,9,9,9,9,9,9…
 3     3 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
 4     4 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
 5     5 ,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,B,P,P,P,P,P,P,P,P,0,0,0,0,0…
 6     6 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,…
 7     7 5,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,B,P,P,P,P,P,…
 8     8 P,P,P,P,P,P,P,P,0,0,0,0,0,0,0,14,14,14,14,14,14,14,B,P,P,P,P…
 9     9 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
10    10 ,P,P,P,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9…
11    11 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0…
12    12 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0…
13    13 ,P,P,P,P,P,P,P,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9…
14    14 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
15    15 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14…
16    16 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,…
17    17 ,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5…
18    18 ,5,5,5,5,5,5,5,5,5,5,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7…
19    19 0,0,0,0,0,0,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,…
20    20 ,P,P,P,P,P,P,P,5,5,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0…
# … with 9,529 more rows</code></pre>
</div>
<p>As you can see, <code>CALENDARKE</code> includes the response codes shown above, each separated by a comma. Each string contains 36 codes: these represent the 36 months from January 2017 through December 2019 (the last month in which Kenya 2019 samples were collected). The left-most code represents the <em>most recent available month</em>.</p>
<p>Some strings begin with a comma (i.e. the most recent month is blank). These are individuals who were interviewed in November 2019, rather than December. When we split the string into 36 columns, we must shift these individuals to the right, leaving a blank value in the left-most column (December 2019). For example, notice the blank value that appears in the new column <code>cal_ke36</code> for the person <code>ID == 2</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>separate</span><span class='op'>(</span>
    col <span class='op'>=</span> <span class='va'>CALENDARKE</span>,
    into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cal_ke"</span>, <span class='fl'>36</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>,
    fill <span class='op'>=</span> <span class='st'>"left"</span>
  <span class='op'>)</span> 

<span class='va'>dat</span>
</code></pre>
</div>
<pre><code># A tibble: 9,549 x 37
      ID cal_ke36 cal_ke35 cal_ke34 cal_ke33 cal_ke32 cal_ke31
   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
 1     1 &quot;0&quot;      0        B        P        P        P       
 2     2 &quot;&quot;       7        7        7        7        7       
 3     3 &quot;0&quot;      0        0        0        0        0       
 4     4 &quot;0&quot;      0        0        0        0        0       
 5     5 &quot;&quot;       5        5        5        5        5       
 6     6 &quot;5&quot;      5        5        5        5        5       
 7     7 &quot;5&quot;      5        5        5        5        5       
 8     8 &quot;P&quot;      P        P        P        P        P       
 9     9 &quot;0&quot;      0        0        0        0        0       
10    10 &quot;&quot;       P        P        P        9        9       
11    11 &quot;&quot;       0        0        0        0        0       
12    12 &quot;&quot;       0        0        0        0        0       
13    13 &quot;&quot;       P        P        P        P        P       
14    14 &quot;0&quot;      0        0        0        0        0       
15    15 &quot;0&quot;      0        0        0        0        0       
16    16 &quot;3&quot;      3        3        3        3        3       
17    17 &quot;&quot;       5        5        5        5        5       
18    18 &quot;&quot;       5        5        5        5        5       
19    19 &quot;0&quot;      0        0        0        0        0       
20    20 &quot;&quot;       P        P        P        P        P       
# … with 9,529 more rows, and 30 more variables: cal_ke30 &lt;chr&gt;,
#   cal_ke29 &lt;chr&gt;, cal_ke28 &lt;chr&gt;, cal_ke27 &lt;chr&gt;, cal_ke26 &lt;chr&gt;,
#   cal_ke25 &lt;chr&gt;, cal_ke24 &lt;chr&gt;, cal_ke23 &lt;chr&gt;, cal_ke22 &lt;chr&gt;,
#   cal_ke21 &lt;chr&gt;, cal_ke20 &lt;chr&gt;, cal_ke19 &lt;chr&gt;, cal_ke18 &lt;chr&gt;,
#   cal_ke17 &lt;chr&gt;, cal_ke16 &lt;chr&gt;, cal_ke15 &lt;chr&gt;, cal_ke14 &lt;chr&gt;,
#   cal_ke13 &lt;chr&gt;, cal_ke12 &lt;chr&gt;, cal_ke11 &lt;chr&gt;, cal_ke10 &lt;chr&gt;,
#   cal_ke9 &lt;chr&gt;, cal_ke8 &lt;chr&gt;, cal_ke7 &lt;chr&gt;, cal_ke6 &lt;chr&gt;,
#   cal_ke5 &lt;chr&gt;, cal_ke4 &lt;chr&gt;, cal_ke3 &lt;chr&gt;, cal_ke2 &lt;chr&gt;,
#   cal_ke1 &lt;chr&gt;</code></pre>
</div>
<p>Let’s now pivot the data from wide to long format so that we’ll be able to mark <em>time</em> in a new column called <code>MONTH</code>. The argument <code>names_pattern</code> pulls the number from each variable starting with <code>cal_ke</code>, which we then put in the new column <code>MONTH</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>tibble.print_min <span class='op'>=</span> <span class='fl'>40</span><span class='op'>)</span>

<span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>"cal_ke"</span><span class='op'>)</span>,
    names_pattern <span class='op'>=</span> <span class='st'>"cal_ke(.*)"</span>,
    names_to <span class='op'>=</span> <span class='st'>"MONTH"</span>,
    values_to <span class='op'>=</span> <span class='st'>"FP"</span>
  <span class='op'>)</span> 

<span class='va'>dat</span>
</code></pre>
</div>
<pre><code># A tibble: 343,764 x 3
      ID MONTH FP   
   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
 1     1 36    &quot;0&quot;  
 2     1 35    &quot;0&quot;  
 3     1 34    &quot;B&quot;  
 4     1 33    &quot;P&quot;  
 5     1 32    &quot;P&quot;  
 6     1 31    &quot;P&quot;  
 7     1 30    &quot;P&quot;  
 8     1 29    &quot;P&quot;  
 9     1 28    &quot;P&quot;  
10     1 27    &quot;P&quot;  
11     1 26    &quot;P&quot;  
12     1 25    &quot;0&quot;  
13     1 24    &quot;0&quot;  
14     1 23    &quot;0&quot;  
15     1 22    &quot;0&quot;  
16     1 21    &quot;0&quot;  
17     1 20    &quot;0&quot;  
18     1 19    &quot;0&quot;  
19     1 18    &quot;0&quot;  
20     1 17    &quot;0&quot;  
21     1 16    &quot;0&quot;  
22     1 15    &quot;0&quot;  
23     1 14    &quot;0&quot;  
24     1 13    &quot;3&quot;  
25     1 12    &quot;3&quot;  
26     1 11    &quot;3&quot;  
27     1 10    &quot;3&quot;  
28     1 9     &quot;3&quot;  
29     1 8     &quot;3&quot;  
30     1 7     &quot;3&quot;  
31     1 6     &quot;3&quot;  
32     1 5     &quot;3&quot;  
33     1 4     &quot;3&quot;  
34     1 3     &quot;3&quot;  
35     1 2     &quot;3&quot;  
36     1 1     &quot;3&quot;  
37     2 36    &quot;&quot;   
38     2 35    &quot;7&quot;  
39     2 34    &quot;7&quot;  
40     2 33    &quot;7&quot;  
# … with 343,724 more rows</code></pre>
</div>
<aside>
Notice: each person <code>ID</code> now occupies 36 rows, so we increase the length of all printed dataframes to 40.
</aside>
<p>We’ve now created a variable <code>FP</code> containing the original <code>CALENDARKE</code> variable codes. This variable will be much easier to work with if we 1) convert it into a factor, and 2) replace missing values with <code>NA</code> (e.g. month 36 for individuals interviewed in November 2018). We’ll also coerce <code>MONTH</code> from a “character” to an “integer” class.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>dat</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span>
  <span class='fu'>mutate</span><span class='op'>(</span>
    MONTH <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='va'>MONTH</span><span class='op'>)</span>,
    FP <span class='op'>=</span> <span class='va'>FP</span> <span class='op'>%&gt;%</span>
      <span class='fu'>na_if</span><span class='op'>(</span><span class='st'>""</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'>fct_recode</span><span class='op'>(</span>
        <span class='st'>"Birth"</span> <span class='op'>=</span> <span class='st'>"B"</span>,
        <span class='st'>"Pregnant"</span> <span class='op'>=</span> <span class='st'>"P"</span>,
        <span class='st'>"Pregnancy ended"</span> <span class='op'>=</span> <span class='st'>"T"</span>,
        <span class='st'>"No family planning method used"</span> <span class='op'>=</span> <span class='st'>"0"</span>,
        <span class='st'>"Female Sterilization"</span> <span class='op'>=</span> <span class='st'>"1"</span>,
        <span class='st'>"Male Sterilization"</span> <span class='op'>=</span> <span class='st'>"2"</span>,
        <span class='st'>"Implant"</span> <span class='op'>=</span> <span class='st'>"3"</span>,
        <span class='st'>"IUD"</span> <span class='op'>=</span> <span class='st'>"4"</span>,
        <span class='st'>"Injectables"</span> <span class='op'>=</span> <span class='st'>"5"</span>,
        <span class='st'>"Pill"</span> <span class='op'>=</span> <span class='st'>"7"</span>,
        <span class='st'>"Emergency Contraception"</span> <span class='op'>=</span> <span class='st'>"8"</span>,
        <span class='st'>"Male Condom"</span> <span class='op'>=</span> <span class='st'>"9"</span>,
        <span class='st'>"Female Condom"</span> <span class='op'>=</span> <span class='st'>"10"</span>,
        <span class='st'>"Diaphragm"</span> <span class='op'>=</span> <span class='st'>"11"</span>,
        <span class='st'>"Foam / Jelly"</span> <span class='op'>=</span> <span class='st'>"12"</span>,
        <span class='st'>"Standard Days / Cycle beads"</span> <span class='op'>=</span> <span class='st'>"13"</span>,
        <span class='st'>"LAM"</span> <span class='op'>=</span> <span class='st'>"14"</span>,
        <span class='st'>"Rhythm method"</span> <span class='op'>=</span> <span class='st'>"30"</span>,
        <span class='st'>"Withdrawal"</span> <span class='op'>=</span> <span class='st'>"31"</span>,
        <span class='st'>"Other traditional methods"</span> <span class='op'>=</span> <span class='st'>"39"</span>
      <span class='op'>)</span>
  <span class='op'>)</span>

<span class='va'>dat</span>
</code></pre>
</div>
<pre><code># A tibble: 343,764 x 3
      ID MONTH FP                            
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;                         
 1     1    36 No family planning method used
 2     1    35 No family planning method used
 3     1    34 Birth                         
 4     1    33 Pregnant                      
 5     1    32 Pregnant                      
 6     1    31 Pregnant                      
 7     1    30 Pregnant                      
 8     1    29 Pregnant                      
 9     1    28 Pregnant                      
10     1    27 Pregnant                      
11     1    26 Pregnant                      
12     1    25 No family planning method used
13     1    24 No family planning method used
14     1    23 No family planning method used
15     1    22 No family planning method used
16     1    21 No family planning method used
17     1    20 No family planning method used
18     1    19 No family planning method used
19     1    18 No family planning method used
20     1    17 No family planning method used
21     1    16 No family planning method used
22     1    15 No family planning method used
23     1    14 No family planning method used
24     1    13 Implant                       
25     1    12 Implant                       
26     1    11 Implant                       
27     1    10 Implant                       
28     1     9 Implant                       
29     1     8 Implant                       
30     1     7 Implant                       
31     1     6 Implant                       
32     1     5 Implant                       
33     1     4 Implant                       
34     1     3 Implant                       
35     1     2 Implant                       
36     1     1 Implant                       
37     2    36 &lt;NA&gt;                          
38     2    35 Pill                          
39     2    34 Pill                          
40     2    33 Pill                          
# … with 343,724 more rows</code></pre>
</div>
<p>We’re now ready to begin our analysis. To keep our example simple, our survival curves will show the duration of <strong>continuously used family planning methods</strong> for cohorts of women who were using the same method in January 2017. These survival curves will <em>estimate the probability that an individual “survives” - or continues using - a given method at each of 36 months, assuming that she used it in month 1</em>. We’ll exclude the duration of use after any break (for example, if a woman stopped using family planning to become pregnant, but then started again afterward).</p>
<p>Let’s begin with women who were using the contraceptive pill in January 2017. Remove all other women, saving those who remain as a sub-sample called <code>pills</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='va'>dat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>ID</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>use_m1 <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>FP</span> <span class='op'>==</span> <span class='st'>"Pill"</span> <span class='op'>&amp;</span> <span class='va'>MONTH</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>use_m1</span><span class='op'>)</span>

<span class='va'>pills</span> 
</code></pre>
</div>
<pre><code># A tibble: 10,332 x 4
# Groups:   ID [287]
      ID MONTH FP          use_m1
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;       &lt;lgl&gt; 
 1    18    36 &lt;NA&gt;        TRUE  
 2    18    35 Injectables TRUE  
 3    18    34 Injectables TRUE  
 4    18    33 Injectables TRUE  
 5    18    32 Injectables TRUE  
 6    18    31 Injectables TRUE  
 7    18    30 Injectables TRUE  
 8    18    29 Injectables TRUE  
 9    18    28 Injectables TRUE  
10    18    27 Injectables TRUE  
11    18    26 Injectables TRUE  
12    18    25 Injectables TRUE  
13    18    24 Pill        TRUE  
14    18    23 Pill        TRUE  
15    18    22 Pill        TRUE  
16    18    21 Pill        TRUE  
17    18    20 Pill        TRUE  
18    18    19 Pill        TRUE  
19    18    18 Pill        TRUE  
20    18    17 Pill        TRUE  
21    18    16 Pill        TRUE  
22    18    15 Pill        TRUE  
23    18    14 Pill        TRUE  
24    18    13 Pill        TRUE  
25    18    12 Pill        TRUE  
26    18    11 Pill        TRUE  
27    18    10 Pill        TRUE  
28    18     9 Pill        TRUE  
29    18     8 Pill        TRUE  
30    18     7 Pill        TRUE  
31    18     6 Pill        TRUE  
32    18     5 Pill        TRUE  
33    18     4 Pill        TRUE  
34    18     3 Pill        TRUE  
35    18     2 Pill        TRUE  
36    18     1 Pill        TRUE  
37    39    36 Pill        TRUE  
38    39    35 Pill        TRUE  
39    39    34 Pill        TRUE  
40    39    33 Pill        TRUE  
# … with 10,292 more rows</code></pre>
</div>
<p>The next several steps will help us remove every record for each woman <em>except for the last recorded month in which she used the pill</em>. For those whose last month is month 36, we will say she “survived” the full observation period.</p>
<p>To avoid re-entry cases (returning to use of the pill), we’ll find the earliest month that a woman in this cohort was <em>not</em> using the pill. The month prior to this will be her <code>last_month</code> of using the pill. For the first person in this cohort <code>ID == 18</code>, for example, the <code>last_month</code> of use should be <code>MONTH == 24</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='va'>pills</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    non_use_month <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span><span class='va'>FP</span> <span class='op'>!=</span> <span class='st'>"Pill"</span> <span class='op'>|</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>FP</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>MONTH</span><span class='op'>)</span>,
    last_month <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span>
      <span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>non_use_month</span><span class='op'>)</span><span class='op'>)</span>,
      <span class='fl'>36</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>non_use_month</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>
    <span class='op'>)</span>
  <span class='op'>)</span> 

<span class='va'>pills</span>
</code></pre>
</div>
<pre><code># A tibble: 10,332 x 6
# Groups:   ID [287]
      ID MONTH FP          use_m1 non_use_month last_month
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;       &lt;lgl&gt;          &lt;int&gt;      &lt;dbl&gt;
 1    18    36 &lt;NA&gt;        TRUE              36         24
 2    18    35 Injectables TRUE              35         24
 3    18    34 Injectables TRUE              34         24
 4    18    33 Injectables TRUE              33         24
 5    18    32 Injectables TRUE              32         24
 6    18    31 Injectables TRUE              31         24
 7    18    30 Injectables TRUE              30         24
 8    18    29 Injectables TRUE              29         24
 9    18    28 Injectables TRUE              28         24
10    18    27 Injectables TRUE              27         24
11    18    26 Injectables TRUE              26         24
12    18    25 Injectables TRUE              25         24
13    18    24 Pill        TRUE              NA         24
14    18    23 Pill        TRUE              NA         24
15    18    22 Pill        TRUE              NA         24
16    18    21 Pill        TRUE              NA         24
17    18    20 Pill        TRUE              NA         24
18    18    19 Pill        TRUE              NA         24
19    18    18 Pill        TRUE              NA         24
20    18    17 Pill        TRUE              NA         24
21    18    16 Pill        TRUE              NA         24
22    18    15 Pill        TRUE              NA         24
23    18    14 Pill        TRUE              NA         24
24    18    13 Pill        TRUE              NA         24
25    18    12 Pill        TRUE              NA         24
26    18    11 Pill        TRUE              NA         24
27    18    10 Pill        TRUE              NA         24
28    18     9 Pill        TRUE              NA         24
29    18     8 Pill        TRUE              NA         24
30    18     7 Pill        TRUE              NA         24
31    18     6 Pill        TRUE              NA         24
32    18     5 Pill        TRUE              NA         24
33    18     4 Pill        TRUE              NA         24
34    18     3 Pill        TRUE              NA         24
35    18     2 Pill        TRUE              NA         24
36    18     1 Pill        TRUE              NA         24
37    39    36 Pill        TRUE              NA         36
38    39    35 Pill        TRUE              NA         36
39    39    34 Pill        TRUE              NA         36
40    39    33 Pill        TRUE              NA         36
# … with 10,292 more rows</code></pre>
</div>
<p>We must now identify whether the <code>last_month</code> represents cessation or right-censoring. Remember that a large number of women in our sample have missing values in the 36th month: they are <em>right-censored</em> at month 35 if they had been continuously using the pill until that time, so we cannot say that they ceased using at month 35!</p>
<p>To make this easier, we’ll create a logical variable <code>right_censored</code> that simply indicates whether each person is missing a value for <code>MONTH == 36</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='va'>pills</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>right_censored <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>MONTH</span> <span class='op'>==</span> <span class='fl'>36</span> <span class='op'>&amp;</span> <span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>FP</span><span class='op'>)</span>, <span class='cn'>T</span>, <span class='cn'>F</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/base/any.html'>any</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>pills</span> 
</code></pre>
</div>
<pre><code># A tibble: 10,332 x 7
# Groups:   ID [287]
      ID MONTH FP       use_m1 non_use_month last_month right_censored
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;    &lt;lgl&gt;          &lt;int&gt;      &lt;dbl&gt; &lt;lgl&gt;         
 1    18    36 &lt;NA&gt;     TRUE              36         24 TRUE          
 2    18    35 Injecta… TRUE              35         24 TRUE          
 3    18    34 Injecta… TRUE              34         24 TRUE          
 4    18    33 Injecta… TRUE              33         24 TRUE          
 5    18    32 Injecta… TRUE              32         24 TRUE          
 6    18    31 Injecta… TRUE              31         24 TRUE          
 7    18    30 Injecta… TRUE              30         24 TRUE          
 8    18    29 Injecta… TRUE              29         24 TRUE          
 9    18    28 Injecta… TRUE              28         24 TRUE          
10    18    27 Injecta… TRUE              27         24 TRUE          
11    18    26 Injecta… TRUE              26         24 TRUE          
12    18    25 Injecta… TRUE              25         24 TRUE          
13    18    24 Pill     TRUE              NA         24 TRUE          
14    18    23 Pill     TRUE              NA         24 TRUE          
15    18    22 Pill     TRUE              NA         24 TRUE          
16    18    21 Pill     TRUE              NA         24 TRUE          
17    18    20 Pill     TRUE              NA         24 TRUE          
18    18    19 Pill     TRUE              NA         24 TRUE          
19    18    18 Pill     TRUE              NA         24 TRUE          
20    18    17 Pill     TRUE              NA         24 TRUE          
21    18    16 Pill     TRUE              NA         24 TRUE          
22    18    15 Pill     TRUE              NA         24 TRUE          
23    18    14 Pill     TRUE              NA         24 TRUE          
24    18    13 Pill     TRUE              NA         24 TRUE          
25    18    12 Pill     TRUE              NA         24 TRUE          
26    18    11 Pill     TRUE              NA         24 TRUE          
27    18    10 Pill     TRUE              NA         24 TRUE          
28    18     9 Pill     TRUE              NA         24 TRUE          
29    18     8 Pill     TRUE              NA         24 TRUE          
30    18     7 Pill     TRUE              NA         24 TRUE          
31    18     6 Pill     TRUE              NA         24 TRUE          
32    18     5 Pill     TRUE              NA         24 TRUE          
33    18     4 Pill     TRUE              NA         24 TRUE          
34    18     3 Pill     TRUE              NA         24 TRUE          
35    18     2 Pill     TRUE              NA         24 TRUE          
36    18     1 Pill     TRUE              NA         24 TRUE          
37    39    36 Pill     TRUE              NA         36 FALSE         
38    39    35 Pill     TRUE              NA         36 FALSE         
39    39    34 Pill     TRUE              NA         36 FALSE         
40    39    33 Pill     TRUE              NA         36 FALSE         
# … with 10,292 more rows</code></pre>
</div>
<p>We’ll create another logical variable <code>ceased</code> to indicate whether each woman actually stopped using the pill at her <code>last_month</code>. If not (either because <code>last_month</code> is 36, or she is right-censored and <code>last_month</code> is 35), it will take the value <code>FALSE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='va'>pills</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    ceased <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>right_censored</span> <span class='op'>&amp;</span> <span class='va'>last_month</span> <span class='op'>==</span> <span class='fl'>35</span> <span class='op'>~</span> <span class='cn'>F</span>,
      <span class='va'>last_month</span> <span class='op'>==</span> <span class='fl'>36</span> <span class='op'>~</span> <span class='cn'>F</span>,
      <span class='va'>last_month</span> <span class='op'>&lt;</span> <span class='fl'>36</span> <span class='op'>~</span> <span class='cn'>T</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>ID</span>, <span class='va'>MONTH</span>, <span class='va'>FP</span>, <span class='va'>last_month</span>, <span class='va'>ceased</span><span class='op'>)</span>

<span class='va'>pills</span>
</code></pre>
</div>
<pre><code># A tibble: 10,332 x 5
# Groups:   ID [287]
      ID MONTH FP          last_month ceased
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;            &lt;dbl&gt; &lt;lgl&gt; 
 1    18    36 &lt;NA&gt;                24 TRUE  
 2    18    35 Injectables         24 TRUE  
 3    18    34 Injectables         24 TRUE  
 4    18    33 Injectables         24 TRUE  
 5    18    32 Injectables         24 TRUE  
 6    18    31 Injectables         24 TRUE  
 7    18    30 Injectables         24 TRUE  
 8    18    29 Injectables         24 TRUE  
 9    18    28 Injectables         24 TRUE  
10    18    27 Injectables         24 TRUE  
11    18    26 Injectables         24 TRUE  
12    18    25 Injectables         24 TRUE  
13    18    24 Pill                24 TRUE  
14    18    23 Pill                24 TRUE  
15    18    22 Pill                24 TRUE  
16    18    21 Pill                24 TRUE  
17    18    20 Pill                24 TRUE  
18    18    19 Pill                24 TRUE  
19    18    18 Pill                24 TRUE  
20    18    17 Pill                24 TRUE  
21    18    16 Pill                24 TRUE  
22    18    15 Pill                24 TRUE  
23    18    14 Pill                24 TRUE  
24    18    13 Pill                24 TRUE  
25    18    12 Pill                24 TRUE  
26    18    11 Pill                24 TRUE  
27    18    10 Pill                24 TRUE  
28    18     9 Pill                24 TRUE  
29    18     8 Pill                24 TRUE  
30    18     7 Pill                24 TRUE  
31    18     6 Pill                24 TRUE  
32    18     5 Pill                24 TRUE  
33    18     4 Pill                24 TRUE  
34    18     3 Pill                24 TRUE  
35    18     2 Pill                24 TRUE  
36    18     1 Pill                24 TRUE  
37    39    36 Pill                36 FALSE 
38    39    35 Pill                36 FALSE 
39    39    34 Pill                36 FALSE 
40    39    33 Pill                36 FALSE 
# … with 10,292 more rows</code></pre>
</div>
<aside>
For display purposes, we drop all variables except for <code>ID</code>, <code>MONTH</code>, <code>FP</code>, <code>last_month</code>, and <code>ceased</code>.
</aside>
<p>Remove all rows except for the row containing each woman’s <code>last_month</code>. The result will be a data frame where each woman in the <code>pills</code> cohort occupies <em>only one row</em>, which 1) shows her last month of recorded use and 2) indicates whether we know that she actually stopped using the pill in her last month.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='va'>pills</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>last_month</span> <span class='op'>==</span> <span class='va'>MONTH</span><span class='op'>)</span> 

<span class='va'>pills</span>
</code></pre>
</div>
<pre><code># A tibble: 287 x 5
# Groups:   ID [287]
      ID MONTH FP    last_month ceased
   &lt;int&gt; &lt;int&gt; &lt;fct&gt;      &lt;dbl&gt; &lt;lgl&gt; 
 1    18    24 Pill          24 TRUE  
 2    39    36 Pill          36 FALSE 
 3    44     5 Pill           5 TRUE  
 4    59    36 Pill          36 FALSE 
 5    60     6 Pill           6 TRUE  
 6    99    36 Pill          36 FALSE 
 7   188    36 Pill          36 FALSE 
 8   202    36 Pill          36 FALSE 
 9   218    35 Pill          35 FALSE 
10   233    12 Pill          12 TRUE  
11   260     2 Pill           2 TRUE  
12   290    35 Pill          35 FALSE 
13   298    20 Pill          20 TRUE  
14   335    12 Pill          12 TRUE  
15   340    11 Pill          11 TRUE  
16   419    36 Pill          36 FALSE 
17   423    36 Pill          36 FALSE 
18   428     4 Pill           4 TRUE  
19   460    16 Pill          16 TRUE  
20   488    17 Pill          17 TRUE  
21   551    32 Pill          32 TRUE  
22   669    36 Pill          36 FALSE 
23   697    23 Pill          23 TRUE  
24   707    26 Pill          26 TRUE  
25   757    33 Pill          33 TRUE  
26   767    23 Pill          23 TRUE  
27   785    18 Pill          18 TRUE  
28   836     1 Pill           1 TRUE  
29   837    12 Pill          12 TRUE  
30   850    35 Pill          35 FALSE 
31   930    36 Pill          36 FALSE 
32   943    13 Pill          13 TRUE  
33   955     5 Pill           5 TRUE  
34   977    36 Pill          36 FALSE 
35  1001    36 Pill          36 FALSE 
36  1037    36 Pill          36 FALSE 
37  1120     7 Pill           7 TRUE  
38  1167    19 Pill          19 TRUE  
39  1233    36 Pill          36 FALSE 
40  1271    32 Pill          32 TRUE  
# … with 247 more rows</code></pre>
</div>
<p>Let’s now fit the Kaplan Meier estimator with <code>survfit</code>, which takes a survival object created by <code>Surv</code>. The function <code>summary</code> shows the survival probabilities at each month in a column called <code>survival</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pills</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/survival/man/survfit.html'>survfit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/pkg/survival/man/Surv.html'>Surv</a></span><span class='op'>(</span><span class='va'>last_month</span>, <span class='va'>ceased</span><span class='op'>)</span> <span class='op'>~</span> <span class='fl'>1</span>, data <span class='op'>=</span> <span class='va'>pills</span><span class='op'>)</span>

<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>pills</span><span class='op'>)</span>
</code></pre>
</div>
<pre><code>Call: survfit(formula = Surv(last_month, ceased) ~ 1, data = pills)

 time n.risk n.event survival std.err lower 95% CI upper 95% CI
    1    287       4    0.986 0.00692        0.973        1.000
    2    283       6    0.965 0.01082        0.944        0.987
    3    277       7    0.941 0.01393        0.914        0.968
    4    270      10    0.906 0.01723        0.873        0.940
    5    260      14    0.857 0.02066        0.818        0.899
    6    246       4    0.843 0.02146        0.802        0.886
    7    242       7    0.819 0.02274        0.775        0.865
    8    235       5    0.801 0.02355        0.757        0.849
    9    230       3    0.791 0.02400        0.745        0.839
   10    227       5    0.774 0.02471        0.727        0.823
   11    222       8    0.746 0.02571        0.697        0.798
   12    214      21    0.672 0.02770        0.620        0.729
   13    193       9    0.641 0.02831        0.588        0.699
   14    184       6    0.620 0.02865        0.567        0.679
   15    178       2    0.613 0.02875        0.559        0.672
   16    176       5    0.596 0.02897        0.542        0.655
   17    171       8    0.568 0.02924        0.513        0.628
   18    163       6    0.547 0.02938        0.492        0.608
   19    157       7    0.523 0.02948        0.468        0.584
   20    150       2    0.516 0.02950        0.461        0.577
   21    148       2    0.509 0.02951        0.454        0.570
   22    146       3    0.498 0.02951        0.444        0.560
   23    143       6    0.477 0.02948        0.423        0.539
   24    137       9    0.446 0.02934        0.392        0.507
   25    128       3    0.436 0.02927        0.382        0.497
   26    125       4    0.422 0.02915        0.368        0.483
   27    121       1    0.418 0.02912        0.365        0.479
   28    120       3    0.408 0.02901        0.355        0.469
   29    117       2    0.401 0.02893        0.348        0.462
   31    115       2    0.394 0.02884        0.341        0.455
   32    113       3    0.383 0.02870        0.331        0.444
   33    110       3    0.373 0.02854        0.321        0.433
   34    107       3    0.362 0.02837        0.311        0.422</code></pre>
</div>
<p>We can plot this with <code>autoplot</code>:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>autoplot</span><span class='op'>(</span>
  <span class='va'>pills</span>,
  main <span class='op'>=</span> <span class='st'>"Kaplan-Meier survival estimate: Pills"</span>,
  xlab <span class='op'>=</span> <span class='st'>"Months"</span>,
  ylab <span class='op'>=</span> <span class='st'>"Probability of Continuous Use"</span>,
  ylim <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
  censor <span class='op'>=</span> <span class='cn'>F</span>
<span class='op'>)</span>
</code></pre>
</div>
<p><img src="paa-2021_files/figure-html5/unnamed-chunk-13-1.png" width="624" /></p>
</div>
<p>For additional examples using other family planning methods, <a href="event-materials/paa2021.Rmd">download the R Markdown script from this breakout session</a>. Video from the session is included below:</p>
<p><br/> <iframe width="560" height="315" src="https://www.youtube.com/embed/UZo_SfRr0sY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <br/></p>
<h1 id="breakout-session-stata-users">Breakout Session: Stata Users</h1>
<p>IPUMS PMA extracts for Stata should be decompressed before use and loaded with an appropriate filepath:</p>
<pre><code>. clear
. use &quot;[filepath]/pma_00001.dta&quot;
. cd &quot;[filepath]&quot;
. set more off</code></pre>
<aside>
Remember to set your own filepath and change the name of your file to match your own data extract!
</aside>
<p>As shown in the R example above, this dataset contains 9,549 rows where each row represents one respondent to the Female Questionnaire. You’ll find a unique identification number for each respondent in <code>personid</code>, and their comma-separated contraceptive calendar strings in <code>calendarke</code>. We’ll show these two variables for the first 3 respondents:</p>
<pre><code>. list personid calendarke in 1/3

     +----------------------------------------------------------------------+
  1. |                                           personid                   |
     |                              404201900050442019002                   |
     |----------------------------------------------------------------------|
     | calendarke                                                           |
     |   0,0,B,P,P,P,P,P,P,P,P,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,.. |
     +----------------------------------------------------------------------+

     +----------------------------------------------------------------------+
  2. |                                           personid                   |
     |                              404201900009272019002                   |
     |----------------------------------------------------------------------|
     | calendarke                                                           |
     |   ,7,7,7,7,7,7,7,7,0,B,P,P,P,P,P,P,P,P,0,0,0,0,0,9,9,9,9,9,9,9,9,9.. |
     +----------------------------------------------------------------------+

     +----------------------------------------------------------------------+
  3. |                                           personid                   |
     |                              404201900099612019003                   |
     |----------------------------------------------------------------------|
     | calendarke                                                           |
     |   0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.. |
     +----------------------------------------------------------------------+</code></pre>
<p>As you can see, <code>calendarke</code> includes the same contraceptive calendar codes shown above, each separated by a comma. Each string contains 36 codes: these represent the 36 months from January 2017 through December 2019 (the last month in which Kenya 2019 samples were collected). The left-most code represents the <em>most recent available month</em>.</p>
<p>Notice the second listed person (<code>personid 404201900009272019002</code>); their <code>calendarke</code> string begins with a comma rather than a response code. This indicates a person who was interviewed in November 2019, rather than December. Because December 2019 would have been a future month for such a person, their first value is blank.</p>
<p>Split the <code>calendarke</code> string into 36 separate columns with the <code>split</code> function:</p>
<pre><code>. split calendarke, p(,) gen(cal_ke)
variables created as string: 
cal_ke1   cal_ke7   cal_ke13  cal_ke19  cal_ke25  cal_ke31
cal_ke2   cal_ke8   cal_ke14  cal_ke20  cal_ke26  cal_ke32
cal_ke3   cal_ke9   cal_ke15  cal_ke21  cal_ke27  cal_ke33
cal_ke4   cal_ke10  cal_ke16  cal_ke22  cal_ke28  cal_ke34
cal_ke5   cal_ke11  cal_ke17  cal_ke23  cal_ke29  cal_ke35
cal_ke6   cal_ke12  cal_ke18  cal_ke24  cal_ke30  cal_ke36</code></pre>
<p>Then, reshape the data from wide to long format as shown in the R example above. The index number for each month will pivot downward into a new column called <code>month</code>, and the woman’s response code for each month will pivot downward into an adjacent column called <code>cal_ke</code>:</p>
<pre><code>. reshape long cal_ke, i(personid) j(month)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 
&gt; 26 27 28 29 30 31 32 33 34 35 36)

Data                               wide   -&gt;   long
-----------------------------------------------------------------------------
Number of obs.                     9549   -&gt;  343764
Number of variables                  52   -&gt;      18
j variable (36 values)                    -&gt;   month
xij variables:
           cal_ke1 cal_ke2 ... cal_ke36   -&gt;   cal_ke
-----------------------------------------------------------------------------</code></pre>
<p>Notice that the dataset now has 343,764 rows, where each of our 9,549 respondents occupies 36 rows apiece (one for each <code>month</code>).</p>
<p>By default, Stata numbered each month in increasing order from left to right. As we’ve discussed, however, the contraceptive calendar data are chronologically organized from right to left (the most recent month is stored in the first month of the <code>calendarke</code> string). We suggest renumbering the <code>cal_ke</code> variables here so that <code>cal_ke1</code> represents the first month, January 2017.</p>
<pre><code>. replace month = 37 - month
(343,764 real changes made)
. sort personid month</code></pre>
<p>You might also find it useful to create century month codes <code>cmc</code> for each month, beginning with 1405 for January 2017.</p>
<pre><code>. gen cmc = month + 1404</code></pre>
<p>As a final clean-up step, we create a numeric version of <code>cal_ke</code> called <code>numcal_ke</code> by changing the codes for pregnancy, pregnancy termination, and birth to <code>90</code>, <code>91</code>, and <code>92</code> respectively. We then provide labels to each of the values in <code>numcal_ke</code>.</p>
<pre><code>. gen numcal_ke = cal_ke
(3,755 missing values generated)
. replace numcal_ke = &quot;90&quot; if numcal_ke == &quot;P&quot;
(24,364 real changes made)
. replace numcal_ke = &quot;91&quot; if numcal_ke == &quot;T&quot;
(341 real changes made)
. replace numcal_ke = &quot;92&quot; if numcal_ke == &quot;B&quot;
(2,934 real changes made)
. destring numcal_ke, replace
numcal_ke: all characters numeric; replaced as byte
(3755 missing values generated)

. label define calendar 92 &quot;Birth&quot; 90 &quot;Pregnant&quot; 91 &quot;Pregnancy ended&quot; 0 &quot;No 
&gt; family planning method used&quot; 1 &quot;Female Sterilization&quot; 2 &quot;Male Sterilization&quot; 3 
&gt; &quot;Implant&quot; 4 &quot;IUD&quot; 5 &quot;Injectables&quot; 7 &quot;Pill&quot; 8 &quot;Emergency Contraception&quot; 9 &quot;Male 
&gt; Condom&quot; 10 &quot;Female Condom&quot; 11 &quot;Diaphragm&quot; 12 &quot;Foam / Jelly&quot; 13 &quot;Standard Days / 
&gt; Cycle beads&quot; 14 &quot;LAM&quot; 30 &quot;Rhythm method&quot; 31 &quot;Withdrawal&quot; 39 &quot;Other traditional 
&gt; methods&quot;

. label values numcal_ke calendar</code></pre>
<p>Finally, we’re ready to begin our analysis. As with the R example above, we’ll create survival curves showing the duration of <strong>continuously used family planning methods</strong> for cohorts of women who were using the same method in January 2017. These curves will <em>estimate the probability that an individual “survives” - or continues using - a given method at each of 36 months, assuming that she used it in month 1</em>. We’ll exclude the duration of use after any break (for example, if a woman stopped using family planning to become pregnant, but then started again afterward).</p>
<p>Consider the cohort of women who were all using the contraceptive pill in January 2017 (month 1). We’ll flag these cases and include all rows from those women in a sub-sample called <code>pill_sample</code>:</p>
<pre><code>. recode numcal_ke (7=1) (else=0), gen(pill)
(162306 differences between numcal_ke and pill)
. gen pill_temp = 0 
. replace pill_temp = 1 if pill == 1 &amp; month == 1
(287 real changes made)
. egen pill_sample = max(pill_temp), by(personid)</code></pre>
<p>The function <code>stset</code> establishes the data in memory as “survival-time” data, where the variable <code>month</code> records time in months, the identification number for each person is provided by <code>id(personid)</code>, and cessation of use (i.e. <code>failure</code>) is marked by the first instance where <code>pill==0</code> for each person in the sub-sample.</p>
<pre><code>. stset month, id(personid) failure(pill==0)

                id:  personid
     failure event:  pill == 0
obs. time interval:  (month[_n-1], month]
 exit on or before:  failure

-----------------------------------------------------------------------------
&gt; -
    343,764  total observations
    328,001  observations begin on or after (first) failure
-----------------------------------------------------------------------------
&gt; -
     15,763  observations remaining, representing
      9,549  subjects
      9,463  failures in single-failure-per-subject data
     15,763  total analysis time at risk and under observation
                                                at risk from t =         0
                                     earliest observed entry t =         0
                                          last observed exit t =        36</code></pre>
<p>The function <code>sts list</code> produces a similar table to the one produced by <code>summary(pills)</code> in the R example above. The column <code>Survivor Function</code> estimates the probability of “surviving” - or continuously using - the pill at each month shown in the column <code>Time</code>.</p>
<pre><code>.  sts list if pill_sample == 1

         failure _d:  pill == 0
   analysis time _t:  month
                 id:  personid

           Beg.          Net            Survivor      Std.
  Time    Total   Fail   Lost           Function     Error     [95% Conf. Int.]
-------------------------------------------------------------------------------
     2      287      4      0             0.9861    0.0069     0.9633    0.9947
     3      283      6      0             0.9652    0.0108     0.9362    0.9811
     4      277      7      0             0.9408    0.0139     0.9064    0.9628
     5      270     10      0             0.9059    0.0172     0.8658    0.9345
     6      260     14      0             0.8571    0.0207     0.8111    0.8927
     7      246      4      0             0.8432    0.0215     0.7957    0.8805
     8      242      7      0             0.8188    0.0227     0.7692    0.8588
     9      235      5      0             0.8014    0.0235     0.7504    0.8431
    10      230      3      0             0.7909    0.0240     0.7392    0.8336
    11      227      5      0             0.7735    0.0247     0.7206    0.8177
    12      222      8      0             0.7456    0.0257     0.6911    0.7920
    13      214     21      0             0.6725    0.0277     0.6149    0.7234
    14      193      9      0             0.6411    0.0283     0.5827    0.6936
    15      184      6      0             0.6202    0.0286     0.5614    0.6735
    16      178      2      0             0.6132    0.0287     0.5543    0.6668
    17      176      5      0             0.5958    0.0290     0.5366    0.6500
    18      171      8      0             0.5679    0.0292     0.5085    0.6229
    19      163      6      0             0.5470    0.0294     0.4876    0.6025
    20      157      7      0             0.5226    0.0295     0.4633    0.5786
    21      150      2      0             0.5157    0.0295     0.4564    0.5717
    22      148      2      0             0.5087    0.0295     0.4495    0.5648
    23      146      3      0             0.4983    0.0295     0.4391    0.5545
    24      143      6      0             0.4774    0.0295     0.4185    0.5337
    25      137      9      0             0.4460    0.0293     0.3878    0.5024
    26      128      3      0             0.4355    0.0293     0.3776    0.4920
    27      125      4      0             0.4216    0.0291     0.3641    0.4779
    28      121      1      0             0.4181    0.0291     0.3607    0.4744
    29      120      3      0             0.4077    0.0290     0.3506    0.4639
    30      117      2      0             0.4007    0.0289     0.3438    0.4568
    32      115      2      0             0.3937    0.0288     0.3371    0.4498
    33      113      3      0             0.3833    0.0287     0.3271    0.4391
    34      110      3      0             0.3728    0.0285     0.3170    0.4285
    35      107      3      0             0.3624    0.0284     0.3070    0.4178
    36      104     18     86             0.2997    0.0270     0.2477    0.3532
-------------------------------------------------------------------------------</code></pre>
<p>A survival curve representing this table can be made with:</p>
<pre><code>sts graph if pill_sample == 1</code></pre>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/stata_pill.png" width="396" /></p>
</div>
<aside>
This plot is similar to the one generated by <code>autoplot</code> in R, except that 1) it does not include a shaded 95% confidence interval, and 2) right-censored cases are not excluded, producing a sharp downward turn in month 36.
</aside>
<p>For additional examples using other family planning methods, <a href="event-materials/paa_2021_side_event.do">download the Stata .do file from this breakout session here</a>. Video from the session is included below:</p>
<p><br/> <iframe width="560" height="315" src="https://www.youtube.com/embed/g0RSRqPXx7Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> <br/></p>
<h1 id="download-links">Download Links</h1>
<ul>
<li><a href="event-materials/IPUMS_PMA_Webinar_Slides.pptx">Powerpoint Slides</a></li>
<li><a href="event-materials/paa2021.Rmd">R Markdown Script</a></li>
<li><a href="event-materials/paa_2021_side_event.do">Stata .do File</a></li>
<li><a href="event-materials/chat.txt">Chat Transcript</a> (participant names are redacted)</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2021-05-15-paa-2021/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Making%20the%20Contraceptive%20Calendar%20Data%20Work%20For%20You&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-05-15-paa-2021%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-05-15-paa-2021%2F&amp;title=Making%20the%20Contraceptive%20Calendar%20Data%20Work%20For%20You">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://pma-data-hub.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://ipums.github.io/pma-data-hub/posts/2021-05-15-paa-2021/';
  this.page.identifier = 'posts/2021-05-15-paa-2021/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://pma-data-hub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/ipums/pma-data-hub/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota</p>
  <p>Licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a></p>
  <p>Site built with <a href="https://rstudio.github.io/distill/">Distill for R Markdown</a></p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
