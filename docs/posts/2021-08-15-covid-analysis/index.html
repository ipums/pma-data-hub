<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #20794d; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #20794d; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Data Analysis Hub: Multinomial Regression with Complex Survey Design</title>

<meta property="description" itemprop="description" content="The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package."/>

<link rel="canonical" href="https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/"/>
<link rel="icon" type="image/png" href="../../images/favicon/favicon-32x32.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-08-15"/>
<meta property="article:created" itemprop="dateCreated" content="2021-08-15"/>
<meta name="article:author" content="Devon Kristiansen"/>
<meta name="article:author" content="Matt Gunther"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Data Analysis Hub: Multinomial Regression with Complex Survey Design"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package."/>
<meta property="og:url" content="https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/"/>
<meta property="og:image" content="https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/images/alluvial.png"/>
<meta property="og:image:width" content="1422"/>
<meta property="og:image:height" content="714"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Data Analysis Hub"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="Data Analysis Hub: Multinomial Regression with Complex Survey Design"/>
<meta property="twitter:description" content="The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package."/>
<meta property="twitter:url" content="https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/"/>
<meta property="twitter:image" content="https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/images/alluvial.png"/>
<meta property="twitter:image:width" content="1422"/>
<meta property="twitter:image:height" content="714"/>
<meta property="twitter:site" content="@ipumsGH"/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","preview","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["Multinomial Regression with Complex Survey Design"]},{"type":"character","attributes":{},"value":["The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Devon Kristiansen"]},{"type":"character","attributes":{},"value":["https://www.linkedin.com/in/devonkristiansen"]},{"type":"character","attributes":{},"value":["IPUMS PMA Project Manager"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Matt Gunther"]},{"type":"character","attributes":{},"value":["IPUMS PMA Senior Data Analyst"]}]}]},{"type":"character","attributes":{},"value":["08-15-2021"]},{"type":"character","attributes":{},"value":["COVID-19","Data Analysis","svyVGAM","Multinomial Logit"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_depth","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[3]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["images/alluvial.png"]},{"type":"character","attributes":{},"value":["https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["covid-analysis_files/anchor-4.2.2/anchor.min.js","covid-analysis_files/bowser-1.9.3/bowser.min.js","covid-analysis_files/distill-2.2.21/template.v2.js","covid-analysis_files/figure-html5/unnamed-chunk-10-1.png","covid-analysis_files/figure-html5/unnamed-chunk-11-1.png","covid-analysis_files/figure-html5/unnamed-chunk-12-1.png","covid-analysis_files/figure-html5/unnamed-chunk-13-1.png","covid-analysis_files/figure-html5/unnamed-chunk-14-1.png","covid-analysis_files/figure-html5/unnamed-chunk-15-1.png","covid-analysis_files/figure-html5/unnamed-chunk-18-1.png","covid-analysis_files/figure-html5/unnamed-chunk-19-1.png","covid-analysis_files/figure-html5/unnamed-chunk-22-1.png","covid-analysis_files/figure-html5/unnamed-chunk-7-1.png","covid-analysis_files/header-attrs-2.9/header-attrs.js","covid-analysis_files/jquery-1.11.3/jquery.min.js","covid-analysis_files/kePrint-0.0.1/kePrint.js","covid-analysis_files/lightable-0.0.1/lightable.css","covid-analysis_files/popper-2.6.0/popper.min.js","covid-analysis_files/tippy-6.2.7/tippy-bundle.umd.min.js","covid-analysis_files/tippy-6.2.7/tippy-light-border.css","covid-analysis_files/tippy-6.2.7/tippy.css","covid-analysis_files/tippy-6.2.7/tippy.umd.min.js","covid-analysis_files/webcomponents-2.0.0/webcomponents.js","data/pma_00032.dat.gz","data/pma_00032.xml","data/pma_00039.dat.gz","data/pma_00039.xml","fonts/cabritosanscondbold-webfont.ttf","fonts/cabritosansconddemi-webfont.ttf","fonts/cabritosansnormregular-webfont.ttf","images/alluvial.png","images/bchoose.png","images/bsamples.png","images/cchoose.png","images/change.png","images/csamples.png"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

</style>

<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
            .filter(function(item) { return !!item.description; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description}
                </div>
                <div class="search-item-preview">
                  <img src="${suggestion.preview ? offsetURL(suggestion.preview) : ''}"</img>
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://assets.ipums.org/_css/font-faces.css');

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #00263A;
  --header-color:    #00263A;
  --body-color:      #00263A;
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    cabrito_sans_norm_regular;
  --mono-font:       Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-font:       cabrito_sans_norm_regular;
  --navbar-font:     cabrito_sans_norm_regular;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #00263A;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

h1{
  font-family: 'cabrito_sans_norm_regular';
  text-transform: uppercase;
  color: #00263A;
}

d-title h1{
  font-weight: 500;
}

d-article h1{
  font-size: 36px;
  line-height: 1.1em;
  font-weight: 100;
}

d-article h2{
    font-size: 30px;
    font-family: "cabrito_sans_cond_demi";
    text-transform: uppercase;
    color: #00263A;
    font-weight: 100;
}

d-article h3{
  font-size: 26px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article h4{
  font-size: 24px;
  font-family: 'cabrito_sans_norm_regular';
  color: #00263A;
  text-transform: unset;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article h5{
  font-size: 24px;
  font-family: 'cabrito_sans_cond_demi';
  color: #00263A;
  margin-top: 1.5rem;
  margin-bottom: 1em;
  font-weight: 100;
}

d-article li {
    margin-bottom: 0;
    margin-left: 1rem;
    padding-left: 0;
    color: #00263A;
}

d-article table {
    color: #00263A;
}
.d-contents nav > ul > li > a {
    font-weight: 100;
}

body{
  font-family: 'cabrito_subset';
}

b, strong {
  font-family: "cabrito_sans_cond_demi";
  font-weight: 100;
}

p>a {
    color: #98579B
}

li>a {
    color: #98579B;
}

.btn {
    font-family: "cabrito_subset";
    font-size: 16px;
    background-color: #F0E6F0;
    margin-bottom: 20px;
    border-width: 1px;
    padding-top: 6px;
    padding-bottom: 6px;
    cursor: pointer;
}

.distill-site-header .title {
    text-transform: uppercase;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .logo img{
  max-height: 50px; /* Makes logo bigger, default was 20px */
  vertical-align: middle;
  margin-bottom: 0;
}

.distill-site-header .nav-right {
    float: right;
    line-height: 38px;
    vertical-align: middle;
}

.distill-site-header .nav-left {
    display: inline-block;
    line-height: 38px;
    vertical-align: middle;
}

.algolia-autocomplete {
  line-height: 25px;
}

d-article iframe {
    border: 0;
    margin-bottom: 0;
    width: 100%;
}

d-article aside a {
  color: #98579B;
}

@media(max-width: 767px){
  aside{
    width: 50%;
    position: relative;
    left: 25%;
    padding-bottom: 20px;
  }
}

code {
  font-family: Menlo, Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
	font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
/* only text inside of <p> tags */
d-article > p {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}

/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
	font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
	font-size: var(--aside-size, 12px);
	color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
	font-size: var(--fig-cap-size, 13px);
	color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
	font-size: var(--heading-size, 0.6rem);
	color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
	font-size: var(--body-size, 0.8rem);
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
	color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
	font-size: var(--heading-size, 18px);
}

.d-contents nav a {
	font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
	color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
	color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
	font-size: var(--title-size, 18px);
	font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a:hover {
	color: var(--hover-color, white);
}

.distill-site-header {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
	font-size: var(--text-size, 15px);
	color: var(--text-color, rgba(255, 255, 255, 0.8));
	background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
	color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.9/header-attrs.js"></script>
  <script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>
  <link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-191039907-2"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-191039907-2');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Multinomial Regression with Complex Survey Design","description":"The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package.","authors":[{"author":"Devon Kristiansen","authorURL":"https://www.linkedin.com/in/devonkristiansen","affiliation":"IPUMS PMA Project Manager","affiliationURL":"#","orcidID":""},{"author":"Matt Gunther","authorURL":"#","affiliation":"IPUMS PMA Senior Data Analyst","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-08-15T00:00:00.000+00:00","citationText":"Kristiansen & Gunther, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo" href="https://pma.ipums.org/pma/">
<img src="../../images/logo-white.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Data Analysis Hub</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../index.html">Posts</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Courses
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../introduction.html">Introduction to IPUMS PMA Data Analysis</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
R Tips
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../posts/2020-12-10-get-ipums-pma-data/index.html">Import IPUMS PMA Data into R</a>
<a href="../../posts/2020-12-10-get-r-and-packages/index.html">R, RStudio, and R Packages</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Community
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="../../CONTRIBUTING.html">Contributing guide</a>
<a href="../../CODE_OF_CONDUCT.html">Code of conduct</a>
<a href="../../LICENSE.html">License</a>
<a href="https://github.com/ipums/pma-data-hub/">GitHub</a>
</div>
</div>
<a href="../../about.html">About</a>
<a href="../../index.xml">
<i class="fa fa-rss" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/ipumsGH">
<i class="fab fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://github.com/ipums/pma-data-hub" aria-label="Link to source">
<i class="fab fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Multinomial Regression with Complex Survey Design</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:COVID-19" class="dt-tag">COVID-19</a>
  <a href="../../index.html#category:Data_Analysis" class="dt-tag">Data Analysis</a>
  <a href="../../index.html#category:svyVGAM" class="dt-tag">svyVGAM</a>
  <a href="../../index.html#category:Multinomial_Logit" class="dt-tag">Multinomial Logit</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>The PMA COVID-19 survey is part of a broader panel study. We discuss how to merge it with the baseline survey, and how to specify sample weights and cluster information with the new svyVGAM package.</p></p>
</div>

<div class="d-byline">
  Devon Kristiansen <a href="https://www.linkedin.com/in/devonkristiansen" class="uri">https://www.linkedin.com/in/devonkristiansen</a> (IPUMS PMA Project Manager)
  
,   Matt Gunther  (IPUMS PMA Senior Data Analyst)
  
<br/>08-15-2021
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#setup">Setup</a></li>
<li><a href="#sampling-weights">Sampling Weights</a></li>
<li><a href="#change-in-purchasing-power">Change in purchasing power</a></li>
<li><a href="#multinomial-modeling">Multinomial modeling</a></li>
<li><a href="#wrap-up">Wrap-up</a></li>
</ul>
</nav>
</div>
<p>Throughout our <a href="../../index.html#category:COVID-19">discussion of the PMA COVID-19 survey</a> this summer, weve mentioned that PMA COVID-19 data were collected in telephone interviews with women following a <strong>baseline</strong> survey as part of an ongoing <strong>panel study</strong> focused on family planning and reproductive health.</p>
<p>While the scope of the COVID-19 survey is narrower than the baseline survey, it does contain several repeated questions designed to help researchers evaluate change over the first few months of the pandemic. For example, both surveys contain questions about womens financial independence and the dynamics of household decision-making. In the baseline survey, youll find a variable called <a href="https://pma.ipums.org/pma-action/variables/HHDECDAILY">HHDECDAILY</a> representing a question that asks:</p>
<aside>
<p>The <strong>baseline</strong> survey was administered in-person between November 2019 and February 2020.</p>
The <strong>COVID-19 follow up</strong> administered by telephone between May and August 2020.
</aside>
<pre><code>Who usually makes decisions about making household purchases for daily 
needs: you, your husband/partner, you and your husband/partner jointly, 
or someone else?

[] Respondent
[] Husband/partner
[] Respondent and husband/partner
[] Someone else
[] No response</code></pre>
<p>In the <code>covid</code> survey, a nearly identical question asks women to reflect on changes that happened since COVID-19 restrictions began. Responses are recorded in <a href="https://pma.ipums.org/pma-action/variables/CVBUYDECIDER">CVBUYDECIDER</a>:</p>
<pre><code>Since the Coronavirus (COVID-19) restrictions began, who usually makes
decisions about making household purchases for daily needs: you, your
husband/partner, you and your husband/partner jointly, or someone else?

[] Respondent
[] Husband/partner
[] Respondent and husband/partner
[] Someone else
[] No response</code></pre>
<p>One way you might model change over time with these variables is to look at womens <strong>net change in purchasing power</strong> with a derived <a href="../2021-07-01-covid-tables/index.html#display-value-labels">factor</a> that takes the value:</p>
<ul>
<li>More if a woman has gained autonomy,</li>
<li>Less if she has lost autonomy,</li>
<li>Same if she experienced no change, or</li>
<li><code>NA</code> if either <code>HHDECDAILY</code> or <code>CVBUYDECIDER</code> is not available</li>
</ul>
<p>In this post, well demonstrate how to create and model this type of variable by merging the baseline and COVID-19 surveys together. Weve modeled <a href="../2021-02-19-analyzing-the-individual-in-context/#individual-factors-model-with-svyglm">continuous</a> and <a href="../2021-04-01-et-internal-migration/#regression-model">binary</a> variables in previous posts, but well need a different approach for a dependent variable with <strong>three</strong> outcomes: in this case, well fit a <strong>multinomial logit model</strong> for the odds that a woman will experience the Less or More autonomy relative to maintaining the Same level of autonomy. This task is complicated by two things:</p>
<aside>
If youd like to explore an <strong>ordered logit model</strong> for these outcomes, you can use the same tools we highlight in this post. Check out <a href="https://stats.idre.ucla.edu/r/dae/ordinal-logistic-regression/">this guide</a> for testing the proportional odds assumption underlying ordered logit models.
</aside>
<ol type="1">
<li>Only around <em>half</em> of the women who participated in the in-person baseline survey were reached <a href="https://www.pmadata.org/technical-areas/covid-19">by telephone</a> for the COVID-19 follow up. Well show how changes in the sample design introduce bias to the merged data, and well explain how to mitigate that bias with a <strong>sampling weight</strong> called <code>CVQWEIGHT</code>.</li>
<li>PMA screens households for reproductive age women within geographically defined <strong>sampling clusters</strong> represented by the variable <code>EAID</code>. Our multinomial model should include <strong>cluster-robust standard error estimates</strong> - in other words, we want to account for correlation between neighboring women who live in the same cluster.</li>
</ol>
<p>Until recently, <a href="https://cran.r-project.org/web/packages/nnet/index.html">popular R packages for multinomial regression</a> had no built-in way to handle elements of complex survey design. Fortunately, the new <a href="https://cran.r-project.org/web/packages/svyVGAM/index.html">svyVGAM</a> package offers a simple interface built on the very same <a href="http://r-survey.r-forge.r-project.org/survey/">survey</a> package weve featured throughout this blog. Well demonstrate fitting a multinomial model with <code>CVQWEIGHT</code> and <code>EAID</code> here, but this package also provides a general interface to any generalized linear / additive model supported by the underlying <a href="https://www.stat.auckland.ac.nz/~yee/VGAM/">VGAM</a> package.</p>
<h1 id="setup">Setup</h1>
<p>Weve mentioned in previous posts that youll find harmonized PMA COVID-19 data if you navigate to the <a href="https://pma.ipums.org/pma-action/extract_requests/clear?return_url=%2Fpma-action%2Fvariables%2Fgroup">COVID-19 unit of analysis</a> on the IPUMS PMA website. In this post, well use an extract containing <em>all four</em> of the available COVID-19 samples (Female Respondents only):</p>
<ul>
<li>Burkina Faso 2020</li>
<li>Democratic Republic of Congo (DRC) 2020 - Kinshasa</li>
<li>Kenya 2020</li>
<li>Nigeria 2020 - Lagos and Kano</li>
</ul>
<p>Data from the baseline surveys are located under the Family Planning - Person unit of analysis. <strong>Because data extracts can only contain samples with the same unit of analysis, youll need to create and download two separate extracts</strong>. Once youve downloaded an extract containing COVID-19 data, switch units of analysis by clicking the CHANGE link in the Currently Browsing window at the top of your screen:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/change.png" width="1082" /></p>
</div>
<p>Then, select the Family Planning - Person unit of analysis in this menu:</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="images/bchoose.png" width="1082" /></p>
</div>
<p>Youll need to create an extract that contains these samples (again, Female Respondents only):</p>
<ul>
<li>Burkina Faso 2020</li>
<li>Democratic Republic of Congo (DRC) 2019a - Kinshasa</li>
<li>Kenya</li>
<li>Nigeria 2019a - Kano</li>
<li>Nigeria 2019b - Lagos</li>
</ul>
<p>In the example workflow shown below, weve downloaded <em>both</em> extracts and saved them together in the data folder of our R working directory. Weve also installed and loaded the following packages:</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>   <span class='co'># 1.3.1</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://broom.tidymodels.org/'>broom</a></span><span class='op'>)</span>       <span class='co'># 0.7.6</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://www.ipums.org'>ipumsr</a></span><span class='op'>)</span>      <span class='co'># 0.4.5</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://gdfe.co/srvyr/'>srvyr</a></span><span class='op'>)</span>       <span class='co'># 1.0.1</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>svyVGAM</span><span class='op'>)</span>     <span class='co'># 1.0</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://haozhu233.github.io/kableExtra/'>kableExtra</a></span><span class='op'>)</span>  <span class='co'># 1.3.4</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://corybrunson.github.io/ggalluvial/'>ggalluvial</a></span><span class='op'>)</span>  <span class='co'># 0.12.3</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>dotwhisker</span><span class='op'>)</span>  <span class='co'># 0.6.0</span>
</code></pre>
</div>
</div>
<p>Now, well load both of our data extracts into R. Well create two separate dataframes named <code>covid</code> and <code>baseline</code> (well also edit the variable <code>COUNTRY</code> in each extract for additional clarity):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>covid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00032.xml"</span>,
  data_file <span class='op'>=</span> <span class='st'>"data/pma_00032.dat.gz"</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>COUNTRY <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>COUNTRY</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"DRC (Kinshasa)"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>2</span>, 
    <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='st'>"Nigeria (Lagos/Kano)"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>9</span>
  <span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>  

<span class='va'>baseline</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/read_ipums_micro.html'>read_ipums_micro</a></span><span class='op'>(</span>
  ddi <span class='op'>=</span> <span class='st'>"data/pma_00039.xml"</span>,
  data_file <span class='op'>=</span> <span class='st'>"data/pma_00039.dat.gz"</span>
<span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>COUNTRY <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>COUNTRY</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl_relabel.html'>lbl_relabel</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"DRC (Kinshasa)"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>2</span>, 
    <span class='fu'><a href='https://rdrr.io/pkg/ipumsr/man/lbl.html'>lbl</a></span><span class='op'>(</span><span class='fl'>9</span>, <span class='st'>"Nigeria (Lagos/Kano)"</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>.val</span> <span class='op'>==</span> <span class='fl'>9</span>
  <span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>  
</code></pre>
</div>
</div>
<p>One last thing here: well be making several graphs to help illustrate our workflow in this post. Well create a custom theme <code>theme_pma()</code> for those graphs so that the fonts, colors, and other design elements match the overall look of this blog.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/yixuan/showtext'>showtext</a></span><span class='op'>)</span>
<span class='fu'>font_add</span><span class='op'>(</span>
  family <span class='op'>=</span> <span class='st'>"cabrito"</span>, 
  regular <span class='op'>=</span> <span class='st'>"../../fonts/cabritosansnormregular-webfont.ttf"</span>
<span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/pkg/showtext/man/showtext_auto.html'>showtext_auto</a></span><span class='op'>(</span><span class='op'>)</span>

<span class='va'>theme_pma</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>title</span>, <span class='va'>subtitle</span> <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>x</span> <span class='op'>=</span> <span class='cn'>NULL</span>, <span class='va'>legend.position</span><span class='op'>)</span><span class='op'>{</span>
  <span class='va'>components</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%+replace%</span> 
      <span class='fu'>theme</span><span class='op'>(</span>
        text <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>family <span class='op'>=</span> <span class='st'>"cabrito"</span>, size <span class='op'>=</span> <span class='fl'>14</span><span class='op'>)</span>, 
        plot.title <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>
          size <span class='op'>=</span> <span class='fl'>18</span>, color <span class='op'>=</span> <span class='st'>"#00263A"</span>, margin <span class='op'>=</span> <span class='fu'>margin</span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span>
        <span class='op'>)</span>, 
        plot.subtitle <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>
          size <span class='op'>=</span> <span class='fl'>16</span>, color <span class='op'>=</span> <span class='st'>"#00263A"</span>, margin <span class='op'>=</span> <span class='fu'>margin</span><span class='op'>(</span>b <span class='op'>=</span> <span class='fl'>5</span><span class='op'>)</span>
        <span class='op'>)</span>,
        legend.title <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>,        
        legend.position <span class='op'>=</span> <span class='va'>legend.position</span>,
        strip.text.y <span class='op'>=</span> <span class='fu'>element_text</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>12</span>, angle <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
        panel.spacing <span class='op'>=</span> <span class='fu'>unit</span><span class='op'>(</span><span class='fl'>2</span>, <span class='st'>"lines"</span><span class='op'>)</span>
      <span class='op'>)</span>,
    <span class='fu'>scale_fill_manual</span><span class='op'>(</span>
      values <span class='op'>=</span> <span class='fu'>alpha</span><span class='op'>(</span>
        colour <span class='op'>=</span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
          <span class='st'>"#00263A"</span>,   <span class='co'># IPUMS Navy</span>
          <span class='st'>"#7A99AC"</span>,   <span class='co'># IPUMS Blue Grey</span>
          <span class='st'>"#BDD2DE"</span>,   <span class='co'># IPUMS Medium Grey</span>
          <span class='st'>"#98579B"</span>,   <span class='co'># PMA Pink</span>
          <span class='st'>"#CCBA72"</span>,   <span class='co'># Tan</span>
          <span class='st'>"#81A88D"</span>    <span class='co'># Green</span>
        <span class='op'>)</span>
      <span class='op'>)</span>,
      na.value <span class='op'>=</span> <span class='st'>"#F0E6F0"</span>
    <span class='op'>)</span>,
    <span class='fu'>scale_color_manual</span><span class='op'>(</span>
      values <span class='op'>=</span> <span class='fu'>alpha</span><span class='op'>(</span>
        alpha <span class='op'>=</span> <span class='fl'>.85</span>,   <span class='co'># .85 creates bars that are 15% transparent</span>
        colour <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
          <span class='st'>"#98579B"</span>,   <span class='co'># PMA Pink</span>
          <span class='st'>"#00263A"</span>    <span class='co'># IPUMS Navy</span>
        <span class='op'>)</span>
      <span class='op'>)</span>
    <span class='op'>)</span>,
    <span class='fu'>labs</span><span class='op'>(</span>
      title <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>toupper</a></span><span class='op'>(</span><span class='va'>title</span><span class='op'>)</span>, 
      subtitle <span class='op'>=</span> <span class='va'>subtitle</span>, 
      x <span class='op'>=</span> <span class='va'>x</span>, 
      y <span class='op'>=</span> <span class='cn'>NULL</span>, 
      fill <span class='op'>=</span> <span class='cn'>NULL</span>
    <span class='op'>)</span>,
    <span class='fu'>guides</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span>, byrow <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<aside>
We discuss custom themes in detail <a href="../2021-08-01-covid-batches/#plot-theme">here</a>
</aside>
<h1 id="sampling-weights">Sampling Weights</h1>
<p>Remember that interviews for the <code>baseline</code> survey were administered in-person, but the <code>covid</code> interviews were administered via telephone. Suppose we ignored the sampling weight <code>CVQWEIGHT</code> completely: how might the requirement of <strong>access to a telephone</strong> bias the combined sample of women who participated in both surveys?</p>
<p>Lets take a look at a few of the demographic variables that appear in both <code>baseline</code> and <code>covid</code>. Well use <code>imap_dfr()</code> build a data frame by iterating over both of the data extracts, and well use <code>summarise()</code> to create the following summary statistics:</p>
<ul>
<li><code>RESPONDENTS</code> - the total number of women in the sample</li>
<li><code>MEAN AGE</code> - the mean age of women in the sample</li>
<li><code>PCT URBAN</code> - the percentage of sampled women living in urban areas</li>
<li><code>PCT NO SCHOOL</code> - the percentage of sampled women who never attended school</li>
<li><code>PCT MARRIED</code> - the percentage of sampled women who are currently married</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>samples_tbl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>baseline</span>, <span class='va'>covid</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>imap_dfr</span><span class='op'>(</span>
    <span class='op'>~</span><span class='va'>.x</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
        SAMPLE <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>.y</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='st'>"baseline"</span>, <span class='st'>"covid"</span><span class='op'>)</span>,
        RESPONDENTS <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/context.html'>n</a></span><span class='op'>(</span><span class='op'>)</span>,
        `MEAN AGE` <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>AGE</span><span class='op'>)</span>,
        `PCT URBAN` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>URBAN</span><span class='op'>)</span>, 
        `PCT NO SCHOOL` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>EDUCATTGEN</span> <span class='op'>&lt;=</span> <span class='fl'>2</span><span class='op'>)</span>, 
        `PCT MARRIED` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>MARSTAT</span> <span class='op'>==</span> <span class='fl'>21</span><span class='op'>)</span> 
      <span class='op'>)</span> 
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
The variable <code>URBAN</code> is not available for the DRC sample, which represents the Kinshasa region. Well assume that all women in Kinshasa live in an urban area in our analysis below.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>samples_tbl</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>digits <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> 
</code></pre>
</div>
<table>
<thead>
<tr>
<th style="text-align:left;">
COUNTRY
</th>
<th style="text-align:left;">
SAMPLE
</th>
<th style="text-align:right;">
RESPONDENTS
</th>
<th style="text-align:right;">
MEAN AGE
</th>
<th style="text-align:right;">
PCT URBAN
</th>
<th style="text-align:right;">
PCT NO SCHOOL
</th>
<th style="text-align:right;">
PCT MARRIED
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
6765
</td>
<td style="text-align:right;">
28.5
</td>
<td style="text-align:right;">
59.9
</td>
<td style="text-align:right;">
64.1
</td>
<td style="text-align:right;">
59.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
3528
</td>
<td style="text-align:right;">
29.7
</td>
<td style="text-align:right;">
74.7
</td>
<td style="text-align:right;">
54.3
</td>
<td style="text-align:right;">
62.0
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC (Kinshasa)
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
2634
</td>
<td style="text-align:right;">
28.3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
8.0
</td>
<td style="text-align:right;">
26.6
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC (Kinshasa)
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
1324
</td>
<td style="text-align:right;">
29.5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
3.3
</td>
<td style="text-align:right;">
34.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
9549
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
35.3
</td>
<td style="text-align:right;">
49.5
</td>
<td style="text-align:right;">
53.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
5986
</td>
<td style="text-align:right;">
31.1
</td>
<td style="text-align:right;">
38.2
</td>
<td style="text-align:right;">
45.4
</td>
<td style="text-align:right;">
62.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria (Lagos/Kano)
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
2627
</td>
<td style="text-align:right;">
29.5
</td>
<td style="text-align:right;">
76.4
</td>
<td style="text-align:right;">
32.3
</td>
<td style="text-align:right;">
62.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria (Lagos/Kano)
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
1346
</td>
<td style="text-align:right;">
31.4
</td>
<td style="text-align:right;">
87.8
</td>
<td style="text-align:right;">
16.3
</td>
<td style="text-align:right;">
63.5
</td>
</tr>
</tbody>
</table>
</div>
<p>Comparing the two samples for each country, we see that the <code>covid</code> follow up represents a sub-sample of the baseline participants that is generally <strong>a bit older</strong> (adjusting for the passage of time), <strong>more urban</strong>, <strong>more educated</strong>, and are <strong>more likely to be currently married</strong>. If we built a multinomial model <em>without</em> sample weights, our predictions would reflect these biases as well.</p>
<p>Fortunately, the variable <code>CVQWEIGHT</code> corrects the baseline sample weight <code>FQWEIGHT</code> for predicted telephone access and other sources of loss to follow up. If we use the correct weights for each sample in our <code>imap_dfr()</code> function above, we should produce similar estimates for each samples <strong>target population</strong>:</p>
<aside>
Read more about the construction of <code>CVQWEIGHT</code> <a href="https://pma.ipums.org/pma/resources/documentation/COVID_Survey_Weight_Construction_Memo.pdf">here</a>.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>populations_tbl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>baseline</span>, <span class='va'>covid</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>imap_dfr</span><span class='op'>(</span><span class='op'>~</span><span class='op'>{</span>
    <span class='kw'>if</span><span class='op'>(</span><span class='st'>"FQWEIGHT"</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>.x</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
      <span class='va'>wt</span> <span class='op'>&lt;-</span> <span class='st'>"FQWEIGHT"</span>
    <span class='op'>}</span> <span class='kw'>else</span> <span class='op'>{</span>
      <span class='va'>wt</span> <span class='op'>&lt;-</span> <span class='st'>"CVQWEIGHT"</span>
    <span class='op'>}</span>
    <span class='va'>.x</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>weights <span class='op'>=</span> <span class='op'>!</span><span class='op'>!</span><span class='va'>wt</span>, ids <span class='op'>=</span> <span class='va'>EAID</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>
        SAMPLE <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>.y</span> <span class='op'>==</span> <span class='fl'>1</span>, <span class='st'>"baseline"</span>, <span class='st'>"covid"</span><span class='op'>)</span>,
        `MEAN AGE` <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>AGE</span>, vartype <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>,
        `PCT URBAN` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>URBAN</span>, vartype <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>, 
        `PCT NO SCHOOL` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>EDUCATTGEN</span> <span class='op'>==</span> <span class='fl'>1</span>, vartype <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>, 
        `PCT MARRIED` <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span><span class='va'>MARSTAT</span> <span class='op'>==</span> <span class='fl'>21</span>, vartype <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span>   
      <span class='op'>)</span> 
  <span class='op'>}</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<aside>
<strong>Tip:</strong> If you would like to produce confidence intervals for each of these population-level estimates, use <code>vartype == "ci"</code>. Note that <code>EAID</code> has no impact on the point estimates weve shown.
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>populations_tbl</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>digits <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> 
</code></pre>
</div>
<table>
<thead>
<tr>
<th style="text-align:left;">
COUNTRY
</th>
<th style="text-align:left;">
SAMPLE
</th>
<th style="text-align:right;">
MEAN AGE
</th>
<th style="text-align:right;">
PCT URBAN
</th>
<th style="text-align:right;">
PCT NO SCHOOL
</th>
<th style="text-align:right;">
PCT MARRIED
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
28.9
</td>
<td style="text-align:right;">
22.8
</td>
<td style="text-align:right;">
59.9
</td>
<td style="text-align:right;">
68.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Burkina Faso
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
27.9
</td>
<td style="text-align:right;">
21.4
</td>
<td style="text-align:right;">
55.1
</td>
<td style="text-align:right;">
68.9
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC (Kinshasa)
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
28.3
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
27.0
</td>
</tr>
<tr>
<td style="text-align:left;">
DRC (Kinshasa)
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
28.9
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
0.4
</td>
<td style="text-align:right;">
31.4
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
28.8
</td>
<td style="text-align:right;">
30.2
</td>
<td style="text-align:right;">
4.5
</td>
<td style="text-align:right;">
53.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Kenya
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
28.9
</td>
<td style="text-align:right;">
27.5
</td>
<td style="text-align:right;">
1.9
</td>
<td style="text-align:right;">
54.3
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria (Lagos/Kano)
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
29.7
</td>
<td style="text-align:right;">
72.1
</td>
<td style="text-align:right;">
22.6
</td>
<td style="text-align:right;">
64.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Nigeria (Lagos/Kano)
</td>
<td style="text-align:left;">
covid
</td>
<td style="text-align:right;">
30.4
</td>
<td style="text-align:right;">
81.9
</td>
<td style="text-align:right;">
9.8
</td>
<td style="text-align:right;">
63.3
</td>
</tr>
</tbody>
</table>
</div>
<p>Here, weve used <code>as_survey_design()</code> to specify the correct weight <code>wt</code> in each iteration of <code>imap_dfr()</code>. Then, we used <code>survey_mean()</code> to estimate the mean / proportion for each samples target population. Although you might observe some differences between the point estimates derived from <code>baseline</code> and <code>covid</code>, the <em>systematic</em> biases we identified in the samples are no longer present. This will be easier to see in a <a href="../2021-08-01-covid-batches/#lollipop-chart">faceted lollipop plot</a> where we chart both summary tables side-by-side.</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='va'>populations_tbl</span> <span class='op'>%&gt;%</span>  
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>TBL <span class='op'>=</span> <span class='st'>"weighted"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span>
    <span class='va'>samples_tbl</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>RESPONDENTS</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>TBL <span class='op'>=</span> <span class='st'>"unweighted"</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>-</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>COUNTRY</span>, <span class='va'>SAMPLE</span>, <span class='va'>TBL</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>value</span>, y <span class='op'>=</span> <span class='va'>TBL</span>, color <span class='op'>=</span> <span class='va'>SAMPLE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>facet_grid</span><span class='op'>(</span>
    rows <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>COUNTRY</span><span class='op'>)</span>, 
    cols <span class='op'>=</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise_all.html'>vars</a></span><span class='op'>(</span><span class='va'>name</span><span class='op'>)</span>,
    scale <span class='op'>=</span> <span class='st'>"free_x"</span>,
    as.table <span class='op'>=</span> <span class='cn'>TRUE</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_line</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>TBL</span><span class='op'>)</span>, alpha <span class='op'>=</span> <span class='fl'>.5</span>, color <span class='op'>=</span> <span class='st'>"#000000"</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_pma</span><span class='op'>(</span><span class='st'>"Sample design: weighted vs unweighted"</span>, legend.position <span class='op'>=</span> <span class='st'>"top"</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="covid-analysis_files/figure-html5/unnamed-chunk-11-1.png" width="1152" /></p>
</div>
<p>In nearly every case, the gap between <code>baseline</code> and <code>covid</code> is narrower for the <code>weighted</code> population estimates than it is for the <code>unweighted</code> sample statistics.</p>
<p>For example, consider the summary statistic <code>PCT URBAN</code>. 59.9% of the women in the Burkina Faso <code>baseline</code> sample reside in urban areas, compared to 74.7% of women in the <code>covid</code> sample. Thats a 14.8% difference! With weights applied, we use <code>baseline</code> to estimate that only 22.8% of women in Burkina Faso actually live in urban areas; compare this to the 21.4% estimate produced from <code>covid</code>. The difference between the two population estimates is much smaller - just 1.4%.</p>
<h1 id="change-in-purchasing-power">Change in purchasing power</h1>
<p>Well now focus our attention only on the respondents who participated in both <code>baseline</code> and <code>covid</code> as we explore changes that occurred during the intervening months. Well create a <code>merged</code> dataset that contains <em>one row per person</em> and drops anyone who didnt participate in the <code>covid</code> survey. We should also <em>preserve duplicate variables</em> - or variables that appear in both extracts; well need to change their names so that its easy to determine which version came from which survey.</p>
<p>Either <code>left_join()</code> or <code>right_join()</code> from the <a href="https://dplyr.tidyverse.org/reference/join.html">dplyr</a> package can be used here; the only difference is that <code>left_join()</code> discards rows from the data provided to y, while <code>right_join()</code> discards rows from the data provided to x (we could put <code>baseline</code> in either position). Well use <code>left_join()</code>.</p>
<p>Each participant in <code>baseline</code> will have a unique identification code in <code>FQINSTID</code> that appears again in <code>covid</code>. So, well tell <code>left_join()</code> to merge rows connected by the same <code>FQINSTID</code> with <code>by = "FQINSTID"</code></p>
<p>Finally, well use the <code>suffix</code> argument to handle variables that appear in both extracts. For example, <code>AGE</code> from <code>covid</code> will be renamed <code>AGE_CV</code>, while <code>AGE</code> from <code>baseline</code> will be renamed <code>AGE_BASE</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>merged</span> <span class='op'>&lt;-</span> <span class='fu'>left_join</span><span class='op'>(</span>
  x <span class='op'>=</span> <span class='va'>covid</span>,
  y <span class='op'>=</span> <span class='va'>baseline</span>,
  by <span class='op'>=</span> <span class='st'>"FQINSTID"</span>,
  suffix <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"_CV"</span>, <span class='st'>"_BASE"</span><span class='op'>)</span>
<span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>The variables well use to construct our models dependent variable - <code>HHDECDAILY</code> and <code>CVBUYDECIDER</code> - will now appear together in the same row for each woman who participated in both surveys. For both variables, the universe is women who were currently married or living with male partner. Before we get started, lets take a quick look at an <a href="../2021-05-24-migration-data-analysis/#visualizing-migration-alluvial-plots">alluvial plot</a> showing the general shifts from one variable to the other:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='va'>merged</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>select</a></span><span class='op'>(</span><span class='va'>FQINSTID</span>, <span class='va'>HHDECDAILY</span>, <span class='va'>CVBUYDECIDER</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span><span class='op'>!</span><span class='va'>FQINSTID</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    name <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span><span class='va'>name</span> <span class='op'>==</span> <span class='st'>"HHDECDAILY"</span>, <span class='st'>"Before COVID-19"</span>, <span class='st'>"Summer 2020"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>fct_rev</span><span class='op'>(</span><span class='op'>)</span>,
    value <span class='op'>=</span> <span class='va'>value</span> <span class='op'>%&gt;%</span> 
      <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>fct_recode</span><span class='op'>(</span>
        <span class='st'>"Resdponent"</span> <span class='op'>=</span> <span class='st'>"1"</span>, <span class='st'>"Husband/partner"</span> <span class='op'>=</span> <span class='st'>"2"</span>, <span class='st'>"Joint"</span> <span class='op'>=</span> <span class='st'>"3"</span>,
        <span class='st'>"Someone else"</span> <span class='op'>=</span> <span class='st'>"4"</span>, <span class='st'>"No response"</span> <span class='op'>=</span> <span class='st'>"98"</span>, <span class='st'>"Not partnered"</span> <span class='op'>=</span>  <span class='st'>"99"</span>
      <span class='op'>)</span> <span class='op'>%&gt;%</span> 
      <span class='fu'>fct_rev</span><span class='op'>(</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='va'>name</span>,
    stratum <span class='op'>=</span> <span class='va'>value</span>,
    fill <span class='op'>=</span> <span class='va'>value</span>,
    alluvium <span class='op'>=</span> <span class='va'>FQINSTID</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='http://corybrunson.github.io/ggalluvial/reference/geom_stratum.html'>geom_stratum</a></span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.7</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='http://corybrunson.github.io/ggalluvial/reference/geom_flow.html'>geom_flow</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>coord_flip</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_pma</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Who usually makes decisions about \n household purchases for daily needs?"</span>,
    subtitle <span class='op'>=</span> <span class='st'>"Female respondents to the PMA baseline and COVID-19 surveys"</span>,
    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>
  <span class='op'>)</span> 
</code></pre>
</div>
<p><img src="covid-analysis_files/figure-html5/unnamed-chunk-13-1.png" width="1152" /></p>
</div>
<p>Here, we see that a majority of women who independently made purchasing decisions at <code>baseline</code> began either making decisions jointly or deferred to their husband/partner or someone else after COVID-19 restrictions began. At the same time, a sizable portion of the women who made decisions jointly at <code>baseline</code> no longer reported any role in the <code>covid</code> survey. Well say that all of these women have Less purchasing power when we create our dependent variable.</p>
<p>Some women experienced change in the opposite direction: these include women who gained some authority after having none at <code>baseline</code>, and also women who previously made decisions jointly, but now bear bear full responsibility. Well say that these women have More purchasing power.</p>
<p>Finally, all other women will be said to have the Same level of purchasing power <em>unless</em> either variable contains No response or missing or NIU (not in universe). In the latter case, well use the value <code>NA</code>. This means we will be analyzing a sample of women who were married or living with a male partner both before and during COVID-19 restrictions.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>merged</span> <span class='op'>&lt;-</span> <span class='va'>merged</span> <span class='op'>%&gt;%</span> 
   <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>PURCHASE_PWR <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
     <span class='fu'>case_when</span><span class='op'>(</span>
       <span class='va'>HHDECDAILY</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>%in%</span> <span class='fl'>2</span><span class='op'>:</span><span class='fl'>4</span> <span class='op'>~</span> <span class='st'>"Less"</span>,
       <span class='va'>HHDECDAILY</span> <span class='op'>==</span> <span class='fl'>3</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>4</span><span class='op'>)</span> <span class='op'>~</span>  <span class='st'>"Less"</span>,
       <span class='va'>HHDECDAILY</span> <span class='op'>==</span> <span class='fl'>2</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"More"</span>,
       <span class='va'>HHDECDAILY</span> <span class='op'>==</span> <span class='fl'>3</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='st'>"More"</span>,
       <span class='va'>HHDECDAILY</span> <span class='op'>==</span> <span class='fl'>4</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>3</span><span class='op'>)</span> <span class='op'>~</span> <span class='st'>"More"</span>,
       <span class='va'>HHDECDAILY</span> <span class='op'>&lt;</span> <span class='fl'>90</span> <span class='op'>&amp;</span> <span class='va'>CVBUYDECIDER</span> <span class='op'>&lt;</span> <span class='fl'>90</span> <span class='op'>~</span> <span class='st'>"Same"</span>
     <span class='op'>)</span>,
     levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span> <span class='st'>"Less"</span>, <span class='st'>"Same"</span>, <span class='st'>"More"</span><span class='op'>)</span>
   <span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<h1 id="multinomial-modeling">Multinomial modeling</h1>
<p>Lets now see what our derived variable <code>PURCHASE_PWR</code> can tell us about each samples <strong>target population</strong>. As shown above, well again specify the sampling weight <code>CVQWEIGHT</code> and the cluster IDs - this time using the COVID-19 version in <code>EAID_CV</code> - as survey design information; well then pass this information to a <code>survey_mean()</code> summary function to produce point-estimates and a cluster-robust 95% confidence interval for each level of <code>PURCHASE_POWER</code>. Well plot these estimates in a <a href="../2021-08-01-covid-batches/#bar-charts">grouped bar chart</a>, omitting the percentage of women who are not married / cohabitating with a partner.</p>
<aside>
Keep in mind: only the Burkina Faso and Kenya samples are <strong>nationally representative</strong>. The DRC and Nigeria samples represent <strong>sub-national regions</strong>.
</aside>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='va'>merged</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>
    weights <span class='op'>=</span> <span class='va'>CVQWEIGHT</span>,
    ids <span class='op'>=</span> <span class='va'>EAID_CV</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>COUNTRY_BASE</span>, <span class='va'>PURCHASE_PWR</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/summarise.html'>summarise</a></span><span class='op'>(</span>est <span class='op'>=</span> <span class='fl'>100</span> <span class='op'>*</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/survey_mean.html'>survey_mean</a></span><span class='op'>(</span>vartype <span class='op'>=</span> <span class='st'>"ci"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>filter</a></span><span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span><span class='op'>(</span><span class='va'>PURCHASE_PWR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>COUNTRY_BASE</span>, y <span class='op'>=</span> <span class='va'>est</span>, fill <span class='op'>=</span> <span class='va'>PURCHASE_PWR</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_bar</span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>.6</span>, position <span class='op'>=</span> <span class='fu'>position_dodge</span><span class='op'>(</span><span class='fl'>0.6</span><span class='op'>)</span>, stat <span class='op'>=</span> <span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_errorbar</span><span class='op'>(</span>
    <span class='fu'>aes</span><span class='op'>(</span>ymin <span class='op'>=</span> <span class='va'>est_low</span>, ymax <span class='op'>=</span> <span class='va'>est_upp</span><span class='op'>)</span>,
    width <span class='op'>=</span> <span class='fl'>0.2</span>,
    position <span class='op'>=</span> <span class='fu'>position_dodge</span><span class='op'>(</span><span class='fl'>0.6</span><span class='op'>)</span>,
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_pma</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>"Net change in purchasing power for daily needs"</span>,
    subtitle <span class='op'>=</span> <span class='st'>"Estimated percentages for populations of women age 15-49"</span>,
    legend.position <span class='op'>=</span> <span class='st'>"bottom"</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>coord_flip</span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
<p><img src="covid-analysis_files/figure-html5/unnamed-chunk-15-1.png" width="1152" /></p>
</div>
<p>The percentage of women in each population who gained More purchasing power after COVID-19 restrictions began is <em>significantly lower</em> than the percentage of women who maintained the Same or experienced Less purchasing power (we know this because the 95% confidence intervals do not overlap). The comparison between Same and Less is not so clear: while the point estimates suggest that there <em>may</em> be fewer women with Less purchasing power, the difference is not statistically significant (except in Kenya, where the two confidence intervals do not overlap).</p>
<p>To demonstrate a multinomial model for these outcomes, well select a set of variables that describe demographic features and economic circumstances for each woman. As a reminder: for variables that appeared in both <code>baseline</code> and <code>covid</code>, well need to specify which to include in our model by appending the suffix <code>_BASE</code> or <code>_CV</code> - for the most part, well use the <code>baseline</code> version. Well include these covariates (modifying / recoding as needed):</p>
<ul>
<li><a href="https://pma.ipums.org/pma-action/variables/AGE">AGE_BASE</a> - age at baseline</li>
<li><a href="https://pma.ipums.org/pma-action/variables/URBAN">URBAN_BASE</a> - lived in an urban area at baseline: TRUE or FALSE</li>
<li><a href="https://pma.ipums.org/pma-action/variables/WEALTHT">WEALTHT</a> - wealth score tertile: Highest, Middle, Lowest (reference group)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/RELIGION">RELIGION</a> - religion <em>of the household head</em> recoded as Muslim, Christian, Other (reference group)</li>
<li><a href="https://pma.ipums.org/pma-action/variables/PARTNERECON">PARTNERECON</a> indicates whether married / partnered women said on the <code>covid</code> survey that there were currently economically reliant on their husband / partner for basic needs: TRUE or FALSE</li>
<li><a href="https://pma.ipums.org/pma-action/variables/WORKWK">WORKWK</a> indicates whether women indicated on the <code>baseline</code> survey that she had done any work outside the home in the past week: TRUE or FALSE</li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>merged</span> <span class='op'>&lt;-</span> <span class='va'>merged</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    RELIGION <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
      <span class='fu'>case_when</span><span class='op'>(</span>
        <span class='va'>RELIGION</span> <span class='op'>==</span> <span class='fl'>100</span> <span class='op'>~</span> <span class='st'>"Muslim"</span>,
        <span class='va'>RELIGION</span> <span class='op'>%in%</span> <span class='fl'>200</span><span class='op'>:</span><span class='fl'>300</span> <span class='op'>~</span> <span class='st'>"Christian"</span>,
        <span class='va'>RELIGION</span> <span class='op'>&lt;</span> <span class='fl'>990</span> <span class='op'>~</span> <span class='st'>"Other"</span>
      <span class='op'>)</span>,
      levels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Other"</span>, <span class='st'>"Muslim"</span>, <span class='st'>"Christian"</span><span class='op'>)</span>
    <span class='op'>)</span>,
    WEALTHT <span class='op'>=</span> <span class='fu'><a href='https://forcats.tidyverse.org/reference/as_factor.html'>as_factor</a></span><span class='op'>(</span><span class='va'>WEALTHT</span><span class='op'>)</span>,
    URBAN_BASE <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>COUNTRY_BASE</span> <span class='op'>==</span> <span class='st'>"DRC (Kinshasa)"</span> <span class='op'>~</span> <span class='cn'>TRUE</span>,
      <span class='va'>URBAN_BASE</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='cn'>TRUE</span>,
      <span class='va'>URBAN_BASE</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span>,
    <span class='fu'><a href='https://dplyr.tidyverse.org/reference/across.html'>across</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>PARTNERECON</span>, <span class='va'>WORKWK</span><span class='op'>)</span>, <span class='op'>~</span><span class='fu'>case_when</span><span class='op'>(</span>
      <span class='va'>.x</span> <span class='op'>==</span> <span class='fl'>1</span> <span class='op'>~</span> <span class='cn'>TRUE</span>,
      <span class='va'>.x</span> <span class='op'>==</span> <span class='fl'>0</span> <span class='op'>~</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>The <code>svyVGAM</code> package can interpret the very same call to <code>as_survey_design()</code> shown above. Well use the generic modeling function <code>svy_vglm()</code> to build our model; it looks similar to the <code>svyglm</code> function weve used to build linear and binary logit models elsewhere, except that the argument <code>family</code> takes a function describing the type of model we want to fit. Use <code>multinomial(refLevel = "Same")</code> to specify a multinomial model with Same as a reference group:</p>
<aside>
See <a href="https://cran.r-project.org/web/packages/svyVGAM/svyVGAM.pdf">package documentation</a> for other supported modeling functions
</aside>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>pma_model</span> <span class='op'>&lt;-</span> <span class='va'>merged</span> <span class='op'>%&gt;%</span>  
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_survey_design.html'>as_survey_design</a></span><span class='op'>(</span>
    weights <span class='op'>=</span> <span class='va'>CVQWEIGHT</span>,
    id <span class='op'>=</span> <span class='va'>EAID_CV</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/svyVGAM/man/svy_vglm.html'>svy_vglm</a></span><span class='op'>(</span>
    formula <span class='op'>=</span> <span class='va'>PURCHASE_PWR</span> <span class='op'>~</span> 
      <span class='va'>AGE_BASE</span> <span class='op'>+</span>
      <span class='va'>RELIGION</span> <span class='op'>+</span>
      <span class='va'>WEALTHT</span> <span class='op'>+</span>
      <span class='va'>URBAN_BASE</span> <span class='op'>+</span>
      <span class='va'>PARTNERECON</span> <span class='op'>+</span> 
      <span class='va'>WORKWK</span> <span class='op'>+</span> 
      <span class='va'>COUNTRY_BASE</span>,
    design <span class='op'>=</span> <span class='va'>.</span>, 
    family <span class='op'>=</span> <span class='fu'>multinomial</span><span class='op'>(</span>refLevel <span class='op'>=</span> <span class='st'>"Same"</span><span class='op'>)</span>
  <span class='op'>)</span> 
</code></pre>
</div>
</div>
<p>One drawback here is that the output of a model created by <code>svyVGAM</code> (or by the <code>VGAM</code> package) cannot be handled by <a href="https://broom.tidymodels.org/">broom::tidy()</a>, which we normally use to clean and standardize model output. Fortunately, <code>broom</code> contains a non-exported function thats capable of handling something similar: the model output created by <code>svyglm()</code> from the sibling <code>survey</code> package! Youll find it in the <code>broom</code> namespace if you use <code>:::</code> like so:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='fu'>broom</span><span class='fu'>:::</span><span class='va'><a href='https://broom.tidymodels.org/reference/tidy.svyglm.html'>tidy.svyglm</a></span>
</code></pre>
</div>
<pre><code>function (x, conf.int = FALSE, conf.level = 0.95, exponentiate = FALSE, 
    ...) 
{
    ret &lt;- as_tibble(summary(x)$coefficients, rownames = &quot;term&quot;)
    colnames(ret) &lt;- c(&quot;term&quot;, &quot;estimate&quot;, &quot;std.error&quot;, &quot;statistic&quot;, 
        &quot;p.value&quot;)
    coefs &lt;- tibble::enframe(stats::coef(x), name = &quot;term&quot;, value = &quot;estimate&quot;)
    ret &lt;- left_join(coefs, ret, by = c(&quot;term&quot;, &quot;estimate&quot;))
    if (conf.int) {
        ci &lt;- broom_confint_terms(x, level = conf.level, ...)
        ret &lt;- dplyr::left_join(ret, ci, by = &quot;term&quot;)
    }
    if (exponentiate) {
        ret &lt;- exponentiate(ret)
    }
    ret
}
&lt;bytecode: 0x7fdb364ee358&gt;
&lt;environment: namespace:broom&gt;</code></pre>
</div>
<p>Well modify this function a bit, <a href="https://www.tidymodels.org/learn/develop/broom/">creating our own tidy method</a> <code>tidy.svyVGAM()</code> (you may need to make modifications for general use):</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>tidy.svyVGAM</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span>
  <span class='va'>x</span>, 
  <span class='va'>conf.int</span> <span class='op'>=</span> <span class='cn'>FALSE</span>, 
  <span class='va'>conf.level</span> <span class='op'>=</span> <span class='fl'>0.95</span>,
  <span class='va'>exponentiate</span> <span class='op'>=</span> <span class='cn'>FALSE</span>, 
  <span class='va'>...</span>
<span class='op'>)</span><span class='op'>{</span>
  <span class='co'># Replace `summary(x)$coefficients` with `summary(x)$coeftable`</span>
  <span class='va'>ret</span> <span class='op'>&lt;-</span> <span class='fu'><a href='http://gdfe.co/srvyr/reference/as_tibble.html'>as_tibble</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>$</span><span class='va'>coeftable</span>, rownames <span class='op'>=</span> <span class='st'>"term"</span><span class='op'>)</span>
  
  <span class='co'># All of this stays the same:</span>
  <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>ret</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"term"</span>, <span class='st'>"estimate"</span>, <span class='st'>"std.error"</span>, <span class='st'>"statistic"</span>, <span class='st'>"p.value"</span><span class='op'>)</span>
  <span class='va'>coefs</span> <span class='op'>&lt;-</span> <span class='fu'>tibble</span><span class='fu'>::</span><span class='fu'><a href='https://tibble.tidyverse.org/reference/enframe.html'>enframe</a></span><span class='op'>(</span><span class='fu'>stats</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>, name <span class='op'>=</span> <span class='st'>"term"</span>, value <span class='op'>=</span> <span class='st'>"estimate"</span><span class='op'>)</span>
  <span class='va'>ret</span> <span class='op'>&lt;-</span> <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>coefs</span>, <span class='va'>ret</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"term"</span>, <span class='st'>"estimate"</span><span class='op'>)</span><span class='op'>)</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>conf.int</span><span class='op'>)</span><span class='op'>{</span>
    <span class='va'>ci</span> <span class='op'>&lt;-</span> <span class='fu'>broom</span><span class='fu'>:::</span><span class='fu'>broom_confint_terms</span><span class='op'>(</span><span class='va'>x</span>, level <span class='op'>=</span> <span class='va'>conf.level</span>, <span class='va'>...</span><span class='op'>)</span>
    <span class='va'>ret</span> <span class='op'>&lt;-</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>ret</span>, <span class='va'>ci</span>, by <span class='op'>=</span> <span class='st'>"term"</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='kw'>if</span> <span class='op'>(</span><span class='va'>exponentiate</span><span class='op'>)</span><span class='op'>{</span><span class='va'>ret</span> <span class='op'>&lt;-</span> <span class='fu'>broom</span><span class='fu'>:::</span><span class='fu'>exponentiate</span><span class='op'>(</span><span class='va'>ret</span><span class='op'>)</span><span class='op'>}</span>
  
  <span class='co'># This part only works for the multinomial case, and only if your covariates</span>
  <span class='co'># have no ":" in their names - NOT FOR GENERAL USE</span>
  <span class='va'>ret</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>separate</span><span class='op'>(</span><span class='va'>term</span>, into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"term"</span>, <span class='st'>"y.level"</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='st'>":"</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>y.level</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>relocate</span><span class='op'>(</span><span class='va'>y.level</span>, .before <span class='op'>=</span> <span class='va'>term</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</div>
<p>Now, lets look at our model results. Well exponentiate our coefficients, add significance stars, and label each <code>y.level</code> manually to make this table easier to read:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>tidy_pma_model</span> <span class='op'>&lt;-</span> <span class='fu'>tidy.svyVGAM</span><span class='op'>(</span><span class='va'>pma_model</span>, exponentiate <span class='op'>=</span> <span class='cn'>TRUE</span>, conf.int <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre><code><span class='va'>tidy_pma_model</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>y.level</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>rename</a></span><span class='op'>(</span>PURCHASE_PWR <span class='op'>=</span> <span class='va'>term</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>sig <span class='op'>=</span> <span class='fu'>case_when</span><span class='op'>(</span>
    <span class='va'>p.value</span> <span class='op'>&lt;</span> <span class='fl'>0.001</span> <span class='op'>~</span> <span class='st'>"\\*\\*\\*"</span>,
    <span class='va'>p.value</span> <span class='op'>&lt;</span> <span class='fl'>0.01</span> <span class='op'>~</span> <span class='st'>"\\*\\*"</span>,
    <span class='va'>p.value</span> <span class='op'>&lt;</span> <span class='fl'>0.05</span> <span class='op'>~</span> <span class='st'>"\\*"</span>,
    <span class='cn'>T</span> <span class='op'>~</span> <span class='st'>""</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/kbl.html'>kbl</a></span><span class='op'>(</span>digits <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/group_rows.html'>pack_rows</a></span><span class='op'>(</span><span class='st'>"Less"</span>, <span class='fl'>1</span>, <span class='fl'>12</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/kableExtra/man/group_rows.html'>pack_rows</a></span><span class='op'>(</span><span class='st'>"More"</span>, <span class='fl'>13</span>, <span class='fl'>24</span><span class='op'>)</span>
</code></pre>
</div>
<table>
<thead>
<tr>
<th style="text-align:left;">
PURCHASE_PWR
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
<th style="text-align:right;">
conf.low
</th>
<th style="text-align:right;">
conf.high
</th>
<th style="text-align:left;">
sig
</th>
</tr>
</thead>
<tbody>
<tr grouplength="12">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>Less</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
(Intercept)
</td>
<td style="text-align:right;">
1.102
</td>
<td style="text-align:right;">
0.302
</td>
<td style="text-align:right;">
0.322
</td>
<td style="text-align:right;">
0.747
</td>
<td style="text-align:right;">
0.609
</td>
<td style="text-align:right;">
1.994
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
AGE_BASE
</td>
<td style="text-align:right;">
1.001
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.100
</td>
<td style="text-align:right;">
0.920
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
1.011
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
RELIGIONMuslim
</td>
<td style="text-align:right;">
0.602
</td>
<td style="text-align:right;">
0.212
</td>
<td style="text-align:right;">
-2.398
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.398
</td>
<td style="text-align:right;">
0.912
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
RELIGIONChristian
</td>
<td style="text-align:right;">
0.823
</td>
<td style="text-align:right;">
0.149
</td>
<td style="text-align:right;">
-1.312
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
0.615
</td>
<td style="text-align:right;">
1.101
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WEALTHTMiddle tertile
</td>
<td style="text-align:right;">
0.875
</td>
<td style="text-align:right;">
0.107
</td>
<td style="text-align:right;">
-1.244
</td>
<td style="text-align:right;">
0.214
</td>
<td style="text-align:right;">
0.709
</td>
<td style="text-align:right;">
1.080
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WEALTHTHighest tertile
</td>
<td style="text-align:right;">
0.939
</td>
<td style="text-align:right;">
0.121
</td>
<td style="text-align:right;">
-0.523
</td>
<td style="text-align:right;">
0.601
</td>
<td style="text-align:right;">
0.741
</td>
<td style="text-align:right;">
1.189
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
URBAN_BASETRUE
</td>
<td style="text-align:right;">
1.176
</td>
<td style="text-align:right;">
0.116
</td>
<td style="text-align:right;">
1.398
</td>
<td style="text-align:right;">
0.162
</td>
<td style="text-align:right;">
0.937
</td>
<td style="text-align:right;">
1.476
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
PARTNERECONTRUE
</td>
<td style="text-align:right;">
1.465
</td>
<td style="text-align:right;">
0.094
</td>
<td style="text-align:right;">
4.055
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
1.218
</td>
<td style="text-align:right;">
1.762
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WORKWKTRUE
</td>
<td style="text-align:right;">
1.158
</td>
<td style="text-align:right;">
0.084
</td>
<td style="text-align:right;">
1.756
</td>
<td style="text-align:right;">
0.079
</td>
<td style="text-align:right;">
0.983
</td>
<td style="text-align:right;">
1.365
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASEDRC (Kinshasa)
</td>
<td style="text-align:right;">
0.585
</td>
<td style="text-align:right;">
0.221
</td>
<td style="text-align:right;">
-2.429
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.380
</td>
<td style="text-align:right;">
0.902
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASEKenya
</td>
<td style="text-align:right;">
0.676
</td>
<td style="text-align:right;">
0.156
</td>
<td style="text-align:right;">
-2.503
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
0.497
</td>
<td style="text-align:right;">
0.919
</td>
<td style="text-align:left;">
*
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASENigeria (Lagos/Kano)
</td>
<td style="text-align:right;">
0.763
</td>
<td style="text-align:right;">
0.201
</td>
<td style="text-align:right;">
-1.348
</td>
<td style="text-align:right;">
0.178
</td>
<td style="text-align:right;">
0.514
</td>
<td style="text-align:right;">
1.131
</td>
<td style="text-align:left;">
</td>
</tr>
<tr grouplength="12">
<td colspan="8" style="border-bottom: 1px solid;">
<strong>More</strong>
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
(Intercept)
</td>
<td style="text-align:right;">
0.677
</td>
<td style="text-align:right;">
0.306
</td>
<td style="text-align:right;">
-1.277
</td>
<td style="text-align:right;">
0.201
</td>
<td style="text-align:right;">
0.372
</td>
<td style="text-align:right;">
1.232
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
AGE_BASE
</td>
<td style="text-align:right;">
0.991
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
-1.451
</td>
<td style="text-align:right;">
0.147
</td>
<td style="text-align:right;">
0.980
</td>
<td style="text-align:right;">
1.003
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
RELIGIONMuslim
</td>
<td style="text-align:right;">
1.525
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
1.760
</td>
<td style="text-align:right;">
0.078
</td>
<td style="text-align:right;">
0.953
</td>
<td style="text-align:right;">
2.439
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
RELIGIONChristian
</td>
<td style="text-align:right;">
1.069
</td>
<td style="text-align:right;">
0.207
</td>
<td style="text-align:right;">
0.321
</td>
<td style="text-align:right;">
0.749
</td>
<td style="text-align:right;">
0.712
</td>
<td style="text-align:right;">
1.603
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WEALTHTMiddle tertile
</td>
<td style="text-align:right;">
0.941
</td>
<td style="text-align:right;">
0.122
</td>
<td style="text-align:right;">
-0.494
</td>
<td style="text-align:right;">
0.621
</td>
<td style="text-align:right;">
0.741
</td>
<td style="text-align:right;">
1.196
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WEALTHTHighest tertile
</td>
<td style="text-align:right;">
0.773
</td>
<td style="text-align:right;">
0.140
</td>
<td style="text-align:right;">
-1.848
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.588
</td>
<td style="text-align:right;">
1.016
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
URBAN_BASETRUE
</td>
<td style="text-align:right;">
1.266
</td>
<td style="text-align:right;">
0.129
</td>
<td style="text-align:right;">
1.824
</td>
<td style="text-align:right;">
0.068
</td>
<td style="text-align:right;">
0.983
</td>
<td style="text-align:right;">
1.631
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
PARTNERECONTRUE
</td>
<td style="text-align:right;">
0.693
</td>
<td style="text-align:right;">
0.107
</td>
<td style="text-align:right;">
-3.420
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.562
</td>
<td style="text-align:right;">
0.855
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
WORKWKTRUE
</td>
<td style="text-align:right;">
0.638
</td>
<td style="text-align:right;">
0.107
</td>
<td style="text-align:right;">
-4.209
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
0.787
</td>
<td style="text-align:left;">
***
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASEDRC (Kinshasa)
</td>
<td style="text-align:right;">
0.739
</td>
<td style="text-align:right;">
0.233
</td>
<td style="text-align:right;">
-1.297
</td>
<td style="text-align:right;">
0.195
</td>
<td style="text-align:right;">
0.468
</td>
<td style="text-align:right;">
1.167
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASEKenya
</td>
<td style="text-align:right;">
0.901
</td>
<td style="text-align:right;">
0.149
</td>
<td style="text-align:right;">
-0.704
</td>
<td style="text-align:right;">
0.482
</td>
<td style="text-align:right;">
0.673
</td>
<td style="text-align:right;">
1.205
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;padding-left: 2em;" indentlevel="1">
COUNTRY_BASENigeria (Lagos/Kano)
</td>
<td style="text-align:right;">
0.918
</td>
<td style="text-align:right;">
0.203
</td>
<td style="text-align:right;">
-0.420
</td>
<td style="text-align:right;">
0.675
</td>
<td style="text-align:right;">
0.617
</td>
<td style="text-align:right;">
1.367
</td>
<td style="text-align:left;">
</td>
</tr>
</tbody>
</table>
</div>
<p>Once youve got the model output in a <code>tidy</code> format, you can also pass it to a <code>tidyverse</code> aligned graphing function, like the popular <a href="https://cran.r-project.org/web/packages/dotwhisker/vignettes/dotwhisker-vignette.html">dwplot</a> from <code>dotwhisker</code>:</p>
<div class="layout-chunk" data-layout="l-page">
<div class="sourceCode">
<pre><code><span class='va'>tidy_pma_model</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='http://gdfe.co/srvyr/reference/dplyr_single.html'>mutate</a></span><span class='op'>(</span>
    model <span class='op'>=</span> <span class='fu'>if_else</span><span class='op'>(</span>
      <span class='va'>y.level</span> <span class='op'>==</span> <span class='fl'>1</span>, 
      <span class='st'>"Less Purchasing Power"</span>,
      <span class='st'>"More Purchasing Power"</span>, 
    <span class='op'>)</span>,
    sig <span class='op'>=</span> <span class='fu'>gtools</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/gtools/man/stars.pval.html'>stars.pval</a></span><span class='op'>(</span><span class='va'>p.value</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='https://rdrr.io/pkg/dotwhisker/man/relabel_predictors.html'>relabel_predictors</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span>
    AGE_BASE <span class='op'>=</span> <span class='st'>"Age at baseline"</span>,
    RELIGIONMuslim <span class='op'>=</span> <span class='st'>"Muslim Head of Household"</span>,
    RELIGIONChristian <span class='op'>=</span> <span class='st'>"Christian Head of Household"</span>,
    `WEALTHTMiddle tertile` <span class='op'>=</span> <span class='st'>"Middle Wealth Tertile"</span>,
    `WEALTHTHighest tertile` <span class='op'>=</span> <span class='st'>"Highest Wealth Tertile"</span>,
    URBAN_BASETRUE <span class='op'>=</span> <span class='st'>"Urban Residence"</span>,
    `COUNTRY_BASEDRC (Kinshasa)` <span class='op'>=</span> <span class='st'>"DRC (Kinshasa)"</span>,
    COUNTRY_BASEKenya <span class='op'>=</span> <span class='st'>"Kenya"</span>,
    `COUNTRY_BASENigeria (Lagos/Kano)` <span class='op'>=</span> <span class='st'>"Nigeria (Lagos/Kano)"</span>,
    PARTNERECONTRUE <span class='op'>=</span> <span class='st'>"Reliant on partner"</span>,
    WORKWKTRUE <span class='op'>=</span> <span class='st'>"Work outside home"</span>
  <span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>dotwhisker</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/dotwhisker/man/dwplot.html'>dwplot</a></span><span class='op'>(</span>
    dodge_size <span class='op'>=</span> <span class='fl'>0.3</span>,
    vline <span class='op'>=</span> <span class='fu'>geom_vline</span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>1</span>, colour <span class='op'>=</span> <span class='st'>"grey60"</span>, linetype <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>guides</span><span class='op'>(</span>color <span class='op'>=</span> <span class='fu'>guide_legend</span><span class='op'>(</span>reverse <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_pma</span><span class='op'>(</span>
    title <span class='op'>=</span> 
      <span class='st'>"Which factors impact women's purchasing power during COVID-19?"</span>, 
    subtitle <span class='op'>=</span> 
      <span class='st'>'Odds ratios relative to gaining "More" (95% CI)'</span>,
    legend.position <span class='op'>=</span> <span class='st'>"top"</span>
  <span class='op'>)</span> 
</code></pre>
</div>
<p><img src="covid-analysis_files/figure-html5/unnamed-chunk-22-1.png" width="1152" /></p>
</div>
<p>Because weve exponentiated the coefficients produced by this model, each <code>estimate</code> shows how each covariate <em>changes the odds</em> of experiencing a given level of <code>PURCHASE_PWR</code> <em>relative to</em> the reference group of women who maintained the same level of autonomy since COVID-19 restrictions began. For example, an <code>estimate</code> of 1.0 would indicate <em>equal odds</em>, 2.0 would indicate <em>double odds</em>, and so on.</p>
<p>Generally, the effects of demographic factors in our model are pretty limited. For example, notice the proximity of both <code>AGE_BASE</code> estimates to 1.0. Each additional year of <em>age at baseline</em> is estimated to change the odds that a woman would experience Less purchasing power by just 0.001 - or 0.1%; this is not a statistically significant difference from 1.0, as youll notice that the 95% confidence interval includes values both above <em>and</em> below equal odds. The More estimate for <code>AGE_BASE</code> tells a similar story: while we estimate that each year of <em>age at baseline</em> contributes to a 0.9% drop in the odds that a woman would gain More purchasing power, this difference is not sufficiently far enough from equal odds to indicate statistical significance. Perhaps surprisingly, neither of the variables <code>AGE_BASE</code>, <code>WEALTHT</code>, or <code>URBAN_BASE</code> are significant predictors for any outcome of <code>PURCHASE_PWR</code>.</p>
<p>On the other hand, we see some evidence that <code>RELIGION</code> may have a more meaningful impact, particularly for women living with a Muslim head of household. The estimated odds that such a woman would <em>lose</em> purchasing power are just 60.2% of the estimated odds that she would maintain the same level. Meanwhile, her estimated odds for <em>gaining</em> power are 152.5% - or about one and a half times <em>higher</em> than - her odds of maintaining the same level. The former estimate includes a 95% confidence interval that includes no values above 1.0, but the interval for the latter estimate <em>just barely</em> overlaps with 1.0. Hence, only the estimate for Less purchasing power meets the formal requirement for statistical significance.</p>
<p>Compared to demographic factors, the economic factors weve selected are much more powerful predictors for all levels of <code>PURCHASE_PWR</code>. Controlling for household wealth via <code>WEALTHT</code>, women who indicated on the COVID-19 survey that they were <em>currently economically reliant</em> on their husband/partner were both likely to have lost purchasing power, and unlikely to have gained it. Meanwhile, women who indicated on the baseline survey that they <em>recently worked outside the home</em> were somewhat likely to lose purchasing power, while they were unlikely to gain more. Three of the four estimates from these variables were statistically significant even at the 99.9% confidence threshold.</p>
<p>How might these conclusions change if we hadnt bothered to include <code>CVQWEIGHT</code> and <code>EAID_CV</code>? Without <code>CVQWEIGHT</code>, the <em>point estimates</em> for each of our covariates would shift in a direction reflecting the sample biases in the COVID-19 survey. Sample cluster information specified by <code>EAID_CV</code> doesnt change those point estimates, but it does impact the estimated <em>standard error</em> for each point estimate; if we had omitted <code>EAID_CV</code>, we would have generally <em>underestimated</em> standard error, leading to confidence intervals that are <em>too narrow</em>. Fortunately, the new <code>svyVGAM</code> package made it incredibly easy to incorporate both survey design elements into our multinomial model.</p>
<h1 id="wrap-up">Wrap-up</h1>
<p>The four samples weve been examining throughout this summer-long <a href="../../index.html#category:COVID-19">series on PMA COVID-19 data</a> are just <em>one part</em> of a larger panel study youll find on the <a href="https://pma.ipums.org">IPUMS PMA</a> website in the months and years ahead. Youll find information about samples from other countries and plans for additional follow-up surveys on the PMA <a href="https://www.pmadata.org/data/survey-methodology">survey methodology</a> page.</p>
<p>Here at the PMA Data Analysis Hub, we plan to change gears in the coming weeks as we begin a new series on <a href="https://www.pmadata.org/technical-areas/nutrition">PMA Nutrition Data</a>. However, well continue to focus on COVID-19 data when new surveys become available. For updates, keep an eye on the <a href="../../index.html#category:New_Data">New Data</a> tag or look for us on <a href="https://twitter.com/ipumsGH">Twitter</a>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2021-08-15-covid-analysis/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=Multinomial%20Regression%20with%20Complex%20Survey%20Design&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-08-15-covid-analysis%2F">
        <i class="fab fa-twitter"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fipums.github.io%2Fpma-data-hub%2Fposts%2F2021-08-15-covid-analysis%2F&amp;title=Multinomial%20Regression%20with%20Complex%20Survey%20Design">
        <i class="fab fa-linkedin"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://pma-data-hub.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'https://ipums.github.io/pma-data-hub/posts/2021-08-15-covid-analysis/';
  this.page.identifier = 'posts/2021-08-15-covid-analysis/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://pma-data-hub.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/ipums/pma-data-hub/issues/new">create an issue</a> on the source repository.</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
  <p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota</p>
  <p>Licensed under the <a href="https://www.mozilla.org/en-US/MPL/2.0/">Mozilla Public License Version 2.0</a></p>
  <p>Site built with <a href="https://rstudio.github.io/distill/">Distill for R Markdown</a></p>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
